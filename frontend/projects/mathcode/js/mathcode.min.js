window.mathcode=function(e,t){var n=e,c=t;l(c,"mathcode"),n.style.width="1px",n.style.position="absolute",n.style.left="-99999px",c.parentNode.appendChild(n);var a=["br","op","va","nu","co","fu"],i=[/\(|\)/,/\/|\*|\-|\+|\.|\^/,/x/,/\d/,/e|E|pi|Pi|PI/,/\w/];function r(e){var t=n.value,a=t.length,i=function(){var e=0;if(document.selection){n.focus();var t=document.selection.createRange();t.moveStart("character",-n.value.length),e=t.text.length}else(n.selectionStart||"0"==n.selectionStart)&&(e=n.selectionStart);return e}();c.innerHTML="",e&&"("===t.slice(i-1,i)&&57===e.which&&(t=t.slice(0,i)+")"+t.slice(i,a),e.target.value=t,a++,s(i)),e&&")"===t.slice(i-1,i)&&48===e.which&&")"===t.slice(i,i+1)&&(t=t.slice(0,i-1)+t.slice(i,a),e.target.value=t,a--,s(i)),c.appendChild(u("",0===i?"cursor":"empty"));for(var r=0;r<a;r++){let e=t[r];r+1<a&&/pi/i.test(e+t[r+1])?e+=t[r+1]:r>1&&/pi/i.test(t[r-1]+e)&&(e=t[r-1]+e);var v=o(e),f=u(t[r],v);i===r+1&&(f=l(f,"cursor")),c.appendChild(f)}d()}function s(e){if(n.setSelectionRange)n.focus(),n.setSelectionRange(e,e);else if(n.createTextRange){var t=n.createTextRange();t.collapse(!0),t.moveEnd("character",e),t.moveStart("character",e),t.select()}}function o(e){for(var t=0;t<i.length;t++)if(i[t].test(e))return a[t]}function l(e,t){return e.classList.add(t),e}function u(e,t){var n=document.createElement("div");return n.innerHTML=e,n.classList.add("mb"),n.classList.add(t),n.addEventListener("click",v),n}function d(){n.focus()}function v(e){var t=e.target,n=document.getElementsByClassName("cursor")[0];n&&n.classList.remove("cursor"),l(t,"cursor"),s([].indexOf.call(t.parentNode.children,t)),d()}r(),c.addEventListener("mouseup",d),n.addEventListener("keyup",r),n.addEventListener("focus",(function(){c.classList.remove("inactive"),l(c,"active")})),n.addEventListener("focusout",(function(){c.classList.remove("active"),l(c,"inactive")}))};