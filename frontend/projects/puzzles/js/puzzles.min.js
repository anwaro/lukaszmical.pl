function imageExists(){var e=new Image;e.onload=function(){$$(".URL").hide(),$puzzles.newGame("URL")},e.onerror=function(){showMSG("Nie znaleziono obarazka o podanym URL",0)},e.src=$$("#photoURL").value}function showMSG(e,t){$$(".MSG").fadeIn().setText(e).removeClass("ok").removeClass("error").addClass(t?"ok":"error")}function reset(){$$("#puzzleArea").fadeOut(300,(function(){$$("#select").fadeIn(300),$$("#puzzleAreaLay").empty()})),$$("#sample").hide(),$$(".MSG").hide(),$$("#imageView").src=""}function PuzzlesElement(e,t,a,n,r,o){this.el=e,this.pass=new Point(t,a),this.curr=new Point,this.step=new Point,this.ran=new Point(n,r),this.angle=o,this.check=!1}function Point(e,t){this.x=e||0,this.y=t||0}$puzzles=new function(){var e,t,a,n,r,o,s,i,u,l,c,p,d=[],$=!1,f=0;function h(e){var t=Number(e.target.id.replace(/\D/g,""));d[t-1].check||($=!0,d[(c=t)-1].el.css({cursor:"move",zIndex:9,opacity:1}),y(d[c-1].el,0),z())}function z(){$&&(d[c-1].el.css({top:u-i/2-60+"px",left:l-s/2+"px"}),d[c-1].curr.y=u-i/2-60,d[c-1].curr.x=l-s/2,window.setTimeout(z,50))}function m(t){if($){$=!1;var a=d[c-1],n=function(){for(var e=$$("#puzzleAreaLay"),t=0,a=0;null!=e;t+=e.offsetLeft,a+=e.offsetTop,e=e.offsetParent);return{x:t,y:a}}();d[c-1].el.css({cursor:"auto",zIndex:"initial",opacity:.8}),Math.abs(l-n.x-s/2-a.pass.x)<10&&Math.abs(u-n.y-i/2-a.pass.y)<10?(a.check=!0,a.el.css({top:a.pass.y+"px",left:a.pass.x+"px",opacity:1}),$$("#puzzleAreaLay").appendChild(e.removeChild(a.el)),25==++f&&(showMSG("Brawo! Udało Ci się ułożyć wszystkie puzzle",1),f=0,d=[])):(p=c,y(d[c-1].el,d[c-1].angle),function(e){e.step.x=(e.ran.x-e.curr.x)/5,e.step.y=(e.ran.y-e.curr.y)/5,w()}(a))}}function w(){var e=!0,t=d[p-1];Math.abs(t.ran.x-t.curr.x)>2*Math.abs(t.step.x)?(e=!1,t.curr.x+=t.step.x):t.curr.x=t.ran.x,Math.abs(t.ran.y-t.curr.y)>2*Math.abs(t.step.y)?(e=!1,t.curr.y+=t.step.y):t.curr.y=t.ran.y,t.el.css({left:t.curr.x+"px",top:t.curr.y+"px"}),e||window.setTimeout(w,20)}function y(e,t){e.style.webkitTransform="rotate("+t+"deg)",e.style.mozTransform="rotate("+t+"deg)",e.style.msTransform="rotate("+t+"deg)",e.style.oTransform="rotate("+t+"deg)",e.style.transform="rotate("+t+"deg)"}function x(){var u=new Image;u.onload=function(){r=u.width,o=u.height,r>a||o>n?$$.delay((function(){$$("#select").show(),$$("#puzzleArea").hide(),showMSG("Zbyt wielki rozmiar obrazka!",0)}),1e3):($$("#puzzleAreaLay").width(r+.01).height(o+.01).css("backgroundImage","url(/assets/puzzles/image/frame5.png) ").show(),$$("#imageView").src=t,$$("#imageView").height=r/o*200,i=o/5,s=r/5,function(){for(var r=0;r<25;r++){var o=document.createElement("DIV");o.id="puzzle"+(r+1),e.appendChild(o)}r=0;for(var u=0,l=0;r<25;r++){l=r%5,r&&!l&&u++;var c=$$("#puzzle"+(r+1)),p=120*Math.random()-60,$=Math.max(s,i),f=Math.random()*(a-$-10)+5,z=Math.random()*(n-$/2);c.addClass("puzzle"),y(c,p),c.addEvent("mousedown",h),c.css({top:z+"px",left:f+"px",background:"url("+t+") -"+l*s+"px -"+u*i+"px",height:i+"px",width:s+"px"}),d.push(new PuzzlesElement(c,l*s,u*i,f,z,p))}}())},u.src=t}function g(e){l=e.clientX,u=e.clientY}this.newGame=function(r,o){if($$.addEvent(window,"mouseup",m),$$.addEvent(window,"mousemove",g),e=$$("#puzzleArea"),n=window.innerHeight-75,a=window.innerWidth-25,e.width(a),"KOM"===r){$$("#select").fadeOut(300,(function(){$$("#puzzleArea").fadeIn(300)}));var s=new FileReader,i=$$("#image");s.onload=function(e){t=e.target.result,x()},s.readAsDataURL(i.files[0])}else"URL"===r?($$("#select").fadeOut(300,(function(){$$("#puzzleArea").fadeIn(300)})),t=$$("#photoURL").value,x()):($$("#sample").fadeOut(300,(function(){$$("#puzzleArea").fadeIn(300)})),t="/assets/puzzles/image/img"+(o||1)+".jpg",x())}};
