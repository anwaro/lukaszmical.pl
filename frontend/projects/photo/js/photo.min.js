$photo=new function(){var e,t,a,r,n,h,i,o=[],d=25;function c(){if(n.files&&n.files[0]){var a=new FileReader;h=new Image,a.readAsDataURL(n.files[0])}a.onload=function(a){h.src=a.target.result,document.getElementById("img").src=a.target.result,h.onload=function(){e.width=this.width,e.height=this.height,t.width=this.width,t.height=this.height,r.drawImage(h,0,0),l()}}}function l(){var e=(i=r.getImageData(0,0,t.width,t.height)).data,n=i.width,h=[];o=[];for(var c=0,l=0,u=0;c<e.length;c+=4)l=++u%n,h.push({r:e[c],g:e[c+1],b:e[c+2],a:e[c+3]}),l||(o.push(h),h=[]);if(d=parseInt(document.getElementById("range").value),document.querySelector("#pixel").checked){for(c=0;c<i.width;c+=d)for(u=0;u<i.height;u+=d)g(c,u);u=0;for(var f=0;u<i.height;u++)for(c=0;c<i.width;c++)i.data[f]=o[u][c].r,i.data[f+1]=o[u][c].g,i.data[f+2]=o[u][c].b,i.data[f+3]=o[u][c].a,f+=4;a.putImageData(i,0,0)}else if(document.querySelector("#circle").checked){d=Math.max(d,5),a.clearRect(0,0,i.width,i.height);for(c=0;c<i.width;c+=d)for(u=0;u<i.height;u+=d)a.fillStyle=g(c,u),a.beginPath(),a.arc(c+.5*d,u+.5*d,.5*d,0,2*Math.PI,!0),a.closePath(),a.fill()}else if(document.querySelector("#dots").checked){var s;d=5,a.clearRect(0,0,i.width,i.height);for(c=0;c<i.width;c+=d)for(u=0;u<i.height;u+=d){s=.2*(255-g(c,u,!0)),a.fillStyle="black";for(var m=0;m<s;m++)a.beginPath(),a.arc(c+Math.random()*d,u+Math.random()*d,.5,0,2*Math.PI,!0),a.closePath(),a.fill()}}}function g(e,t,a){a=a||0;for(var r=0,n=0,h=0,c=0,l=Math.min(e+d,i.width),g=Math.min(t+d,i.height),u=0,f=t;f<g;f++)for(var s=e;s<l;s++)r+=o[f][s].r,n+=o[f][s].g,h+=o[f][s].b,c+=o[f][s].a,u++;r/=u,n/=u,h/=u,c/=u;for(f=t;f<g;f++)for(s=e;s<l;s++)o[f][s].r=r,o[f][s].g=n,o[f][s].b=h,o[f][s].a=c;var m=parseInt((r+n+h)/3);return a?m:"rgb( "+parseInt(r)+", "+parseInt(n)+", "+parseInt(h)+")"}this.init=function(){e=document.getElementById("photoCanvas"),t=document.getElementById("photoHide"),n=document.querySelector("#photo"),e&&e.getContext&&(a=e.getContext("2d"),r=t.getContext("2d"),n.addEventListener("change",c),document.querySelector("#range").addEventListener("change",l),document.querySelector("#pixel").addEventListener("change",l),document.querySelector("#circle").addEventListener("change",l),document.querySelector("#dots").addEventListener("change",l))}},$photo.init();