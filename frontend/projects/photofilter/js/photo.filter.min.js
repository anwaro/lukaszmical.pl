window._c=function(t){console.log(t)},$photo=new function(){var t,r,e,a,i,o,n,h,g=[];function d(){if(i.files&&i.files[0]){var e=new FileReader;o=new Image,e.readAsDataURL(i.files[0])}e.onload=function(e){o.src=e.target.result,document.getElementById("img").src=e.target.result,o.onload=function(){t.width=this.width,t.height=this.height,r.width=this.width,r.height=this.height,a.drawImage(o,0,0),s()}}}function s(){n=a.getImageData(0,0,r.width,r.height),function(){for(var t=document.getElementsByName("filter"),r=0,e=t.length;r<e;r++)if(t[r].checked){h=t[r].value;break}}();var t=n.data,i=n.width,o=[];g=[];for(var d=0,s=0,c=0;d<t.length;d+=4)s=++c%i,o.push({r:t[d],g:t[d+1],b:t[d+2],a:t[d+3]}),s||(g.push(o),o=[]);!function(){if("negatyw"===h)for(var t=0;t<n.height;t++)for(var r=0;r<n.width;r++)g[t][r].g=255-g[t][r].g,g[t][r].r=255-g[t][r].r,g[t][r].b=255-g[t][r].b;else if("szarosc"===h){var e=0;for(t=0;t<n.height;t++)for(r=0;r<n.width;r++)e=(e=(g[t][r].r+g[t][r].g+g[t][r].b)/3-0)>255?255:e<0?0:e,g[t][r].g=e,g[t][r].r=e,g[t][r].b=e}else if("sepia"===h)for(t=0;t<n.height-1;t++)for(r=0;r<n.width-1;r++)g[t][r].g+=60,g[t][r].r+=30;else if("kontur"===h){var a=JSON.parse(JSON.stringify(g));for(t=0;t<n.height-1;t++)for(r=0;r<n.width-1;r++)g[t][r].r=Math.abs(a[t][r].r-a[t+1][r+1].r)+Math.abs(a[t+1][r].r-a[t][r+1].r),g[t][r].g=Math.abs(a[t][r].g-a[t+1][r+1].g)+Math.abs(a[t+1][r].g-a[t][r+1].g),g[t][r].b=Math.abs(a[t][r].b-a[t+1][r+1].b)+Math.abs(a[t+1][r].b-a[t][r+1].b)}else if("kontur-2"===h){var i,o;for(a=JSON.parse(JSON.stringify(g)),t=1;t<n.height-1;t++)for(r=1;r<n.width-1;r++)i=a[t-1][r+1].r+2*a[t][r+1].r+a[t+1][r+1].r-(a[t-1][r-1].r+2*a[t][r-1].r+a[t+1][r-1].r),o=a[t+1][r-1].r+2*a[t+1][r].r+a[t+1][r+1].r-(a[t-1][r-1].r+2*a[t-1][r].r+a[t-1][r+1].r),g[t][r].r=Math.pow(i*i+o*o,.5),i=a[t-1][r+1].g+2*a[t][r+1].g+a[t+1][r+1].g-(a[t-1][r-1].g+2*a[t][r-1].g+a[t+1][r-1].g),o=a[t+1][r-1].g+2*a[t+1][r].g+a[t+1][r+1].g-(a[t-1][r-1].g+2*a[t-1][r].g+a[t-1][r+1].g),g[t][r].g=Math.pow(i*i+o*o,.5),i=a[t-1][r+1].b+2*a[t][r+1].b+a[t+1][r+1].b-(a[t-1][r-1].b+2*a[t][r-1].b+a[t+1][r-1].b),o=a[t+1][r-1].b+2*a[t+1][r].b+a[t+1][r+1].b-(a[t-1][r-1].b+2*a[t-1][r].b+a[t-1][r+1].b),g[t][r].b=Math.pow(i*i+o*o,.5)}else if("progowanie"===h){e=0;var d=0;v=$$("#rangeProg").value;var s=document.getElementsByName("prog");for(t=0;t<s.length;t++)!0===s[t].checked&&(d=parseInt(s[t].value));console.log(d);for(t=0;t<n.height;t++)for(r=0;r<n.width;r++)e=(e=(g[t][r].r+g[t][r].g+g[t][r].b)/3)>v?1===d?e:255:-1===d?e:0,g[t][r].g=e,g[t][r].r=e,g[t][r].b=e}else if("randmaska"===h)f(randomMask());else if("wlasna3x3"===h){var c=[];for(t=1;t<=9;t++){(b=Number($$("#m"+t).value))||(b=0),c.push(b)}f(c)}else if("wlasna5x5"===h){for(c=[],t=1;t<=25;t++){var b;(b=Number($$("#n"+t).value))||(b=0),c.push(b)}f(c)}else if("akcent"===h){!function(t,r){for(var e=(t.h-r/2+360)%360,a=(t.h+r/2+360)%360,i=e<=a,o=0;o<n.height;o++)for(var h=0;h<n.width;h++){var d=l($$.clone(g[o][h]));if(i&&d.h>e&&d.h<a||!i&&(d.h>e||d.h<a));else{var s=(g[o][h].r+g[o][h].g+g[o][h].b)/3;g[o][h].g=s,g[o][h].r=s,g[o][h].b=s}}}(l(colorPicker.colorRgbaObj),v=$$("#rangeAccent").value)}else if("bit"===h){var u;for(t=0;t<n.height;t++)for(r=0;r<n.width;r++)u=g[t][r],g[t][r].g=50*Math.round(u.g/50),g[t][r].r=50*Math.round(u.r/50),g[t][r].b=50*Math.round(u.b/50)}else if("lab"===h){var v=255*Math.random(),$=255*Math.random(),m=255*Math.random();for(t=0;t<n.height;t++)for(r=0;r<n.width;r++)g[t][r].g=(g[t][r].g+v)%255,g[t][r].r=(g[t][r].r+$)%255,g[t][r].b=(g[t][r].b+m)%255}}();c=0;for(var b=0;c<n.height;c++)for(d=0;d<n.width;d++)n.data[b]=g[c][d].r,n.data[b+1]=g[c][d].g,n.data[b+2]=g[c][d].b,n.data[b+3]=g[c][d].a,b+=4;e.putImageData(n,0,0)}function f(t){if(!(Math.sqrt(t.length)%2))return!1;var r,e=Math.sqrt(t.length),a=Math.floor(e/2),i=Math.abs(t.reduce((function(t,r){return t+r}),0)),o=JSON.parse(JSON.stringify(g));for(var h in i=i||1,t)t[h]/=i;var d=n.height-a,s=n.width-a;for(h=a;h<d;h++)for(var f=a;f<s;f++)r=c(f,h,t,o,a),g[h][f].r=r.r,g[h][f].g=r.g,g[h][f].b=r.b}function c(t,r,e,a,i){for(var o={r:0,g:0,b:0},n=r-i,h=0;n<r+i+1;n++)for(var g=t-i;g<t+i+1;g++)o.r+=e[h]*a[n][g].r,o.g+=e[h]*a[n][g].g,o.b+=e[h]*a[n][g].b,h++;return o}function l(t){t.r/=255,t.g/=255,t.b/=255;var r={h:0,s:0,v:0},e=Math.max(t.r,t.g,t.b),a=e-Math.min(t.r,t.g,t.b);for(0===a?r.h=0:t.r>Math.max(t.g,t.b)?r.h=(t.g-t.b)/a%6*60:t.g>Math.max(t.r,t.b)?r.h=60*((t.b-t.r)/a+2):r.h=60*((t.r-t.g)/a+4);r.h<0;)r.h+=360;return r.s=e?a/e:0,r.v=e,r}this.init=function(){if(t=document.getElementById("photoCanvas"),r=document.getElementById("photoHide"),i=document.getElementById("photo"),t&&t.getContext){e=t.getContext("2d"),a=r.getContext("2d"),i.addEventListener("change",d);for(var o=document.getElementsByTagName("input"),n=0;n<o.length;n++){var h=o[n];"object"==typeof h&&"radio"===h.type&&"filter"===h.name&&$$.addEvent(h,"click",s)}}}};var bl={showMatrix3:"mask3x3",showMatrix5:"mask5x5",accent:"pickColor",progButton:"prog"};$$("html").addEventListener("click",(function(){var t=$$("#mask3x3"),r=$$("#mask5x5"),e=$$("#prog"),a=$$("#pickColor");t.isHidden()||t.fadeOut(200),r.isHidden()||r.fadeOut(200),a.isHidden()||a.fadeOut(200),e.isHidden()||e.fadeOut(200)})),$$("#showMatrix3").addEventListener("click",(function(t){t.stopPropagation(),$$("#mask3x3").isHidden()&&$$("#mask3x3").fadeIn(200)})),$$("#showMatrix5").addEventListener("click",(function(t){t.stopPropagation(),$$("#mask5x5").isHidden()&&$$("#mask5x5").fadeIn(200)})),$$("#accent").addEventListener("click",(function(t){t.stopPropagation(),$$("#pickColor").isHidden()&&$$("#pickColor").fadeIn(200)})),$$("#progButton").addEventListener("click",(function(t){t.stopPropagation(),$$("#prog").isHidden()&&$$("#prog").fadeIn(200)})),$photo.init(),colorPicker.install({element:"accent"});