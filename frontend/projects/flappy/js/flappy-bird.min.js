var $=function(e){return document.getElementById(e)},urlPr="/assets/flappy/image/",game={user:{best:0,score:0,Up:!0},set:{cookie:"game",name:"FlappyBird",x:450,y:630,g:28,ground:45,speed:5,win:170,step:300},bird:{x:100,y:300,w:50,h:40,dY:0,angle:0,life:!0,fly:!0,img:new Image,src:urlPr+"bird.png"},ground:{w:20,h:9,x:0,c:"rgba(100, 100, 100, 0.55)"},columns:[],col:function(e,a,m){this.h=400,this.w=66,this.x=e,this.yt=a,this.yb=m},column:{img_top:new Image,img_bot:new Image,src_top:urlPr+"col_top.png",src_bot:urlPr+"col_bott.png"},canv:"",ctx:"",loop:""};function drawFlappyBirdCanvas(){game.inicialize()}game.inicialize=function(){game.settingGame(),game.loop=setInterval(game.play,50),game.canv.addEventListener("click",game.changeSpeed),$$("html").addEventListener("keypress",(function(e){32===e.keyCode&&(e.stopPropagation(),game.changeSpeed())}))},game.settingGame=function(){game.canv=$("GameFlappyBird"),game.canv.height=game.set.y,game.canv.width=game.set.x,game.ctx=game.canv.getContext("2d"),$("PlayGame").style.display="none",game.bird.img.src=game.bird.src,game.column.img_top.src=game.column.src_top,game.column.img_bot.src=game.column.src_bot,game.pushArray(),game.checkBestScore()},game.play=function(){game.clearBoard(),game.moveAndDrawGround(),game.drawColumn(),game.moveColumn(),game.drawBird(),game.moveBird(),game.checkColision(),game.score()},game.changeSpeed=function(e){e&&e.stopPropagation(),game.bird.life&&game.bird.fly?(game.sound("up"),game.bird.dY=-16):game.bird.fly||(game.bird.life=!0,game.bird.fly=!0,drawFlappyBirdCanvas())},game.clearBoard=function(){game.ctx.clearRect(0,0,game.set.x,game.set.y)},game.drawBird=function(){var e=game.bird;game.ctx.save(),game.ctx.translate(e.x,e.y),game.ctx.rotate(e.angle),game.ctx.drawImage(e.img,-e.w/2,-e.h/2,e.w,e.h),game.ctx.restore()},game.moveBird=function(){var e=game.bird;e.y<e.h/2?(game.gameOver(),e.dY=5):e.y>game.set.y-(game.set.ground+e.h/2)&&(game.gameOver(),game.resetGame(),e.dY=0),e.y+=e.dY,e.dY+=.05*game.set.g,e.angle=Math.PI/2*(e.dY/30),e.angle=e.angle>Math.PI/2?Math.PI/2:e.angle},game.drawColumn=function(){for(var e=0;e<3;e++){var a=game.columns[e],m=game.column;game.ctx.drawImage(m.img_top,0,a.h-a.yt,a.w,a.yt,a.x,0,a.w,a.yt);var g=game.set.y-game.set.ground-a.yb;game.ctx.drawImage(m.img_bot,0,0,a.w,g,a.x,a.yb,a.w,g)}},game.moveColumn=function(){for(var e=0;e<3;e++)game.columns[e].x-=game.set.speed,game.columns[e].x<-game.columns[e].w&&game.setColumn(game.columns[e],e)},game.moveAndDrawGround=function(){var e=game.ground;e.x-=game.set.speed;for(var a=game.set.y-game.set.ground+3,m=0;m<5;m++)for(var g=e.x;g<=game.set.x;g+=2*e.w)game.drawSqare(g+m%2*e.w,a+m*e.h,e.w,e.h,e.c);e.x=e.x<-2*e.w?e.x+2*e.w:e.x},game.drawSqare=function(e,a,m,g,t){game.ctx.fillStyle=t,game.ctx.beginPath(),game.ctx.rect(e,a,m,g),game.ctx.closePath(),game.ctx.fill()},game.pushArray=function(){for(var e=0;e<3;e++){var a=new game.col(game.set.x,100,270);game.columns.push(a),0!==e&&game.setColumn(game.columns[e],e)}},game.setColumn=function(e,a){var m=0===a?2:a-1,g=Math.floor(Math.random()*(game.set.y-game.set.ground-game.set.win-200))+100;e.x=game.columns[m].x+game.set.step,e.yt=g,e.yb=g+game.set.win,game.user.Up=!0},game.checkColision=function(){var e=game.bird,a=game.columns;if(game.bird.life)for(var m=0;m<3;m++){Math.abs(e.x-(a[m].x+a[m].w/2))<=e.w/2+a[m].w/2&&(e.y-e.h/2<=a[m].yt||e.y+e.h/2>=a[m].yb?game.gameOver():game.scoreUp(a[m]))}},game.gameOver=function(){game.set.speed=0,game.bird.life&&game.sound("crash"),game.bird.life=!1},game.score=function(){game.ctx.save(),game.ctx.fillStyle="black",game.ctx.textAlign="start",game.ctx.font="bold 20pt Calibri",game.ctx.fillText("score: "+game.user.score,5,23),game.ctx.textAlign="end",game.ctx.fillText("best: "+game.user.best,game.set.x-5,23),game.ctx.restore()},game.scoreUp=function(e){Math.abs(game.bird.x-(e.x+e.w/2))<game.set.speed+1&&game.user.Up&&(game.user.score++,game.user.Up=!1)},game.resetGame=function(){game.sound("over"),clearInterval(game.loop),game.ctx.save(),game.ctx.fillStyle="black",game.ctx.textAlign="center",game.ctx.font="bold 40pt Calibri",game.ctx.fillText("GAME OVER",game.set.x/2,game.set.y/2-90),game.ctx.font="bold 20pt Calibri",game.ctx.fillText("Score: "+game.user.score,game.set.x/2,game.set.y/2-30),game.ctx.fillText("click to play again",game.set.x/2,game.set.y/2),game.ctx.restore();var e=game.user,a=game.bird;game.bestScore(),e.score=0,e.Up=!0,game.columns=[],a.x=100,a.y=300,a.dY=0,a.angle=0,a.fly=!1,game.set.speed=5},game.bestScore=function(){game.set.cookie,game.set.name;var e=$$.cookie("FlappyBirdScore")||0;parseInt(e)<game.user.score&&$$.cookie("FlappyBirdScore",game.user.score)},game.checkBestScore=function(){game.set.cookie,game.set.name;game.user.best=$$.cookie("FlappyBirdScore")||0},game.sound=function(e){document.getElementById(e).play()};