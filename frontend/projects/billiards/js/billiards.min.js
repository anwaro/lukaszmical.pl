function Bill(i,l,t,e){this.x=i||0,this.y=l||0,this.vx=0,this.vy=0,this.color=e,this.r=t,this.setV=function(i,l){this.vx=i,this.vy=l},this.updatePoss=function(){this.x+=this.vx,this.y+=this.vy},this.updateV=function(){Math.abs(this.vx*this.vx+this.vy*this.vy)>.1?(this.vx*=.99,this.vy*=.99):(this.vx=0,this.vy=0)}}function UserBill(i,l){this.bill=i}billiards=new function(){var i,l,t,e,n,s,a,o,r=800,h=400,y=200,v=10,c=2,x=!1,d=!1,_=[],b=[],f={img:new Image,src:"/assets/billiards/image/stick.png",load:function(){this.img.src=this.src}},u={img:new Image,src:"/assets/billiards/image/table-tmp.png",load:function(){this.img.src=this.src}},g=["#DBDE0A","#522906","#D69012","#A4A707","#1B1918","#CE0C0C","#DE3B3B","#82420C","#0F8FCC","#0C8204","#7E0CE6","#44077B","#44077B","#001FFF","#0A5005"];function M(){l.clearRect(0,0,i.width,i.height),l.drawImage(u.img,t-50,150,900,500),l.fillStyle=s.bill.color,l.beginPath(),l.arc(s.bill.x,s.bill.y,s.bill.r,0,2*Math.PI,!0),l.fill();for(var a=0;a<b.length;a++)l.beginPath(),l.fillStyle="rgba(0, 0, 0, 0.1)",l.arc(t+175+30*a,150,b[a].r+2,0,2*Math.PI,!0),l.fill(),l.beginPath(),l.fillStyle=b[a].color,l.arc(t+175+30*a,150,b[a].r,0,2*Math.PI,!0),l.fill();x=!1;for(a=0;a<_.length;a++){B(s.bill,_[a])<=s.bill.r+_[a].r+.5&&(B(s.bill,_[a])<s.bill.r+_[a].r&&p(s.bill,_[a]),E(s.bill,_[a]));for(var o=a+1;o<_.length;o++)B(_[o],_[a])<=_[o].r+_[a].r+.5&&(B(_[o],_[a])<_[o].r+_[a].r&&p(_[o],_[a]),E(_[o],_[a]));(_[a].vx||_[a].vy)&&(x=!0),m(_[a],a)&&((_[a].x+_[a].vx+_[a].r>r+t||_[a].x+_[a].vx-_[a].r<t)&&(_[a].vx*=-.9),(_[a].y+_[a].vy+_[a].r>600||_[a].y+_[a].vy-_[a].r<y)&&(_[a].vy*=-.9),_[a].updatePoss(),_[a].updateV())}(s.bill.vx||s.bill.vy)&&(x=!0),(s.bill.x+s.bill.vx+s.bill.r>r+t||s.bill.x+s.bill.vx-s.bill.r<t)&&(s.bill.vx*=-.9),(s.bill.y+s.bill.vy+s.bill.r>600||s.bill.y+s.bill.vy-s.bill.r<y)&&(s.bill.vy*=-.9),s.bill.updatePoss(),s.bill.updateV();for(a=0;a<_.length;a++)l.beginPath(),l.fillStyle=_[a].color,l.beginPath(),l.arc(_[a].x,_[a].y,_[a].r,0,2*Math.PI,!0),l.fill();x||(l.save(),l.translate(s.bill.x,s.bill.y),l.rotate(Math.atan2(e-s.bill.x,s.bill.y-n)+Math.PI/2),l.drawImage(f.img,v,-5,250,10),l.restore())}function p(i,l){var t=i.r+l.r-B(i,l),e=Math.sqrt(i.vx*i.vx+i.vy*i.vy),n=Math.sqrt(l.vx*l.vx+l.vy*l.vy),s=e+n,a=s?e/s*t+.01:0,o=s?n/s*t+.01:0;e&&(i.x-=i.vx*a/e),n&&(l.x-=l.vx*o/n),e&&(i.y-=i.vy*a/e),n&&(l.y-=l.vy*o/n)}function m(i,l){var e=i.x+i.vx-t,n=i.y+i.vy-y;return!(B({x:e,y:n},{x:0,y:0})<19||B({x:e,y:n},{x:0,y:h})<19||B({x:e,y:n},{x:r,y:0})<19||B({x:e,y:n},{x:r,y:h})<19)||(b.push(_.splice(l,1)[0]),!1)}function w(){d=!0,v=10,P()}function P(){(v>120||v<5)&&(c*=-1),v+=c,d&&setTimeout(P,1e3/60)}function I(){if(v>5)v-=o,setTimeout(I,1e3/60);else{v=10,x=!0;var i=Math.max(Math.abs(e-s.bill.x),Math.abs(n-s.bill.y));s.bill.setV(a*(e-s.bill.x)/i,a*(n-s.bill.y)/i)}}function B(i,l){return Math.sqrt((i.x-l.x)*(i.x-l.x)+(i.y-l.y)*(i.y-l.y))}function C(){!x&&d?(d=!1,o=.0696*(a=v/5)+3,c=Math.abs(c),I()):d=!1}function q(l){var t=i.getBoundingClientRect();e=l.clientX-t.left,n=l.clientY-t.top}function E(i,l){dx=i.x-l.x,dy=i.y-l.y,collisionision_angle=Math.atan2(dy,dx),magnitude_1=Math.sqrt(i.vx*i.vx+i.vy*i.vy),magnitude_2=Math.sqrt(l.vx*l.vx+l.vy*l.vy),direction_1=Math.atan2(i.vy,i.vx),direction_2=Math.atan2(l.vy,l.vx),new_xspeed_1=magnitude_1*Math.cos(direction_1-collisionision_angle),new_yspeed_1=magnitude_1*Math.sin(direction_1-collisionision_angle),new_xspeed_2=magnitude_2*Math.cos(direction_2-collisionision_angle),new_yspeed_2=magnitude_2*Math.sin(direction_2-collisionision_angle),final_xspeed_1=new_xspeed_2,final_xspeed_2=new_xspeed_1,final_yspeed_1=new_yspeed_1,final_yspeed_2=new_yspeed_2,i.vx=Math.cos(collisionision_angle)*final_xspeed_1+Math.cos(collisionision_angle+Math.PI/2)*final_yspeed_1,i.vy=Math.sin(collisionision_angle)*final_xspeed_1+Math.sin(collisionision_angle+Math.PI/2)*final_yspeed_1,l.vx=Math.cos(collisionision_angle)*final_xspeed_2+Math.cos(collisionision_angle+Math.PI/2)*final_yspeed_2,l.vy=Math.sin(collisionision_angle)*final_xspeed_2+Math.sin(collisionision_angle+Math.PI/2)*final_yspeed_2}this.init=function(){i=document.querySelector("#billCanvas"),function(){i.height=800;const l=document.querySelector("body").offsetWidth;t=(l-r)/2,i.width=l}(),s=new UserBill(new Bill(30+t,400,10,"white")),function(){for(var i=10,l=Math.sqrt(i*i*4-i*i)+1,e=0,n=0;e<5;e++)for(var s=0;s<=e;s++)_.push(new Bill(500+l*e+t,200-(i+.5)*e+2*(i+.5)*s+y,i,g[n])),n++}(),f.load(),u.load(),i.addEventListener("mousemove",q),i.addEventListener("mousedown",w),document.querySelector("html").addEventListener("mouseup",C),i.getContext&&(l=i.getContext("2d"),setInterval(M,1e3/60))}},billiards.init();