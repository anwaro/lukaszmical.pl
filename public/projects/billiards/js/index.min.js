function Bill(i,l,t,e){this.x=i||0,this.y=l||0,this.vx=0,this.vy=0,this.color=e,this.r=t,this.setV=function(i,l){this.vx=i,this.vy=l},this.updatePoss=function(){this.x+=this.vx,this.y+=this.vy},this.updateV=function(){.1<Math.abs(this.vx*this.vx+this.vy*this.vy)?(this.vx*=.99,this.vy*=.99):(this.vx=0,this.vy=0)}}function UserBill(i,l){this.bill=i}(billiards=new function(){var a,o,r,t,e,h,l,n,y=800,v=400,x=200,s=10,i=2,c=!1,d=!1,_=[],b=[],f=500,g=200,u={img:new Image,src:"/projects/billiards/image/stick.png",load:function(){this.img.src=this.src}},p={img:new Image,src:"/projects/billiards/image/table-tmp.png",load:function(){this.img.src=this.src}},M=["#DBDE0A","#522906","#D69012","#A4A707","#1B1918","#CE0C0C","#DE3B3B","#82420C","#0F8FCC","#0C8204","#7E0CE6","#44077B","#44077B","#001FFF","#0A5005"];function m(){o.clearRect(0,0,a.width,a.height),o.drawImage(p.img,r-50,x-50,900,500),o.fillStyle=h.bill.color,o.beginPath(),o.arc(h.bill.x,h.bill.y,h.bill.r,0,2*Math.PI,!0),o.fill();for(var i=0;i<b.length;i++)o.beginPath(),o.fillStyle="rgba(0, 0, 0, 0.1)",o.arc(r+175+30*i,150,b[i].r+2,0,2*Math.PI,!0),o.fill(),o.beginPath(),o.fillStyle=b[i].color,o.arc(r+175+30*i,150,b[i].r,0,2*Math.PI,!0),o.fill();c=!1;for(i=0;i<_.length;i++){C(h.bill,_[i])<=h.bill.r+_[i].r+.5&&(C(h.bill,_[i])<h.bill.r+_[i].r&&w(h.bill,_[i]),S(h.bill,_[i]));for(var l=i+1;l<_.length;l++)C(_[l],_[i])<=_[l].r+_[i].r+.5&&(C(_[l],_[i])<_[l].r+_[i].r&&w(_[l],_[i]),S(_[l],_[i]));(_[i].vx||_[i].vy)&&(c=!0),!function(i,l){var t=i.x+i.vx-r,i=i.y+i.vy-x;if(C({x:t,y:i},{x:0,y:0})<19||C({x:t,y:i},{x:0,y:v})<19||C({x:t,y:i},{x:y,y:0})<19||C({x:t,y:i},{x:y,y:v})<19)return void b.push(_.splice(l,1)[0]);return 1}(_[i],i)||((_[i].x+_[i].vx+_[i].r>y+r||_[i].x+_[i].vx-_[i].r<r)&&(_[i].vx*=-.9),(_[i].y+_[i].vy+_[i].r>v+x||_[i].y+_[i].vy-_[i].r<x)&&(_[i].vy*=-.9),_[i].updatePoss(),_[i].updateV())}(h.bill.vx||h.bill.vy)&&(c=!0),(h.bill.x+h.bill.vx+h.bill.r>y+r||h.bill.x+h.bill.vx-h.bill.r<r)&&(h.bill.vx*=-.9),(h.bill.y+h.bill.vy+h.bill.r>v+x||h.bill.y+h.bill.vy-h.bill.r<x)&&(h.bill.vy*=-.9),h.bill.updatePoss(),h.bill.updateV();for(i=0;i<_.length;i++)o.beginPath(),o.fillStyle=_[i].color,o.beginPath(),o.arc(_[i].x,_[i].y,_[i].r,0,2*Math.PI,!0),o.fill();c||(o.save(),o.translate(h.bill.x,h.bill.y),o.rotate(Math.atan2(t-h.bill.x,h.bill.y-e)+Math.PI/2),o.drawImage(u.img,s,-5,250,10),o.restore())}function w(i,l){var t=i.r+l.r-C(i,l),e=Math.sqrt(i.vx*i.vx+i.vy*i.vy),n=Math.sqrt(l.vx*l.vx+l.vy*l.vy),s=e+n,a=s?e/s*t+.01:0,s=s?n/s*t+.01:0;e&&(i.x-=i.vx*a/e),n&&(l.x-=l.vx*s/n),e&&(i.y-=i.vy*a/e),n&&(l.y-=l.vy*s/n)}function P(){d=!0,s=10,I()}function I(){(120<s||s<5)&&(i*=-1),s+=i,d&&setTimeout(I,1e3/60)}function B(){var i;5<s?(s-=n,setTimeout(B,1e3/60)):(s=10,c=!0,i=Math.max(Math.abs(t-h.bill.x),Math.abs(e-h.bill.y)),h.bill.setV(l*(t-h.bill.x)/i,l*(e-h.bill.y)/i))}function C(i,l){return Math.sqrt((i.x-l.x)*(i.x-l.x)+(i.y-l.y)*(i.y-l.y))}function q(){!c&&d?(d=!1,n=.0696*(l=s/5)+3,i=Math.abs(i),B()):d=!1}function E(i){var l=a.getBoundingClientRect();t=i.clientX-l.left,e=i.clientY-l.top}function S(i,l){dx=i.x-l.x,dy=i.y-l.y,collisionision_angle=Math.atan2(dy,dx),magnitude_1=Math.sqrt(i.vx*i.vx+i.vy*i.vy),magnitude_2=Math.sqrt(l.vx*l.vx+l.vy*l.vy),direction_1=Math.atan2(i.vy,i.vx),direction_2=Math.atan2(l.vy,l.vx),new_xspeed_1=magnitude_1*Math.cos(direction_1-collisionision_angle),new_yspeed_1=magnitude_1*Math.sin(direction_1-collisionision_angle),new_xspeed_2=magnitude_2*Math.cos(direction_2-collisionision_angle),new_yspeed_2=magnitude_2*Math.sin(direction_2-collisionision_angle),final_xspeed_1=new_xspeed_2,final_xspeed_2=new_xspeed_1,final_yspeed_1=new_yspeed_1,final_yspeed_2=new_yspeed_2,i.vx=Math.cos(collisionision_angle)*final_xspeed_1+Math.cos(collisionision_angle+Math.PI/2)*final_yspeed_1,i.vy=Math.sin(collisionision_angle)*final_xspeed_1+Math.sin(collisionision_angle+Math.PI/2)*final_yspeed_1,l.vx=Math.cos(collisionision_angle)*final_xspeed_2+Math.cos(collisionision_angle+Math.PI/2)*final_yspeed_2,l.vy=Math.sin(collisionision_angle)*final_xspeed_2+Math.sin(collisionision_angle+Math.PI/2)*final_yspeed_2}this.init=function(){var i;(a=document.querySelector("#billCanvas")).height=v+2*x,i=document.querySelector("body").offsetWidth,r=(i-y)/2,a.width=i,h=new UserBill(new Bill(30+r,200+x,10,"white"));for(var l=10,t=Math.sqrt(300)+1,e=0,n=0;e<5;e++)for(var s=0;s<=e;s++)_.push(new Bill(f+t*e+r,g-10.5*e+21*s+x,l,M[n])),n++;u.load(),p.load(),a.addEventListener("mousemove",E),a.addEventListener("mousedown",P),document.querySelector("html").addEventListener("mouseup",q),a.getContext&&(o=a.getContext("2d"),setInterval(m,1e3/60))}}).init();