M={},S={hAxis:30,h0:0,vAxis:30,v0:0,dval_x:30,dx_px:30,dval_y:30,dy_px:30,fun:"x",xmin:0,xmax:10,ymin:3e8,ymax:-3e8,gradY:10,gradX:10,mar_x:70,mar_y:50,o_x:" ",o_y:" "},C={},M.init=function(){document.getElementById("draw").onclick=function(){var t=parseInt(document.getElementById("x").value),x=parseInt(document.getElementById("y").value),t=(S.x=C.canv.width=t<300?300:1500<t?1500:t,S.y=C.canv.height=x<300?300:1500<x?1500:x,C.ctx.clearRect(0,0,S.x,S.y),S.fun=M.preperFunction(document.getElementById("function").value),parseFloat(document.getElementById("xmin").value.replace(",","."))),x=parseFloat(document.getElementById("xmax").value.replace(",",".")),e=parseInt(document.getElementById("g_x").value),a=parseInt(document.getElementById("g_y").value),n=parseInt(document.getElementById("m_x").value),o=parseInt(document.getElementById("m_y").value);x<t&&(t=0,x=10),S.xmin=t,S.xmax=x,S.gradX=e<3?3:20<e?20:e,S.gradY=a<3?3:20<a?20:a,S.mar_x=n<50?50:100<n?100:n,S.mar_y=o<50?50:100<o?100:o,S.ymin=3e8,S.ymax=-3e8,S.o_x=document.getElementById("o_x").value,S.o_y=document.getElementById("o_y").value,M.draw()},C.canv=document.getElementById("mathCanvas"),S.y=C.canv.height=500,S.x=C.canv.width=600,S.hAxis=S.y-30,C.canv.style.backgroundColor="silver",C.ctx=C.canv.getContext("2d"),M.draw()},M.draw=function(){M.fun(),M.axis(3,S.x-20,S.hAxis,"h"),M.axis(20,S.y-3,S.vAxis,"v"),M.writeInfoAxis(),M.drawFunction(),document.getElementById("down").href=C.canv.toDataURL()},M.axis=function(t,x,e,a){C.ctx.beginPath(),C.ctx.fillStyle="black",C.ctx.strokeStyle="black",C.ctx.lineWidth=.5,"h"===a?(C.ctx.moveTo(t,e),C.ctx.lineTo(x,e),C.ctx.moveTo(x,e+4),C.ctx.lineTo(x+6,e),C.ctx.lineTo(x,e-4),C.ctx.lineTo(x,e+4)):(C.ctx.moveTo(e,t),C.ctx.lineTo(e,x),C.ctx.moveTo(e+4,t),C.ctx.lineTo(e,t-6),C.ctx.lineTo(e-4,t),C.ctx.lineTo(e+4,t)),C.ctx.stroke()},M.fun=function(){var l=S.xmax-S.xmin,lx=(S.dval_x=l/S.gradX,S.x-S.mar_x);S.kx=lx/l,S.dx_px=lx*S.dval_x/l,0<S.xmax&&0<S.xmin?(S.vAxis=S.mar_x,S.v0=S.xmin,S.poss0X=S.vAxis-S.xmin*S.dx_px):S.xmax<0&&S.xmin<0?(S.vAxis=S.mar_x,S.v0=S.xmax,S.poss0X=S.vAxis-S.xmax*S.dx_px):(S.poss0X=S.vAxis=Math.abs(S.xmin/l*(S.x-2*S.mar_x))+S.mar_x,S.v0=0);for(var val,arr=[],x=S.xmin;x<=S.xmax;x+=.001*Math.abs(S.xmax-S.xmin))try{if(val=eval(S.fun),1e11<val)throw"Too large number";if(val<-1e11)throw"Too small number";S.ymax<val&&(S.ymax=val),S.ymin>val&&(S.ymin=val)}catch(err){console.log(err)}var ly=S.y-2*S.mar_y,l=S.ymax-S.ymin;S.dval_y=l/S.gradY,S.ky=ly/l,S.dy_px=ly*S.dval_y/l,0<S.ymax&&0<S.ymin?(S.hAxis=S.y-S.mar_y,S.h0=S.ymin,S.poss0Y=S.hAxis+S.ymin*S.dy_px):S.ymax<0&&S.ymin<0?(S.hAxis=S.mar_y,S.h0=S.ymax,S.poss0Y=S.hAxis+S.ymax*S.dy_px):(S.poss0Y=S.hAxis=S.ymax/l*(S.y-2*S.mar_y)+S.mar_y,S.h0=0),M.grad("h"),M.grad("v")},M.drawFunction=function(){var possX=S.mar_x+(S.xmin-10-S.xmin)*S.kx,x=S.xmin,possY=S.mar_y+(S.ymax-eval(S.fun))*S.ky;C.ctx.beginPath(),C.ctx.fillStyle="blue",C.ctx.strokeStyle="blue",C.lineWidth=.5,C.ctx.moveTo(possX,possY);for(var x=S.xmin-10;x<=S.xmax+5;x+=.001*Math.abs(S.xmax-S.xmin))try{if(1e11<eval(S.fun))throw"Too large value";if(eval(S.fun)<-1e11)throw"Too small value";possX=S.mar_x+(x-S.xmin)*S.kx,possY=S.mar_y+(S.ymax-eval(S.fun))*S.ky,C.ctx.lineTo(possX,possY)}catch(err){console.log(err)}C.ctx.stroke()},M.preperFunction=function(t){var x,e={abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",pow:"Math.pow",rand:"Math.random()",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",PI:"Math.PI",pi:"Math.PI",Pi:"Math.PI"};for(x in e){var a=new RegExp(x,"g");t=t.replace(a,e[x])}return t},M.grad=function(t){if(C.ctx.beginPath(),C.ctx.fillStyle="black",C.ctx.strokeStyle="black",C.ctx.font="10pt Calibri",C.ctx.fillStyle="black",C.lineWidth=.5,"h"===t){var x=S.dval_x,e=S.dx_px;C.ctx.textAlign="center",C.ctx.textBaseline="top";for(var a=S.vAxis+e,n=S.v0+x;a<S.x-20;a+=e)C.ctx.moveTo(a,S.hAxis-5),C.ctx.lineTo(a,S.hAxis+5),C.ctx.stroke(),C.ctx.fillText(M.fN(n,x),a,S.hAxis+12),n+=x;for(a=S.vAxis-e,n=-(S.v0+x);0<a;a-=e)C.ctx.moveTo(a,S.hAxis-5),C.ctx.lineTo(a,S.hAxis+5),C.ctx.stroke(),C.ctx.fillText(-1*M.fN(-n,x),a,S.hAxis+12),n-=x}else{x=S.dval_y,e=S.dy_px;C.ctx.textAlign="end",C.ctx.textBaseline="middle";for(a=S.hAxis+e,n=Math.abs(S.h0)+x;a<S.y;a+=e)C.ctx.moveTo(S.vAxis-5,a),C.ctx.lineTo(S.vAxis+5,a),C.ctx.stroke(),C.ctx.fillText(-1*M.fN(n,x),S.vAxis-12,a),n+=x;for(a=S.hAxis-e,n=-(S.h0+x);20<a;a-=e)C.ctx.moveTo(S.vAxis-5,a),C.ctx.lineTo(S.vAxis+5,a),C.ctx.stroke(),C.ctx.fillText(M.fN(-n,x),S.vAxis-12,a),n-=x}},M.fN=function(t,x){if(.1<=x)return t.toFixed(2);for(var e=0,a=t;e<18;)if(e++,1<(a*=10)){if(10*a-10*Math.floor(a)<5)return t.toFixed(e);for(;Math.round(10*a)==10*Math.round(a);)a*=10,e++;return t.toFixed(e+2)}return t.toFixed(e+2)},M.writeInfoAxis=function(){C.ctx.font="14pt Calibri",C.ctx.fillStyle="black",C.ctx.textAlign="center",C.ctx.textBaseline="top",C.ctx.fillText(S.o_x,S.x/2,S.hAxis+25),C.ctx.save(),C.ctx.rotate(-Math.PI/2),C.ctx.textAlign="center",C.ctx.fillText(S.o_y,-S.y/2,3),C.ctx.restore()},M.init();