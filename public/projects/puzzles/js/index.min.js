function M(e,t){$$(".MSG").fadeIn().setText(e).removeClass("ok").removeClass("error").addClass(t?"ok":"error")}function k(e,t,a,r,n,s){this.el=e,this.pass=new o(t,a),this.curr=new o,this.step=new o,this.ran=new o(r,n),this.angle=s,this.check=!1}function o(e,t){this.x=e||0,this.y=t||0}$puzzles=new function(){var c,l,p,d,f,h,$,m,r,n,s,o,z=[],i=!1,u=0;function w(e){e=Number(e.target.id.replace(/\D/g,""));z[e-1].check||(i=!0,z[(s=e)-1].el.css({cursor:"move",zIndex:9,opacity:1}),g(z[s-1].el,0),t())}function t(){i&&(z[s-1].el.css({top:r-m/2-60+"px",left:n-$/2+"px"}),z[s-1].curr.y=r-m/2-60,z[s-1].curr.x=n-$/2,window.setTimeout(t,50))}function x(e){var t,a;i&&(i=!1,t=z[s-1],a=function(){for(var e=$$("#puzzleAreaLay"),t=0,a=0;null!=e;t+=e.offsetLeft,a+=e.offsetTop,e=e.offsetParent);return{x:t,y:a}}(),z[s-1].el.css({cursor:"auto",zIndex:"initial",opacity:.8}),Math.abs(n-a.x-$/2-t.pass.x)<10&&Math.abs(r-a.y-m/2-t.pass.y)<10?(t.check=!0,t.el.css({top:t.pass.y+"px",left:t.pass.x+"px",opacity:1}),$$("#puzzleAreaLay").appendChild(c.removeChild(t.el)),25==++u&&(M("Brawo! Udało Ci się ułożyć wszystkie puzzle",1),u=0,z=[])):(g(z[(o=s)-1].el,z[s-1].angle),(a=t).step.x=(a.ran.x-a.curr.x)/5,a.step.y=(a.ran.y-a.curr.y)/5,y()))}function y(){var e=!0,t=z[o-1];Math.abs(t.ran.x-t.curr.x)>2*Math.abs(t.step.x)?(e=!1,t.curr.x+=t.step.x):t.curr.x=t.ran.x,Math.abs(t.ran.y-t.curr.y)>2*Math.abs(t.step.y)?(e=!1,t.curr.y+=t.step.y):t.curr.y=t.ran.y,t.el.css({left:t.curr.x+"px",top:t.curr.y+"px"}),e||window.setTimeout(y,20)}function g(e,t){e.style.webkitTransform="rotate("+t+"deg)",e.style.mozTransform="rotate("+t+"deg)",e.style.msTransform="rotate("+t+"deg)",e.style.oTransform="rotate("+t+"deg)",e.style.transform="rotate("+t+"deg)"}function v(){var u=new Image;u.onload=function(){if(f=u.width,h=u.height,p<f||d<h)$$.delay(function(){$$("#select").show(),$$("#puzzleArea").hide(),M("Zbyt wielki rozmiar obrazka!",0)},1e3);else{$$("#puzzleAreaLay").width(f+.01).height(h+.01).css("backgroundImage","url(/projects/puzzles/image/frame5.png) ").show(),$$("#imageView").src=l,$$("#imageView").height=f/h*200,m=h/5,$=f/5;for(var e=0;e<25;e++){var t=document.createElement("DIV");t.id="puzzle"+(e+1),c.appendChild(t)}for(var a,e=0,r=0;e<25;e++){a=e%5,e&&!a&&r++;var n=$$("#puzzle"+(e+1)),s=120*Math.random()-60,o=Math.max($,m),i=Math.random()*(p-o-10)+5,o=Math.random()*(d-o/2);n.addClass("puzzle"),g(n,s),n.addEvent("mousedown",w),n.css({top:o+"px",left:i+"px",background:"url("+l+") -"+a*$+"px -"+r*m+"px",height:m+"px",width:$+"px"}),z.push(new k(n,a*$,r*m,i,o,s))}}},u.src=l}function b(e){n=e.clientX,r=e.clientY}this.newGame=function(e,t){var a,r;$$.addEvent(window,"mouseup",x),$$.addEvent(window,"mousemove",b),c=$$("#puzzleArea"),d=window.innerHeight-75,p=window.innerWidth-25,c.width(p),"KOM"===e?($$("#select").fadeOut(300,function(){$$("#puzzleArea").fadeIn(300)}),a=new FileReader,r=$$("#image"),a.onload=function(e){l=e.target.result,v()},a.readAsDataURL(r.files[0])):(l="URL"===e?($$("#select").fadeOut(300,function(){$$("#puzzleArea").fadeIn(300)}),$$("#photoURL").value):($$("#sample").fadeOut(300,function(){$$("#puzzleArea").fadeIn(300)}),"/projects/puzzles/image/img"+(t||1)+".jpg"),v())}};