function imageExists(){var e=new Image;e.onload=function(){$$(".URL").hide(),$puzzles.newGame("URL")},e.onerror=function(){showMSG("Nie znaleziono obarazka o podanym URL",0)},e.src=$$("#photoURL").value}function showMSG(e,t){$$(".MSG").fadeIn().setText(e).removeClass("ok").removeClass("error").addClass(t?"ok":"error")}function reset(){$$("#puzzleArea").fadeOut(300,function(){$$("#select").fadeIn(300),$$("#puzzleAreaLay").empty()}),$$("#sample").hide(),$$(".MSG").hide(),$$("#imageView").src=""}function PuzzlesElement(e,t,a,n,r,o){this.el=e,this.pass=new Point(t,a),this.curr=new Point,this.step=new Point,this.ran=new Point(n,r),this.angle=o,this.check=!1}function Point(e,t){this.x=e||0,this.y=t||0}$puzzles=new function(){var l,c,p,d,$,f,h,z,n,r,o,s,m=[],i=!1,u=0;function w(e){e=Number(e.target.id.replace(/\D/g,""));m[e-1].check||(i=!0,m[(o=e)-1].el.css({cursor:"move",zIndex:9,opacity:1}),g(m[o-1].el,0),t())}function t(){i&&(m[o-1].el.css({top:n-z/2-60+"px",left:r-h/2+"px"}),m[o-1].curr.y=n-z/2-60,m[o-1].curr.x=r-h/2,window.setTimeout(t,50))}function y(e){var t,a;i&&(i=!1,t=m[o-1],a=function(){for(var e=$$("#puzzleAreaLay"),t=0,a=0;null!=e;t+=e.offsetLeft,a+=e.offsetTop,e=e.offsetParent);return{x:t,y:a}}(),m[o-1].el.css({cursor:"auto",zIndex:"initial",opacity:.8}),Math.abs(r-a.x-h/2-t.pass.x)<10&&Math.abs(n-a.y-z/2-t.pass.y)<10?(t.check=!0,t.el.css({top:t.pass.y+"px",left:t.pass.x+"px",opacity:1}),$$("#puzzleAreaLay").appendChild(l.removeChild(t.el)),25==++u&&(showMSG("Brawo! Udało Ci się ułożyć wszystkie puzzle",1),u=0,m=[])):(g(m[(s=o)-1].el,m[o-1].angle),(a=t).step.x=(a.ran.x-a.curr.x)/5,a.step.y=(a.ran.y-a.curr.y)/5,x()))}function x(){var e=!0,t=m[s-1];Math.abs(t.ran.x-t.curr.x)>2*Math.abs(t.step.x)?(e=!1,t.curr.x+=t.step.x):t.curr.x=t.ran.x,Math.abs(t.ran.y-t.curr.y)>2*Math.abs(t.step.y)?(e=!1,t.curr.y+=t.step.y):t.curr.y=t.ran.y,t.el.css({left:t.curr.x+"px",top:t.curr.y+"px"}),e||window.setTimeout(x,20)}function g(e,t){e.style.webkitTransform="rotate("+t+"deg)",e.style.mozTransform="rotate("+t+"deg)",e.style.msTransform="rotate("+t+"deg)",e.style.oTransform="rotate("+t+"deg)",e.style.transform="rotate("+t+"deg)"}function v(){var u=new Image;u.onload=function(){if($=u.width,f=u.height,p<$||d<f)$$.delay(function(){$$("#select").show(),$$("#puzzleArea").hide(),showMSG("Zbyt wielki rozmiar obrazka!",0)},1e3);else{$$("#puzzleAreaLay").width($+.01).height(f+.01).css("backgroundImage","url(/projects/puzzles/image/frame5.png) ").show(),$$("#imageView").src=c,$$("#imageView").height=$/f*200,z=f/5,h=$/5;for(var e=0;e<25;e++){var t=document.createElement("DIV");t.id="puzzle"+(e+1),l.appendChild(t)}for(var a,e=0,n=0;e<25;e++){a=e%5,e&&!a&&n++;var r=$$("#puzzle"+(e+1)),o=120*Math.random()-60,s=Math.max(h,z),i=Math.random()*(p-s-10)+5,s=Math.random()*(d-s/2);r.addClass("puzzle"),g(r,o),r.addEvent("mousedown",w),r.css({top:s+"px",left:i+"px",background:"url("+c+") -"+a*h+"px -"+n*z+"px",height:z+"px",width:h+"px"}),m.push(new PuzzlesElement(r,a*h,n*z,i,s,o))}}},u.src=c}function M(e){r=e.clientX,n=e.clientY}this.newGame=function(e,t){var a,n;$$.addEvent(window,"mouseup",y),$$.addEvent(window,"mousemove",M),l=$$("#puzzleArea"),d=window.innerHeight-75,p=window.innerWidth-25,l.width(p),"KOM"===e?($$("#select").fadeOut(300,function(){$$("#puzzleArea").fadeIn(300)}),a=new FileReader,n=$$("#image"),a.onload=function(e){c=e.target.result,v()},a.readAsDataURL(n.files[0])):(c="URL"===e?($$("#select").fadeOut(300,function(){$$("#puzzleArea").fadeIn(300)}),$$("#photoURL").value):($$("#sample").fadeOut(300,function(){$$("#puzzleArea").fadeIn(300)}),"/projects/puzzles/image/img"+(t||1)+".jpg"),v())}};