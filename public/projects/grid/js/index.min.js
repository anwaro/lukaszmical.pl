let e,n,o={x:0,y:0},m=[],f,g,t,p={maxRange:2e3,maxForce:100,countX:50,countY:50,pixelCount:24e3,maxPixelCount:45e3,exp:!1,smooth:!1};let l=100,X=100,a,i,r,d,s,Y=2500,u=0,c=document.createElement("canvas"),h=c.getContext("2d"),M=[],v=10,x,y=0,w=0,C=[],E,L,I,A={closeSettings:function(){document.body.classList.remove("open")},openSettings:function(){o.x=f/2,o.y=g/2,document.body.classList.add("open")},setValue:function(t){var e=t.dataset.var,t=t.value;p[e]=P(t),document.getElementById(e).innerHTML=t},loadPhoto:S,generatePoint:B,toggle:function(t){t=t.dataset.var;p[t]=!p[t]}};function B(){m=[];var t=.1*f,n=.9*f,o=.1*g,a=.9*g,i=(n-t)/p.countX,r=(a-o)/p.countY;let l=0,d=0;var s,u,c=255/p.countX,h=255/p.countY;for(let e=t;e<n;e+=i,l+=c){for(let t=o;t<a;t+=r,d+=h)m.push(b(e,t,(s=l,u=d,"rgb("+P(105)+", "+P(255-u)+", "+P(s)+")")));d=0}}function D(){var t=C[0]-C[C.length-1];E.innerHTML="Frame rate: "+Math.floor(1e3*C.length/t)+" fps",L.innerHTML="Particle: "+m.length}function T(){e.fillStyle="#0b1216",e.fillRect(0,0,f,g),e.save(),e.translate(o.x-100,o.y-100),e.beginPath(),e.fillStyle=t,e.fillRect(0,0,200,200),e.restore();for(let t=0;t<m.length;t++)I=function(t){var e=function(t){return Math.sqrt((o.x-t[0][0])*(o.x-t[0][0])+(o.y-t[0][1])*(o.y-t[0][1]))}(m[t]);if(e>p.maxRange&&!p.smooth)return m[t][0];e=-(p.maxForce/p.maxRange)*e+p.maxForce;var n=Math.atan2(o.x-m[t][0][0],m[t][0][1]-o.y)+2.5*Math.PI;m[t][1]=p.exp?[f/2+Math.cos(n)*e,g/2+Math.sin(n)*e]:[m[t][0][0]+Math.cos(n)*e,m[t][0][1]+Math.sin(n)*e],p.smooth&&(m[t][2][0]+=.3*(m[t][1][0]-m[t][2][0]),m[t][2][1]+=.3*(m[t][1][1]-m[t][2][1]));return p.smooth?m[t][2]:m[t][1]}(t),e.fillStyle=m[t][3],e.beginPath(),e.fillRect(I[0],I[1],v,v),e.fill();C.unshift((new Date).getTime()),C.splice(20),window.requestAnimationFrame(T)}function k(t){var e=n.getBoundingClientRect();o.x=t.clientX-e.left,o.y=t.clientY-e.top}function R(){f=window.innerWidth,g=window.innerHeight,n.width=f,n.height=g}function b(t,e,n){return[[t,e],[t,e],[t,e],n]}function S(){r.parentNode.classList.remove("end"),i.files&&i.files[0]?setTimeout(z,500):r.parentNode.classList.add("end")}function z(){var t=new FileReader;a=new Image,t.onload=function(t){a.src=t.target.result,a.onload=function(){q(200,!0),c.width=this.width,c.height=this.height,h.drawImage(a,0,0),function t(e,n){var o=f-l,a=g-X,i=e/n,r=o/a;e/(x=r<i?(v=Math.floor(Math.min(e,o)/Math.sqrt(p.pixelCount*i)),Math.floor(e/Math.sqrt(p.pixelCount*i))):(v=Math.floor(Math.min(n,a)/Math.sqrt(p.pixelCount/i)),Math.floor(n/Math.sqrt(p.pixelCount/i))))*(n/x)>p.maxPixelCount&&(p.pixelCount/=1.2,t(e,n))}(this.width,this.height),setTimeout(G,1e3)}},t.readAsDataURL(i.files[0])}function G(){M=h.getImageData(0,0,c.width,c.height),y=f-M.width/x*v,w=g-M.height/x*v,m=[];let e=2300/(M.width/x),n=0;!function t(){for(let t=0;t<M.height;t+=x)m.push(b(Math.round(y/2+n/x*v),Math.round(w/2+t/x*v),function(e,n){let o,a,i=0,r=0,l=0,d=0,s=Math.min(e+x,M.width),u=Math.min(n+x,M.height),c=0;for(let t=n;t<u;t++){a=4*t*M.width;for(let t=e;t<s;t++)o=a+4*t,i+=M.data[o],r+=M.data[1+o],l+=M.data[2+o],d+=M.data[3+o],c++}return i=P(i/c),r=P(r/c),l=P(l/c),d=P(d/c),"rgba( "+i+", "+r+", "+l+", "+d+")"}(n,t)));(n+=x)<M.width?(q(e,!1),setTimeout(t,10)):(q(2500,!0),r.parentNode.classList.add("end"),setTimeout(function(){q(0,!0)},500))}()}function P(t){return"string"==typeof t&&(t=parseInt(t)),Math.round(t)}function q(t,e){e?u=t:u+=t,t=P(u/Y*100),r.style.height=t+"%",d.innerHTML=t+"%",s.innerHTML=t+"%"}function F(){var t=A[this.dataset.action];"function"==typeof t&&t(this)}(i=document.getElementById("image")).addEventListener("change",S),r=document.getElementById("progress"),d=document.getElementById("pr-1"),s=document.getElementById("pr-2"),E=document.getElementById("fps"),L=document.getElementById("particle"),n=document.getElementById("grid"),window.addEventListener("resize",R),n.addEventListener("mousemove",k),n.style.cursor="none",R(),e=n.getContext("2d"),(t=e.createRadialGradient(100,100,100,100,100,0)).addColorStop(0,"#0b1216"),t.addColorStop(.7,"#15292f"),t.addColorStop(.9,"#19393e"),t.addColorStop(1,"#30767b"),B();{let t,e=document.getElementsByClassName("action"),n=document.getElementsByClassName("input-action");for(t=0;t<e.length;t++)e[t].addEventListener("click",F);for(t=0;t<n.length;t++){n[t].addEventListener("input",F);var H=n[t].dataset.var,N=p[H];n[t].value=P(N),document.getElementById(H).innerHTML=N}}setInterval(D,1e3),window.requestAnimationFrame(T);