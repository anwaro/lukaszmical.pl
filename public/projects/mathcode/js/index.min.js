window.mathcode=function(e,t){var r=e,s=t,o=(u(s,"mathcode"),r.style.width="1px",r.style.position="absolute",r.style.left="-99999px",s.parentNode.appendChild(r),["br","op","va","nu","co","fu"]),l=[/\(|\)/,/\/|\*|\-|\+|\.|\^/,/x/,/\d/,/e|E|pi|Pi|PI/,/\w/];function n(e){var t=r.value,n=t.length,a=function(){var e=0;{var t;document.selection?(r.focus(),(t=document.selection.createRange()).moveStart("character",-r.value.length),e=t.text.length):!r.selectionStart&&"0"!=r.selectionStart||(e=r.selectionStart)}return e}();s.innerHTML="",e&&"("===t.slice(a-1,a)&&57===e.which&&(t=t.slice(0,a)+")"+t.slice(a,n),e.target.value=t,n++,d(a)),e&&")"===t.slice(a-1,a)&&48===e.which&&")"===t.slice(a,a+1)&&(t=t.slice(0,a-1)+t.slice(a,n),e.target.value=t,n--,d(a)),s.appendChild(v("",0===a?"cursor":"empty"));for(var c=0;c<n;c++){let e=t[c];c+1<n&&/pi/i.test(e+t[c+1])?e+=t[c+1]:1<c&&/pi/i.test(t[c-1]+e)&&(e=t[c-1]+e);var i=function(e){for(var t=0;t<l.length;t++)if(l[t].test(e))return o[t]}(e),i=v(t[c],i);a===c+1&&(i=u(i,"cursor")),s.appendChild(i)}f()}function d(e){var t;r.setSelectionRange?(r.focus(),r.setSelectionRange(e,e)):r.createTextRange&&((t=r.createTextRange()).collapse(!0),t.moveEnd("character",e),t.moveStart("character",e),t.select())}function u(e,t){return e.classList.add(t),e}function v(e,t){var n=document.createElement("div");return n.innerHTML=e,n.classList.add("mb"),n.classList.add(t),n.addEventListener("click",a),n}function f(){r.focus()}function a(e){var e=e.target,t=document.getElementsByClassName("cursor")[0];t&&t.classList.remove("cursor"),u(e,"cursor"),d([].indexOf.call(e.parentNode.children,e)),f()}n(),s.addEventListener("mouseup",f),r.addEventListener("keyup",n),r.addEventListener("focus",function(){s.classList.remove("inactive"),u(s,"active")}),r.addEventListener("focusout",function(){s.classList.remove("active"),u(s,"inactive")})};var e=document.getElementById("mathinput"),t=e.parentNode;window.mathcode(e,t);