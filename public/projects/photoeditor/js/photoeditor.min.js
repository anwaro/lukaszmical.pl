function _$(t){return document.getElementById(t)}$photo=new function(){var t,a,r,e,n,i,h,o,s,g,d=[],f=50,l={},u="negatyw",c=null,v=!0,m=!1;function b(){if(h.files&&h.files[0]){var i=new FileReader;o=new Image,i.readAsDataURL(h.files[0])}i.onload=function(i){o.src=i.target.result,o.onload=function(){t.width=this.width,t.height=this.height,a.width=this.width,a.height=this.height,r.width=this.width,r.height=this.height,e.drawImage(o,0,0),n.drawImage(o,0,0),k()}}}function p(a){"true"===a.target.value?t.style.display="initial":t.style.display="none"}function w(t){m="true"===t.target.value}function M(t){f=parseInt(t.target.value),k()}function k(r){if(function(){s=m?n.getImageData(0,0,a.width,a.height):e.getImageData(0,0,t.width,t.height);var r=s.data,i=s.width,h=[];d=[];for(var o=0,g=0,f=0;o<r.length;o+=4)g=++f%i,h.push({r:r[o],g:r[o+1],b:r[o+2],a:r[o+3]}),g||(d.push(h),h=[])}(),r){for(var h=r.target;!h.classList.contains("edit")&&h.parentNode;)h=h.parentNode;var o=h.dataset.edit.split("-");u=o[0],c=o.length>1?o[1]:null}v=!0,l.hasOwnProperty(u)&&l[u](c),v&&function(){for(var t=0,a=0;t<s.height;t++)for(var r=0;r<s.width;r++)s.data[a]=d[t][r].r,s.data[a+1]=d[t][r].g,s.data[a+2]=d[t][r].b,s.data[a+3]=d[t][r].a,a+=4;i.putImageData(s,0,0),n.putImageData(s,0,0)}()}function y(t,a,r){r=r||!1;for(var e=0,n=0,i=0,h=Math.min(t+f,s.width),o=Math.min(a+f,s.height),g=0,l=a;l<o;l++)for(var u=t;u<h;u++)e+=d[l][u].r,n+=d[l][u].g,i+=d[l][u].b,g++;for(e=parseInt(e/g),n=parseInt(n/g),i=parseInt(i/g),l=a;l<o;l++)for(u=t;u<h;u++)d[l][u].r=e,d[l][u].g=n,d[l][u].b=i;if(r){var c=parseInt((e+n+i)/3);e=c,n=c,i=c}return"rgb( "+e+", "+n+", "+i+")"}function I(t){if(!(Math.sqrt(t.length)%2))return!1;var a,r=Math.sqrt(t.length),e=Math.floor(r/2),n=Math.abs(t.reduce((function(t,a){return t+a}),0)),i=JSON.parse(JSON.stringify(d));for(var h in n=n||1,t)t[h]/=n;var o=s.height-e,g=s.width-e;for(h=e;h<o;h++)for(var f=e;f<g;f++)a=$(f,h,t,i,e),d[h][f].r=a.r,d[h][f].g=a.g,d[h][f].b=a.b}function $(t,a,r,e,n){for(var i={r:0,g:0,b:0},h=a-n,o=0;h<a+n+1;h++)for(var s=t-n;s<t+n+1;s++)i.r+=r[o]*e[h][s].r,i.g+=r[o]*e[h][s].g,i.b+=r[o]*e[h][s].b,o++;return i}function x(t){t.r/=255,t.g/=255,t.b/=255;var a={h:0,s:0,v:0},r=Math.max(t.r,t.g,t.b),e=r-Math.min(t.r,t.g,t.b);for(0===e?a.h=0:t.r>Math.max(t.g,t.b)?a.h=(t.g-t.b)/e%6*60:t.g>Math.max(t.r,t.b)?a.h=60*((t.b-t.r)/e+2):a.h=60*((t.r-t.g)/e+4);a.h<0;)a.h+=360;return a.s=r?e/r:0,a.v=r,a}this.init=function(){if(t=_$("canvas-orginal"),a=_$("canvas-input"),r=_$("canvas-output"),h=_$("photo-choser-input"),g=_$("range"),t&&t.getContext){e=t.getContext("2d"),n=a.getContext("2d"),i=r.getContext("2d"),h.addEventListener("change",b),g.addEventListener("change",M),_$("orginal-show").addEventListener("mouseup",p),_$("photo-use").addEventListener("mouseup",w);for(var o=document.getElementsByClassName("edit"),s=0;s<o.length;s++)"object"==typeof o[s]&&o[s].addEventListener("click",k)}},l.negatyw=function(){for(var t=0;t<s.height;t++)for(var a=0;a<s.width;a++)d[t][a].g=255-d[t][a].g,d[t][a].r=255-d[t][a].r,d[t][a].b=255-d[t][a].b},l.szary=function(){for(var t,a=2.55*f,r=0;r<s.height;r++)for(var e=0;e<s.width;e++)t=(t=(d[r][e].r+d[r][e].g+d[r][e].b)/3-a)>255?255:t<0?0:t,d[r][e].g=t,d[r][e].r=t,d[r][e].b=t},l.sepia=function(){for(var t=.7*f,a=0;a<s.height-1;a++)for(var r=0;r<s.width-1;r++)d[a][r].g+=2*t,d[a][r].r+=t},l.kontur1=function(){for(var t=JSON.parse(JSON.stringify(d)),a=0;a<s.height-1;a++)for(var r=0;r<s.width-1;r++)d[a][r].r=Math.abs(t[a][r].r-t[a+1][r+1].r)+Math.abs(t[a+1][r].r-t[a][r+1].r),d[a][r].g=Math.abs(t[a][r].g-t[a+1][r+1].g)+Math.abs(t[a+1][r].g-t[a][r+1].g),d[a][r].b=Math.abs(t[a][r].b-t[a+1][r+1].b)+Math.abs(t[a+1][r].b-t[a][r+1].b)},l.kontur2=function(){for(var t,a,r=JSON.parse(JSON.stringify(d)),e=1;e<s.height-1;e++)for(var n=1;n<s.width-1;n++)t=r[e-1][n+1].r+2*r[e][n+1].r+r[e+1][n+1].r-(r[e-1][n-1].r+2*r[e][n-1].r+r[e+1][n-1].r),a=r[e+1][n-1].r+2*r[e+1][n].r+r[e+1][n+1].r-(r[e-1][n-1].r+2*r[e-1][n].r+r[e-1][n+1].r),d[e][n].r=Math.pow(t*t+a*a,.5),t=r[e-1][n+1].g+2*r[e][n+1].g+r[e+1][n+1].g-(r[e-1][n-1].g+2*r[e][n-1].g+r[e+1][n-1].g),a=r[e+1][n-1].g+2*r[e+1][n].g+r[e+1][n+1].g-(r[e-1][n-1].g+2*r[e-1][n].g+r[e-1][n+1].g),d[e][n].g=Math.pow(t*t+a*a,.5),t=r[e-1][n+1].b+2*r[e][n+1].b+r[e+1][n+1].b-(r[e-1][n-1].b+2*r[e][n-1].b+r[e+1][n-1].b),a=r[e+1][n-1].b+2*r[e+1][n].b+r[e+1][n+1].b-(r[e-1][n-1].b+2*r[e-1][n].b+r[e-1][n+1].b),d[e][n].b=Math.pow(t*t+a*a,.5)},l.progowanie=function(t){t=parseInt(t);for(var a,r=2.55*f,e=0;e<s.height;e++)for(var n=0;n<s.width;n++)a=(a=(d[e][n].r+d[e][n].g+d[e][n].b)/3)>r?0===t?a:255:2===t?a:0,d[e][n].g=a,d[e][n].r=a,d[e][n].b=a},l.randMask=function(){I(randomMask())},l.ownMask=function(t){t=Math.pow(parseInt(t),2);for(var a=[],r=1;r<=t;r++){var e=Number(_$("maskInput"+r).value);e||(e=0),a.push(e)}I(a)},l.akcent=function(){for(var t=function(){var t=_$("akcent").dataset.color;return t.substring(4,t.length-1).replace(/ /g,"").split(",")}(),a=x({r:t[0],g:t[1],b:t[2]}),r=2*f,e=(a.h-r/2+360)%360,n=(a.h+r/2+360)%360,i=e<=n,h=0;h<s.height;h++)for(var o=0;o<s.width;o++){var g=x($$.clone(d[h][o]));if(i&&g.h>e&&g.h<n||!i&&(g.h>e||g.h<n));else{var l=(d[h][o].r+d[h][o].g+d[h][o].b)/3;d[h][o].g=l,d[h][o].r=l,d[h][o].b=l}}},l.lab=function(){for(var t=255*Math.random(),a=255*Math.random(),r=255*Math.random(),e=0;e<s.height;e++)for(var n=0;n<s.width;n++)d[e][n].g=(d[e][n].g+t)%255,d[e][n].r=(d[e][n].r+a)%255,d[e][n].b=(d[e][n].b+r)%255},l.pixel=function(){for(var t=0;t<s.width;t+=f)for(var a=0;a<s.height;a+=f)y(t,a)},l.circle=function(){v=!1;var t=Math.max(f,5);i.clearRect(0,0,s.width,s.height);for(var r=0;r<s.width;r+=t)for(var e=0;e<s.height;e+=t)i.fillStyle=y(r,e),i.beginPath(),i.arc(r+.5*t,e+.5*t,.5*t,0,2*Math.PI,!0),i.closePath(),i.fill();n.putImageData(i.getImageData(0,0,a.width,a.height),0,0)},l.bit=function(){for(var t,a=0;a<s.height;a++)for(var r=0;r<s.width;r++)t=d[a][r],d[a][r].r=Math.round(t.r/f)*f,d[a][r].g=Math.round(t.g/f)*f,d[a][r].b=Math.round(t.b/f)*f},l.randpix=function(){for(var t=JSON.parse(JSON.stringify(d)),a=0;a<s.height;a++)for(var r=0;r<s.width;r++){var e=a+Math.floor(2*f*Math.random())-f,n=r+Math.floor(2*f*Math.random())-f;e<0&&(e+=s.height),n<0&&(n+=s.width),e>=s.height&&(e-=s.height),n>=s.width&&(n-=s.width);var i=t[e][n];d[a][r].r=i.r,d[a][r].g=i.g,d[a][r].b=i.b}}},colorpicker("akcent",(function(t,a){t.style.backgroundColor=a,t.dataset.color=a}));for(var mask=_$("mask-matrix"),i=0;i<25;i++){var element=document.createElement("input");element.id="maskInput"+(i+1),element.className="mask-input",mask.appendChild(element)}var maskshow=document.getElementsByClassName("maskshow");for(i=0;i<maskshow.length;i++)maskshow[i].addEventListener("click",(function(t){t.stopPropagation();var a=t.target.dataset.size;_$("mask-action").dataset.edit="ownMask-"+a,_$("mask-matrix").style.height=50*a+"px",_$("mask-matrix").style.width=50*a+"px",_$("mask").style.display="block"}));var switcher=document.getElementsByClassName("switcher");for(i=0;i<switcher.length;i++)switcher[i].addEventListener("mousedown",(function(t){var a=t.target;a.classList.contains("true")?(a.classList.remove("true"),a.classList.add("false"),a.value=!1):(a.classList.remove("false"),a.classList.add("true"),a.value=!0)}));document.addEventListener("click",(function(t){for(var a=document.getElementsByClassName("hide-child"),r=0;r<a.length;r++)-1===t.path.indexOf(a[r])&&(a[r].children[0].style.display="none");for(a=document.getElementsByClassName("hide"),r=0;r<a.length;r++)-1===t.path.indexOf(a[r])&&(a[r].style.display="none")})),$photo.init();