function y(t){return document.getElementById(t)}colorpicker=function(t,l){var g,c=document.getElementById(t),f=34,u=[150,50],t=".colorPicker{position:absolute;z-index:9999;bottom:-225px;height:225px;width:275px;background:#282828;display:none}.colorPickerArea{float: left;height:200px;width:200px;margin:12.5px}.colorPickerBar{float:left;height:155px;width:40px;margin-top:10px;}.colorPickerColor{height:40px; width:40px;margin-top:10px;float:left;}",e=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style"),r=(a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(document.createTextNode(t)),e.appendChild(a),L("div",{className:"colorPicker"})),n=L("canvas",{className:"colorPickerArea",height:200,width:200}),i=L("canvas",{className:"colorPickerBar",height:155,width:40}),t=L("canvas",{className:"colorPickerColor",height:40,width:40}),p=n.getContext("2d"),v=i.getContext("2d"),m=t.getContext("2d"),b=(r.appendChild(n),r.appendChild(i),r.appendChild(t),c.appendChild(r),function(){for(var t=[],e=10,a=0;a<260;a+=e)t.push([255,0,a]);for(a=250;0<a;a-=e)t.push([a,0,255]);for(a=0;a<260;a+=e)t.push([0,a,255]);for(a=255;0<a;a-=e)t.push([0,255,a]);for(a=0;a<260;a+=e)t.push([a,255,0]);for(a=255;0<a;a-=e)t.push([255,a,0]);return t}()),o=!1,h=!1;function s(t){var e=n.getBoundingClientRect();u[0]=parseInt(t.clientX-e.left),u[1]=parseInt(t.clientY-e.top),w()}function d(t){var e=i.getBoundingClientRect();f=parseInt(t.clientY-e.top),w()}function w(){v.clearRect(0,0,40,155);for(var t=0;t<b.length;t++)v.beginPath(),v.strokeStyle="rgb("+b[t][0]+", "+b[t][1]+", "+b[t][2]+")",v.lineWidth=1,v.moveTo(0,t),v.lineTo(40,t),v.stroke();var e,a,r,n=b[f],i=(255-n[0])/200,o=(255-n[1])/200,h=(255-n[2])/200;p.clearRect(0,0,200,200);for(var s=0;s<200;s++)for(var d=0;d<200;d++)p.beginPath(),e=255-s*i,e-=e*d/200,a=255-s*o,a-=a*d/200,r=255-s*h,r-=r*d/200,p.fillStyle="rgb("+parseInt(e)+", "+parseInt(a)+", "+parseInt(r)+")",p.fillRect(s,d,1,1);p.beginPath(),p.strokeStyle="rgb(100, 100, 100)",p.arc(u[0],u[1],5,0,2*Math.PI),p.stroke(),p.beginPath(),p.strokeStyle="rgb(255, 255, 255)",p.arc(u[0],u[1],6,0,2*Math.PI),p.stroke(),v.beginPath(),v.strokeStyle="rgb(0, 0, 0)",v.lineWidth=2,v.moveTo(0,f-2),v.lineTo(2,f),v.lineTo(38,f),v.lineTo(40,f+2),v.lineTo(40,f-2),v.lineTo(38,f),v.lineTo(2,f),v.lineTo(0,f+2),v.lineTo(0,f-2),v.stroke(),n=p.getImageData(u[0],u[1],1,1).data,g="rgb("+n[0]+","+n[1]+","+n[2]+")",m.beginPath(),m.fillStyle=g,m.fillRect(0,0,40,40),"function"==typeof l&&l(c,g)}function L(t,e){var a,r=document.createElement(t);for(a in e)r[a]=e[a];return r}c.addEventListener("click",function(t){r.style.display="block"}),n.addEventListener("click",s),i.addEventListener("click",d),r.addEventListener("focusout",function(){alert("ll"),r.style.display="none"}),n.addEventListener("mousedown",function(){o=!0}),i.addEventListener("mousedown",function(){h=!0}),n.addEventListener("mouseup",function(){o=!1}),i.addEventListener("mouseup",function(){h=!1}),n.addEventListener("mousemove",function(t){o&&s(t)}),i.addEventListener("mousemove",function(t){h&&d(t)}),n.addEventListener("mouseleave",function(){o=!1}),i.addEventListener("mouseleave",function(){h=!1}),document.addEventListener("click",function(t){if((t=t.target).isSameNode(c)||t.isSameNode(r)||t.parentNode.isSameNode(r))return!0;r.style.display="none"}),w()},$mask={USREDNIAJACY:[1,1,1,1,1,1,1,1,1],KWADRATOWY:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],KOLOWY:[0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0],LP1:[1,1,1,1,2,1,1,1,1],LP2:[1,1,1,1,4,1,1,1,1],LP3:[1,1,1,1,12,1,1,1,1],PIRAMIDALNY:[1,2,3,2,1,2,4,6,4,2,3,6,9,6,3,2,4,6,4,2,1,2,3,2,1],STOZKOWY:[0,0,1,0,0,0,2,2,2,0,1,2,5,2,1,0,2,2,2,0,0,0,1,0,0],GAUSS1:[1,2,1,2,4,2,1,2,1],GAUSS2:[1,1,2,1,1,1,2,4,2,1,2,4,8,4,2,1,2,4,2,1,1,1,2,1,1],GAUSS3:[0,1,2,1,0,1,4,8,4,1,2,8,16,8,2,1,4,8,4,1,0,1,2,1,0],GAUSS4:[1,4,7,4,1,4,16,26,16,4,7,26,41,26,7,4,26,16,26,4,1,4,7,4,1],GAUSS5:[1,1,2,2,2,1,1,1,2,2,4,2,2,1,2,2,4,8,4,2,2,2,4,8,16,8,4,2,2,2,4,8,4,2,2,1,2,2,4,2,2,1,1,1,2,2,2,1,1],USUN_SREDNIA:[-1,-1,-1,-1,9,-1,-1,-1,-1],HP1:[0,-1,0,-1,5,-1,0,-1,0],HP2:[1,-2,1,-2,5,-2,1,-2,1],HP3:[0,-1,0,-1,20,-1,0,-1,0],POZIOMY:[0,0,0,-1,1,0,0,0,0],PIONOWY:[0,-1,0,0,1,0,0,0,0],UKOSNY1:[-1,0,0,0,1,0,0,0,0],UKOSNY2:[0,0,-1,0,1,0,0,0,0],GRADIENT_E:[-1,1,1,-1,-2,1,-1,1,1],GRADIENT_SE:[-1,-1,1,-1,-2,1,1,1,1],GRADIENT_S:[-1,-1,-1,1,-2,1,1,1,1],GRADIENT_SW:[1,-1,-1,1,-2,-1,1,1,1],GRADIENT_W:[1,1,-1,1,-2,-1,1,1,-1],GRADIENT_NW:[1,1,1,1,-2,-1,1,-1,-1],GRADIENT_N:[1,1,1,1,-2,1,-1,-1,-1],GRADIENT_NE:[1,1,1,-1,-2,1,-1,-1,1],UWYPUKLAJACY_E:[-1,0,1,-1,1,1,-1,0,1],UWYPUKLAJACY_SE:[-1,-1,0,-1,1,1,0,1,1],UWYPUKLAJACY_S:[-1,-1,-1,0,1,0,1,1,1],UWYPUKLAJACY_SW:[0,-1,-1,1,1,-1,1,1,0],UWYPUKLAJACY_W:[1,0,-1,1,1,-1,1,0,-1],UWYPUKLAJACY_NW:[1,1,0,1,1,-1,0,-1,-1],UWYPUKLAJACY_N:[1,1,1,0,1,0,-1,-1,-1],UWYPUKLAJACY_NE:[0,1,1,-1,1,1,-1,-1,0],LAPL1:[0,-1,0,-1,4,-1,0,-1,0],LAPL2:[-1,-1,-1,-1,8,-1,-1,-1,-1],LAPL3:[1,-2,1,-2,4,-2,1,-2,1],LAPL_SKOSNY:[-1,0,-1,0,4,0,-1,0,-1],LAPL_PIONOWY:[0,-1,0,0,2,0,0,-1,0],LAPL_POZIOMY:[0,0,0,-1,2,-1,0,0,0],SOBEL_POZIOMY:[1,2,1,0,0,0,-1,-2,-1],SOBEL_PIONOWY:[1,0,-1,2,0,-2,1,0,-1],PREWITT_POZIOMY:[-1,-1,-1,0,0,0,1,1,1],PREWITT_PIONOWY:[1,0,-1,1,0,-1,1,0,-1]},$photo=new function(){var g,c,a,f,u,p,r,e,v,n,m=[],b=50,w={},L="negatyw",k=null,E=!0,I=!1;function i(){var t;r.files&&r.files[0]&&(t=new FileReader,e=new Image,t.readAsDataURL(r.files[0])),t.onload=function(t){e.src=t.target.result,e.onload=function(){g.width=this.width,g.height=this.height,c.width=this.width,c.height=this.height,a.width=this.width,a.height=this.height,f.drawImage(e,0,0),u.drawImage(e,0,0),d()}}}function o(t){"true"===t.target.value?g.style.display="initial":g.style.display="none"}function h(t){I="true"===t.target.value}function s(t){b=parseInt(t.target.value),d()}function d(t){var e=(v=I?u.getImageData(0,0,c.width,c.height):f.getImageData(0,0,g.width,g.height)).data,a=v.width,r=[];m=[];for(var n=0,i=0,o=0;n<e.length;n+=4)i=++o%a,r.push({r:e[n],g:e[n+1],b:e[n+2],a:e[n+3]}),i||(m.push(r),r=[]);if(t){for(var h=t.target;;){if(h.classList.contains("edit"))break;if(!h.parentNode)break;h=h.parentNode}t=h.dataset.edit.split("-");L=t[0],k=1<t.length?t[1]:null}if(E=!0,w.hasOwnProperty(L)&&w[L](k),E){for(var s=0,d=0;s<v.height;s++)for(var l=0;l<v.width;l++)v.data[d]=m[s][l].r,v.data[d+1]=m[s][l].g,v.data[d+2]=m[s][l].b,v.data[d+3]=m[s][l].a,d+=4;p.putImageData(v,0,0),u.putImageData(v,0,0)}}function l(t,e,a){a=a||!1;for(var r=0,n=0,i=0,o=Math.min(t+b,v.width),h=Math.min(e+b,v.height),s=0,d=e;d<h;d++)for(var l=t;l<o;l++)r+=m[d][l].r,n+=m[d][l].g,i+=m[d][l].b,s++;for(r=parseInt(r/s),n=parseInt(n/s),i=parseInt(i/s),d=e;d<h;d++)for(l=t;l<o;l++)m[d][l].r=r,m[d][l].g=n,m[d][l].b=i;return a&&(i=n=r=parseInt((r+n+i)/3)),"rgb( "+r+", "+n+", "+i+")"}function N(t){if(Math.sqrt(t.length)%2){var e,a=Math.sqrt(t.length),r=Math.floor(a/2),n=Math.abs(t.reduce(function(t,e){return t+e},0)),i=JSON.parse(JSON.stringify(m)),n=n||1;for(s in t)t[s]/=n;for(var o=v.height-r,h=v.width-r,s=r;s<o;s++)for(var d=r;d<h;d++)e=function(t,e,a,r,n){for(var i={r:0,g:0,b:0},o=e-n,h=0;o<e+n+1;o++)for(var s=t-n;s<t+n+1;s++)i.r+=a[h]*r[o][s].r,i.g+=a[h]*r[o][s].g,i.b+=a[h]*r[o][s].b,h++;return i}(d,s,t,i,r),m[s][d].r=e.r,m[s][d].g=e.g,m[s][d].b=e.b}}function P(t){t.r/=255,t.g/=255,t.b/=255;var e={h:0,s:0,v:0},a=Math.max(t.r,t.g,t.b),r=a-Math.min(t.r,t.g,t.b);for(0==r?e.h=0:t.r>Math.max(t.g,t.b)?e.h=(t.g-t.b)/r%6*60:t.g>Math.max(t.r,t.b)?e.h=60*((t.b-t.r)/r+2):e.h=60*((t.r-t.g)/r+4);e.h<0;)e.h+=360;return e.s=a?r/a:0,e.v=a,e}this.init=function(){if(g=y("canvas-orginal"),c=y("canvas-input"),a=y("canvas-output"),r=y("photo-choser-input"),n=y("range"),g&&g.getContext){f=g.getContext("2d"),u=c.getContext("2d"),p=a.getContext("2d"),r.addEventListener("change",i),n.addEventListener("change",s),y("orginal-show").addEventListener("mouseup",o),y("photo-use").addEventListener("mouseup",h);for(var t=document.getElementsByClassName("edit"),e=0;e<t.length;e++)"object"==typeof t[e]&&t[e].addEventListener("click",d)}},w.negatyw=function(){for(var t=0;t<v.height;t++)for(var e=0;e<v.width;e++)m[t][e].g=255-m[t][e].g,m[t][e].r=255-m[t][e].r,m[t][e].b=255-m[t][e].b},w.szary=function(){for(var t,e=2.55*b,a=0;a<v.height;a++)for(var r=0;r<v.width;r++)t=(m[a][r].r+m[a][r].g+m[a][r].b)/3-e,m[a][r].g=t=255<t?255:t<0?0:t,m[a][r].r=t,m[a][r].b=t},w.sepia=function(){for(var t=.7*b,e=0;e<v.height-1;e++)for(var a=0;a<v.width-1;a++)m[e][a].g+=2*t,m[e][a].r+=t},w.kontur1=function(){for(var t=JSON.parse(JSON.stringify(m)),e=0;e<v.height-1;e++)for(var a=0;a<v.width-1;a++)m[e][a].r=Math.abs(t[e][a].r-t[e+1][a+1].r)+Math.abs(t[e+1][a].r-t[e][a+1].r),m[e][a].g=Math.abs(t[e][a].g-t[e+1][a+1].g)+Math.abs(t[e+1][a].g-t[e][a+1].g),m[e][a].b=Math.abs(t[e][a].b-t[e+1][a+1].b)+Math.abs(t[e+1][a].b-t[e][a+1].b)},w.kontur2=function(){for(var t,e,a=JSON.parse(JSON.stringify(m)),r=1;r<v.height-1;r++)for(var n=1;n<v.width-1;n++)t=a[r-1][n+1].r+2*a[r][n+1].r+a[r+1][n+1].r-(a[r-1][n-1].r+2*a[r][n-1].r+a[r+1][n-1].r),e=a[r+1][n-1].r+2*a[r+1][n].r+a[r+1][n+1].r-(a[r-1][n-1].r+2*a[r-1][n].r+a[r-1][n+1].r),m[r][n].r=Math.pow(t*t+e*e,.5),t=a[r-1][n+1].g+2*a[r][n+1].g+a[r+1][n+1].g-(a[r-1][n-1].g+2*a[r][n-1].g+a[r+1][n-1].g),e=a[r+1][n-1].g+2*a[r+1][n].g+a[r+1][n+1].g-(a[r-1][n-1].g+2*a[r-1][n].g+a[r-1][n+1].g),m[r][n].g=Math.pow(t*t+e*e,.5),t=a[r-1][n+1].b+2*a[r][n+1].b+a[r+1][n+1].b-(a[r-1][n-1].b+2*a[r][n-1].b+a[r+1][n-1].b),e=a[r+1][n-1].b+2*a[r+1][n].b+a[r+1][n+1].b-(a[r-1][n-1].b+2*a[r-1][n].b+a[r-1][n+1].b),m[r][n].b=Math.pow(t*t+e*e,.5)},w.progowanie=function(t){t=parseInt(t);for(var e,a=2.55*b,r=0;r<v.height;r++)for(var n=0;n<v.width;n++)e=(m[r][n].r+m[r][n].g+m[r][n].b)/3,m[r][n].g=e=a<e?0===t?e:255:2===t?e:0,m[r][n].r=e,m[r][n].b=e},w.randMask=function(){var t;N((t=Object.keys($mask),$mask[t[t.length*Math.random()<<0]]))},w.ownMask=function(t){t=Math.pow(parseInt(t),2);for(var e=[],a=1;a<=t;a++){var r=(r=Number(y("maskInput"+a).value))||0;e.push(r)}N(e)},w.akcent=function(){for(var t=t=(t=y("akcent").dataset.color).substring(4,t.length-1).replace(/ /g,"").split(","),t=P({r:t[0],g:t[1],b:t[2]}),e=2*b,a=(t.h-e/2+360)%360,r=(t.h+e/2+360)%360,n=a<=r,i=0;i<v.height;i++)for(var o=0;o<v.width;o++){var h=P($$.clone(m[i][o]));n&&h.h>a&&h.h<r||!n&&(h.h>a||h.h<r)||(h=(m[i][o].r+m[i][o].g+m[i][o].b)/3,m[i][o].g=h,m[i][o].r=h,m[i][o].b=h)}},w.lab=function(){for(var t=255*Math.random(),e=255*Math.random(),a=255*Math.random(),r=0;r<v.height;r++)for(var n=0;n<v.width;n++)m[r][n].g=(m[r][n].g+t)%255,m[r][n].r=(m[r][n].r+e)%255,m[r][n].b=(m[r][n].b+a)%255},w.pixel=function(){for(var t=0;t<v.width;t+=b)for(var e=0;e<v.height;e+=b)l(t,e)},w.circle=function(){E=!1;var t=Math.max(b,5);p.clearRect(0,0,v.width,v.height);for(var e=0;e<v.width;e+=t)for(var a=0;a<v.height;a+=t)p.fillStyle=l(e,a),p.beginPath(),p.arc(e+.5*t,a+.5*t,.5*t,0,2*Math.PI,!0),p.closePath(),p.fill();u.putImageData(p.getImageData(0,0,c.width,c.height),0,0)},w.bit=function(){for(var t,e=0;e<v.height;e++)for(var a=0;a<v.width;a++)t=m[e][a],m[e][a].r=Math.round(t.r/b)*b,m[e][a].g=Math.round(t.g/b)*b,m[e][a].b=Math.round(t.b/b)*b},w.randpix=function(){for(var t=JSON.parse(JSON.stringify(m)),e=0;e<v.height;e++)for(var a=0;a<v.width;a++){var r=e+Math.floor(2*b*Math.random())-b,n=a+Math.floor(2*b*Math.random())-b,r=(r<0&&(r+=v.height),n<0&&(n+=v.width),r>=v.height&&(r-=v.height),v.width<=n&&(n-=v.width),t[r][n]);m[e][a].r=r.r,m[e][a].g=r.g,m[e][a].b=r.b}}},colorpicker("akcent",function(t,e){t.style.backgroundColor=e,t.dataset.color=e});for(var t=y("mask-matrix"),e=0;e<25;e++){var a=document.createElement("input");a.id="maskInput"+(e+1),a.className="mask-input",t.appendChild(a)}for(var r=document.getElementsByClassName("maskshow"),e=0;e<r.length;e++)r[e].addEventListener("click",function(t){t.stopPropagation();t=t.target.dataset.size;y("mask-action").dataset.edit="ownMask-"+t,y("mask-matrix").style.height=50*t+"px",y("mask-matrix").style.width=50*t+"px",y("mask").style.display="block"});for(var n=document.getElementsByClassName("switcher"),e=0;e<n.length;e++)n[e].addEventListener("mousedown",function(t){t=t.target;t.classList.contains("true")?(t.classList.remove("true"),t.classList.add("false"),t.value=!1):(t.classList.remove("false"),t.classList.add("true"),t.value=!0)});document.addEventListener("click",function(t){for(var e=document.getElementsByClassName("hide-child"),a=0;a<e.length;a++)-1===t.path?.indexOf(e[a])&&(e[a].children[0].style.display="none");for(e=document.getElementsByClassName("hide"),a=0;a<e.length;a++)-1===t.path?.indexOf(e[a])&&(e[a].style.display="none")}),$photo.init();