function randomMask(){var t=Object.keys($mask);return $mask[t[t.length*Math.random()<<0]]}function _$(t){return document.getElementById(t)}colorpicker=function(t,l){var g,c=document.getElementById(t),f=34,u=[150,50],t=".colorPicker{position:absolute;z-index:9999;bottom:-225px;height:225px;width:275px;background:#282828;display:none}.colorPickerArea{float: left;height:200px;width:200px;margin:12.5px}.colorPickerBar{float:left;height:155px;width:40px;margin-top:10px;}.colorPickerColor{height:40px; width:40px;margin-top:10px;float:left;}",e=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style"),r=(a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(document.createTextNode(t)),e.appendChild(a),k("div",{className:"colorPicker"})),n=k("canvas",{className:"colorPickerArea",height:200,width:200}),i=k("canvas",{className:"colorPickerBar",height:155,width:40}),t=k("canvas",{className:"colorPickerColor",height:40,width:40}),m=n.getContext("2d"),p=i.getContext("2d"),v=t.getContext("2d"),b=(r.appendChild(n),r.appendChild(i),r.appendChild(t),c.appendChild(r),function(){for(var t=[],e=10,a=0;a<260;a+=e)t.push([255,0,a]);for(a=250;0<a;a-=e)t.push([a,0,255]);for(a=0;a<260;a+=e)t.push([0,a,255]);for(a=255;0<a;a-=e)t.push([0,255,a]);for(a=0;a<260;a+=e)t.push([a,255,0]);for(a=255;0<a;a-=e)t.push([255,a,0]);return t}()),o=!1,s=!1;function h(t){var e=n.getBoundingClientRect();u[0]=parseInt(t.clientX-e.left),u[1]=parseInt(t.clientY-e.top),w()}function d(t){var e=i.getBoundingClientRect();f=parseInt(t.clientY-e.top),w()}function w(){p.clearRect(0,0,40,155);for(var t=0;t<b.length;t++)p.beginPath(),p.strokeStyle="rgb("+b[t][0]+", "+b[t][1]+", "+b[t][2]+")",p.lineWidth=1,p.moveTo(0,t),p.lineTo(40,t),p.stroke();var e,a,r,n=b[f],i=(255-n[0])/200,o=(255-n[1])/200,s=(255-n[2])/200;m.clearRect(0,0,200,200);for(var h=0;h<200;h++)for(var d=0;d<200;d++)m.beginPath(),e=255-h*i,e-=e*d/200,a=255-h*o,a-=a*d/200,r=255-h*s,r-=r*d/200,m.fillStyle="rgb("+parseInt(e)+", "+parseInt(a)+", "+parseInt(r)+")",m.fillRect(h,d,1,1);m.beginPath(),m.strokeStyle="rgb(100, 100, 100)",m.arc(u[0],u[1],5,0,2*Math.PI),m.stroke(),m.beginPath(),m.strokeStyle="rgb(255, 255, 255)",m.arc(u[0],u[1],6,0,2*Math.PI),m.stroke(),p.beginPath(),p.strokeStyle="rgb(0, 0, 0)",p.lineWidth=2,p.moveTo(0,f-2),p.lineTo(2,f),p.lineTo(38,f),p.lineTo(40,f+2),p.lineTo(40,f-2),p.lineTo(38,f),p.lineTo(2,f),p.lineTo(0,f+2),p.lineTo(0,f-2),p.stroke(),n=m.getImageData(u[0],u[1],1,1).data,g="rgb("+n[0]+","+n[1]+","+n[2]+")",v.beginPath(),v.fillStyle=g,v.fillRect(0,0,40,40),"function"==typeof l&&l(c,g)}function k(t,e){var a,r=document.createElement(t);for(a in e)r[a]=e[a];return r}c.addEventListener("click",function(t){r.style.display="block"}),n.addEventListener("click",h),i.addEventListener("click",d),r.addEventListener("focusout",function(){alert("ll"),r.style.display="none"}),n.addEventListener("mousedown",function(){o=!0}),i.addEventListener("mousedown",function(){s=!0}),n.addEventListener("mouseup",function(){o=!1}),i.addEventListener("mouseup",function(){s=!1}),n.addEventListener("mousemove",function(t){o&&h(t)}),i.addEventListener("mousemove",function(t){s&&d(t)}),n.addEventListener("mouseleave",function(){o=!1}),i.addEventListener("mouseleave",function(){s=!1}),document.addEventListener("click",function(t){if((t=t.target).isSameNode(c)||t.isSameNode(r)||t.parentNode.isSameNode(r))return!0;r.style.display="none"}),w()},$mask={USREDNIAJACY:[1,1,1,1,1,1,1,1,1],KWADRATOWY:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],KOLOWY:[0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0],LP1:[1,1,1,1,2,1,1,1,1],LP2:[1,1,1,1,4,1,1,1,1],LP3:[1,1,1,1,12,1,1,1,1],PIRAMIDALNY:[1,2,3,2,1,2,4,6,4,2,3,6,9,6,3,2,4,6,4,2,1,2,3,2,1],STOZKOWY:[0,0,1,0,0,0,2,2,2,0,1,2,5,2,1,0,2,2,2,0,0,0,1,0,0],GAUSS1:[1,2,1,2,4,2,1,2,1],GAUSS2:[1,1,2,1,1,1,2,4,2,1,2,4,8,4,2,1,2,4,2,1,1,1,2,1,1],GAUSS3:[0,1,2,1,0,1,4,8,4,1,2,8,16,8,2,1,4,8,4,1,0,1,2,1,0],GAUSS4:[1,4,7,4,1,4,16,26,16,4,7,26,41,26,7,4,26,16,26,4,1,4,7,4,1],GAUSS5:[1,1,2,2,2,1,1,1,2,2,4,2,2,1,2,2,4,8,4,2,2,2,4,8,16,8,4,2,2,2,4,8,4,2,2,1,2,2,4,2,2,1,1,1,2,2,2,1,1],USUN_SREDNIA:[-1,-1,-1,-1,9,-1,-1,-1,-1],HP1:[0,-1,0,-1,5,-1,0,-1,0],HP2:[1,-2,1,-2,5,-2,1,-2,1],HP3:[0,-1,0,-1,20,-1,0,-1,0],POZIOMY:[0,0,0,-1,1,0,0,0,0],PIONOWY:[0,-1,0,0,1,0,0,0,0],UKOSNY1:[-1,0,0,0,1,0,0,0,0],UKOSNY2:[0,0,-1,0,1,0,0,0,0],GRADIENT_E:[-1,1,1,-1,-2,1,-1,1,1],GRADIENT_SE:[-1,-1,1,-1,-2,1,1,1,1],GRADIENT_S:[-1,-1,-1,1,-2,1,1,1,1],GRADIENT_SW:[1,-1,-1,1,-2,-1,1,1,1],GRADIENT_W:[1,1,-1,1,-2,-1,1,1,-1],GRADIENT_NW:[1,1,1,1,-2,-1,1,-1,-1],GRADIENT_N:[1,1,1,1,-2,1,-1,-1,-1],GRADIENT_NE:[1,1,1,-1,-2,1,-1,-1,1],UWYPUKLAJACY_E:[-1,0,1,-1,1,1,-1,0,1],UWYPUKLAJACY_SE:[-1,-1,0,-1,1,1,0,1,1],UWYPUKLAJACY_S:[-1,-1,-1,0,1,0,1,1,1],UWYPUKLAJACY_SW:[0,-1,-1,1,1,-1,1,1,0],UWYPUKLAJACY_W:[1,0,-1,1,1,-1,1,0,-1],UWYPUKLAJACY_NW:[1,1,0,1,1,-1,0,-1,-1],UWYPUKLAJACY_N:[1,1,1,0,1,0,-1,-1,-1],UWYPUKLAJACY_NE:[0,1,1,-1,1,1,-1,-1,0],LAPL1:[0,-1,0,-1,4,-1,0,-1,0],LAPL2:[-1,-1,-1,-1,8,-1,-1,-1,-1],LAPL3:[1,-2,1,-2,4,-2,1,-2,1],LAPL_SKOSNY:[-1,0,-1,0,4,0,-1,0,-1],LAPL_PIONOWY:[0,-1,0,0,2,0,0,-1,0],LAPL_POZIOMY:[0,0,0,-1,2,-1,0,0,0],SOBEL_POZIOMY:[1,2,1,0,0,0,-1,-2,-1],SOBEL_PIONOWY:[1,0,-1,2,0,-2,1,0,-1],PREWITT_POZIOMY:[-1,-1,-1,0,0,0,1,1,1],PREWITT_PIONOWY:[1,0,-1,1,0,-1,1,0,-1]},$photo=new function(){var g,c,a,f,u,m,r,e,p,n,v=[],b=50,w={},k="negatyw",L=null,E=!0,I=!1;function i(){var t;r.files&&r.files[0]&&(t=new FileReader,e=new Image,t.readAsDataURL(r.files[0])),t.onload=function(t){e.src=t.target.result,e.onload=function(){g.width=this.width,g.height=this.height,c.width=this.width,c.height=this.height,a.width=this.width,a.height=this.height,f.drawImage(e,0,0),u.drawImage(e,0,0),d()}}}function o(t){"true"===t.target.value?g.style.display="initial":g.style.display="none"}function s(t){I="true"===t.target.value}function h(t){b=parseInt(t.target.value),d()}function d(t){var e=(p=I?u.getImageData(0,0,c.width,c.height):f.getImageData(0,0,g.width,g.height)).data,a=p.width,r=[];v=[];for(var n=0,i=0,o=0;n<e.length;n+=4)i=++o%a,r.push({r:e[n],g:e[n+1],b:e[n+2],a:e[n+3]}),i||(v.push(r),r=[]);if(t){for(var s=t.target;;){if(s.classList.contains("edit"))break;if(!s.parentNode)break;s=s.parentNode}t=s.dataset.edit.split("-");k=t[0],L=1<t.length?t[1]:null}if(E=!0,w.hasOwnProperty(k)&&w[k](L),E){for(var h=0,d=0;h<p.height;h++)for(var l=0;l<p.width;l++)p.data[d]=v[h][l].r,p.data[d+1]=v[h][l].g,p.data[d+2]=v[h][l].b,p.data[d+3]=v[h][l].a,d+=4;m.putImageData(p,0,0),u.putImageData(p,0,0)}}function l(t,e,a){a=a||!1;for(var r=0,n=0,i=0,o=Math.min(t+b,p.width),s=Math.min(e+b,p.height),h=0,d=e;d<s;d++)for(var l=t;l<o;l++)r+=v[d][l].r,n+=v[d][l].g,i+=v[d][l].b,h++;for(r=parseInt(r/h),n=parseInt(n/h),i=parseInt(i/h),d=e;d<s;d++)for(l=t;l<o;l++)v[d][l].r=r,v[d][l].g=n,v[d][l].b=i;return a&&(i=n=r=parseInt((r+n+i)/3)),"rgb( "+r+", "+n+", "+i+")"}function N(t){if(Math.sqrt(t.length)%2){var e,a=Math.sqrt(t.length),r=Math.floor(a/2),n=Math.abs(t.reduce(function(t,e){return t+e},0)),i=JSON.parse(JSON.stringify(v)),n=n||1;for(h in t)t[h]/=n;for(var o=p.height-r,s=p.width-r,h=r;h<o;h++)for(var d=r;d<s;d++)e=function(t,e,a,r,n){for(var i={r:0,g:0,b:0},o=e-n,s=0;o<e+n+1;o++)for(var h=t-n;h<t+n+1;h++)i.r+=a[s]*r[o][h].r,i.g+=a[s]*r[o][h].g,i.b+=a[s]*r[o][h].b,s++;return i}(d,h,t,i,r),v[h][d].r=e.r,v[h][d].g=e.g,v[h][d].b=e.b}}function P(t){t.r/=255,t.g/=255,t.b/=255;var e={h:0,s:0,v:0},a=Math.max(t.r,t.g,t.b),r=a-Math.min(t.r,t.g,t.b);for(0==r?e.h=0:t.r>Math.max(t.g,t.b)?e.h=(t.g-t.b)/r%6*60:t.g>Math.max(t.r,t.b)?e.h=60*((t.b-t.r)/r+2):e.h=60*((t.r-t.g)/r+4);e.h<0;)e.h+=360;return e.s=a?r/a:0,e.v=a,e}this.init=function(){if(g=_$("canvas-orginal"),c=_$("canvas-input"),a=_$("canvas-output"),r=_$("photo-choser-input"),n=_$("range"),g&&g.getContext){f=g.getContext("2d"),u=c.getContext("2d"),m=a.getContext("2d"),r.addEventListener("change",i),n.addEventListener("change",h),_$("orginal-show").addEventListener("mouseup",o),_$("photo-use").addEventListener("mouseup",s);for(var t=document.getElementsByClassName("edit"),e=0;e<t.length;e++)"object"==typeof t[e]&&t[e].addEventListener("click",d)}},w.negatyw=function(){for(var t=0;t<p.height;t++)for(var e=0;e<p.width;e++)v[t][e].g=255-v[t][e].g,v[t][e].r=255-v[t][e].r,v[t][e].b=255-v[t][e].b},w.szary=function(){for(var t,e=2.55*b,a=0;a<p.height;a++)for(var r=0;r<p.width;r++)t=(v[a][r].r+v[a][r].g+v[a][r].b)/3-e,v[a][r].g=t=255<t?255:t<0?0:t,v[a][r].r=t,v[a][r].b=t},w.sepia=function(){for(var t=.7*b,e=0;e<p.height-1;e++)for(var a=0;a<p.width-1;a++)v[e][a].g+=2*t,v[e][a].r+=t},w.kontur1=function(){for(var t=JSON.parse(JSON.stringify(v)),e=0;e<p.height-1;e++)for(var a=0;a<p.width-1;a++)v[e][a].r=Math.abs(t[e][a].r-t[e+1][a+1].r)+Math.abs(t[e+1][a].r-t[e][a+1].r),v[e][a].g=Math.abs(t[e][a].g-t[e+1][a+1].g)+Math.abs(t[e+1][a].g-t[e][a+1].g),v[e][a].b=Math.abs(t[e][a].b-t[e+1][a+1].b)+Math.abs(t[e+1][a].b-t[e][a+1].b)},w.kontur2=function(){for(var t,e,a=JSON.parse(JSON.stringify(v)),r=1;r<p.height-1;r++)for(var n=1;n<p.width-1;n++)t=a[r-1][n+1].r+2*a[r][n+1].r+a[r+1][n+1].r-(a[r-1][n-1].r+2*a[r][n-1].r+a[r+1][n-1].r),e=a[r+1][n-1].r+2*a[r+1][n].r+a[r+1][n+1].r-(a[r-1][n-1].r+2*a[r-1][n].r+a[r-1][n+1].r),v[r][n].r=Math.pow(t*t+e*e,.5),t=a[r-1][n+1].g+2*a[r][n+1].g+a[r+1][n+1].g-(a[r-1][n-1].g+2*a[r][n-1].g+a[r+1][n-1].g),e=a[r+1][n-1].g+2*a[r+1][n].g+a[r+1][n+1].g-(a[r-1][n-1].g+2*a[r-1][n].g+a[r-1][n+1].g),v[r][n].g=Math.pow(t*t+e*e,.5),t=a[r-1][n+1].b+2*a[r][n+1].b+a[r+1][n+1].b-(a[r-1][n-1].b+2*a[r][n-1].b+a[r+1][n-1].b),e=a[r+1][n-1].b+2*a[r+1][n].b+a[r+1][n+1].b-(a[r-1][n-1].b+2*a[r-1][n].b+a[r-1][n+1].b),v[r][n].b=Math.pow(t*t+e*e,.5)},w.progowanie=function(t){t=parseInt(t);for(var e,a=2.55*b,r=0;r<p.height;r++)for(var n=0;n<p.width;n++)e=(v[r][n].r+v[r][n].g+v[r][n].b)/3,v[r][n].g=e=a<e?0===t?e:255:2===t?e:0,v[r][n].r=e,v[r][n].b=e},w.randMask=function(){N(randomMask())},w.ownMask=function(t){t=Math.pow(parseInt(t),2);for(var e=[],a=1;a<=t;a++){var r=(r=Number(_$("maskInput"+a).value))||0;e.push(r)}N(e)},w.akcent=function(){for(var t=t=(t=_$("akcent").dataset.color).substring(4,t.length-1).replace(/ /g,"").split(","),t=P({r:t[0],g:t[1],b:t[2]}),e=2*b,a=(t.h-e/2+360)%360,r=(t.h+e/2+360)%360,n=a<=r,i=0;i<p.height;i++)for(var o=0;o<p.width;o++){var s=P($$.clone(v[i][o]));n&&s.h>a&&s.h<r||!n&&(s.h>a||s.h<r)||(s=(v[i][o].r+v[i][o].g+v[i][o].b)/3,v[i][o].g=s,v[i][o].r=s,v[i][o].b=s)}},w.lab=function(){for(var t=255*Math.random(),e=255*Math.random(),a=255*Math.random(),r=0;r<p.height;r++)for(var n=0;n<p.width;n++)v[r][n].g=(v[r][n].g+t)%255,v[r][n].r=(v[r][n].r+e)%255,v[r][n].b=(v[r][n].b+a)%255},w.pixel=function(){for(var t=0;t<p.width;t+=b)for(var e=0;e<p.height;e+=b)l(t,e)},w.circle=function(){E=!1;var t=Math.max(b,5);m.clearRect(0,0,p.width,p.height);for(var e=0;e<p.width;e+=t)for(var a=0;a<p.height;a+=t)m.fillStyle=l(e,a),m.beginPath(),m.arc(e+.5*t,a+.5*t,.5*t,0,2*Math.PI,!0),m.closePath(),m.fill();u.putImageData(m.getImageData(0,0,c.width,c.height),0,0)},w.bit=function(){for(var t,e=0;e<p.height;e++)for(var a=0;a<p.width;a++)t=v[e][a],v[e][a].r=Math.round(t.r/b)*b,v[e][a].g=Math.round(t.g/b)*b,v[e][a].b=Math.round(t.b/b)*b},w.randpix=function(){for(var t=JSON.parse(JSON.stringify(v)),e=0;e<p.height;e++)for(var a=0;a<p.width;a++){var r=e+Math.floor(2*b*Math.random())-b,n=a+Math.floor(2*b*Math.random())-b,r=(r<0&&(r+=p.height),n<0&&(n+=p.width),r>=p.height&&(r-=p.height),p.width<=n&&(n-=p.width),t[r][n]);v[e][a].r=r.r,v[e][a].g=r.g,v[e][a].b=r.b}}},colorpicker("akcent",function(t,e){t.style.backgroundColor=e,t.dataset.color=e});for(var mask=_$("mask-matrix"),i=0;i<25;i++){var element=document.createElement("input");element.id="maskInput"+(i+1),element.className="mask-input",mask.appendChild(element)}for(var maskshow=document.getElementsByClassName("maskshow"),i=0;i<maskshow.length;i++)maskshow[i].addEventListener("click",function(t){t.stopPropagation();t=t.target.dataset.size;_$("mask-action").dataset.edit="ownMask-"+t,_$("mask-matrix").style.height=50*t+"px",_$("mask-matrix").style.width=50*t+"px",_$("mask").style.display="block"});for(var switcher=document.getElementsByClassName("switcher"),i=0;i<switcher.length;i++)switcher[i].addEventListener("mousedown",function(t){t=t.target;t.classList.contains("true")?(t.classList.remove("true"),t.classList.add("false"),t.value=!1):(t.classList.remove("false"),t.classList.add("true"),t.value=!0)});document.addEventListener("click",function(t){for(var e=document.getElementsByClassName("hide-child"),a=0;a<e.length;a++)-1===t.path.indexOf(e[a])&&(e[a].children[0].style.display="none");for(e=document.getElementsByClassName("hide"),a=0;a<e.length;a++)-1===t.path.indexOf(e[a])&&(e[a].style.display="none")}),$photo.init();