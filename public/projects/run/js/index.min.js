let a = [],
    t = [],
    r = {t: null, min: null, u: null},
    u = {i: null, o: null},
    i = {l: null, m: null},
    o = {min: null, u: null},
    m = {
        p: 0,
        timeout: 500,
        body: null,
        h: {top: null, v: null},
        style: null,
        k: -1,
        _: -1,
    };
function n(e) {
    var n,
        e = e.target;
    'td' === e.tagName.toLowerCase() &&
        ((n = e.cellIndex + 1),
        (e = e.parentNode.rowIndex + 1),
        n !== m._ || e !== m.k) &&
        1 < e &&
        1 < n &&
        (m.style.innerHTML = `.table-body .table-main table tr:nth-child(${e}) {
                    background-color: rgba(255, 255, 255, 0.7);
                    color: black;
                 }
                 .table-body .table-main table tr td:nth-child(${n}) { 
                     background-color: rgba(255, 255, 255, 0.7); 
                     color: black; 
                 }`);
}
function e() {
    (m.k = -1), (m._ = -1), (m.style.innerHTML = '');
}
function A() {
    if (2 === a.length) {
        m.p = W(m.timeout);
        let e, t, r;
        var n = [a[0].dataset.type, a[1].dataset.type],
            u = b(),
            i = k(),
            o = K(),
            c = J();
        if (P('period', 'distance', n)) {
            if (!d(o, c)) return;
            (r = 'pace'),
                (e = 'distance'),
                (t = 'period'),
                f(p(r, c, e, o, t)),
                s(c / o);
        } else if (P('period', 'pace', n)) {
            if (!d(o, i)) return;
            (r = 'distance'), (e = 'period'), (t = 'pace'), v(p(r, o, e, i, t));
        } else if (P('period', 'speed', n)) {
            if (!d(o, u)) return;
            (r = 'distance'), (e = 'period'), (t = 'speed'), v(p(r, o, e, u, t));
        } else if (P('distance', 'pace', n)) {
            if (!d(c, i)) return;
            (r = 'period'), (e = 'distance'), (t = 'pace'), l(p(r, c, e, i, t));
        } else {
            if (!P('distance', 'speed', n)) return;
            if (!d(c, u)) return;
            (r = 'period'), (e = 'distance'), (t = 'speed'), l(p(r, c, e, u, t));
        }
        setTimeout(function () {
            var n,
                u = e,
                i = t,
                o = r;
            if (W() > m.p) {
                (f = X(
                    u,
                    (function () {
                        var e = C(m.body.offsetWidth / 60 - 11 / 6) - 1;
                        return Math.min(10, Math.max(3, e));
                    })(),
                )),
                    (n = X(i, 20));
                {
                    var c = o,
                        a = f,
                        d = u,
                        l = n,
                        s = i;
                    let t,
                        r,
                        e = (function (n, t) {
                            let r = I('');
                            for (let e = 0; e < n.length; e++) r += I(h(t, n[e]));
                            return Y(r);
                        })(a, d);
                    for (let n = 0; n < l.length; n++) {
                        t = I(h(s, l[n]));
                        for (let e = 0; e < a.length; e++)
                            (r = p(c, a[e], d, l[n], s)), (t += I(h(c, r)));
                        e += Y(t);
                    }
                    m.body.innerHTML = e;
                }
                var o = u,
                    f = i;
                (m.h.top.innerHTML = label[o]), (m.h.v.innerHTML = label[f]);
            }
        }, m.timeout + 200);
    }
}
function d(e, n) {
    return 0 < e && 0 < n;
}
function p(e, n, t, r, u) {
    return 0 === n || 0 === r
        ? 0
        : 'pace' === e && 'distance' === t && 'period' === u
          ? F(n / r)
          : 'distance' === e && 'period' === t && 'pace' === u
            ? (n / r) * 1e3
            : 'distance' === e && 'period' === t && 'speed' === u
              ? n * r
              : 'period' === e && 'distance' === t && 'pace' === u
                ? (n * r) / 1e3
                : 'period' === e && 'distance' === t && 'speed' === u
                  ? n / r
                  : void 0;
}
function h(e, n) {
    var t;
    return 'period' === e
        ? (0 !== (t = E(n)).t ? t.t + ':' : '') + c(t.min) + ':' + c(t.u)
        : 'distance' === e
          ? (t = B(n)).i + 'km ' + (0 !== t.o ? t.o + 'm' : '')
          : 'speed' === e
            ? j(x(n), 3) + 'km/h'
            : 'pace' === e
              ? c((t = G(n)).min) + "':" + c(t.u) + '"'
              : void 0;
}
function c(e) {
    return (e = e < 10 ? '0' + e : e);
}
function l(e) {
    e = E(e);
    (r.t.value = e.t), (r.min.value = e.min), (r.u.value = e.u);
}
function s(e, n) {
    (n = n || !1)
        ? 'm_s' === n
            ? (i.m.value = N(e))
            : 'km_h' === n && (i.l.value = N(e))
        : ((i.m.value = N(e)), (i.l.value = N(x(e))));
}
function f(e) {
    e = G(e);
    (o.min.value = e.min), (o.u.value = e.u);
}
function v(e) {
    e = B(e);
    (u.i.value = e.i), (u.o.value = e.o);
}
function B(e) {
    let n = w(e / 1e3);
    return 1e3 === (e = C((e -= 1e3 * n))) && ((e = 0), n++), {i: n, o: e};
}
function E(e) {
    var n = w(e / 3600),
        t = w((e -= 3600 * n) / 60);
    return H({t: n, min: t, u: (e -= 60 * t)});
}
function G(e) {
    var n = w(e / 60);
    return H({t: 0, min: n, u: (e -= 60 * n)});
}
function H(e) {
    return (
        (e.u = C(e.u)),
        60 === e.u && ((e.u = 0), e.min++),
        60 === e.min && ((e.min = 0), e.t++),
        e
    );
}
function J() {
    return 1e3 * _(u.i) + _(u.o);
}
function b(e) {
    return _('m_s' === (e = e || 'm_s') ? i.m : i.l);
}
function K() {
    return 3600 * _(r.t) + 60 * _(r.min) + _(r.u);
}
function k() {
    return 60 * _(o.min) + _(o.u);
}
function _(e) {
    e = g(e.value);
    return isNaN(e) ? 0 : e;
}
function L(e, n, t) {
    return e[n] && e[n].dataset.type === t;
}
function O() {
    var e = this.dataset.type;
    let n;
    'distance' === e
        ? ((u.i.value = this.dataset.i), (u.o.value = this.dataset.o), (n = u.i))
        : 'pace' === e
          ? ((o.min.value = this.dataset.min),
            (o.u.value = this.dataset.u),
            (n = o.min))
          : 'period' === e
            ? ((r.t.value = this.dataset.t),
              (r.min.value = this.dataset.min),
              (r.u.value = this.dataset.u),
              (n = r.t))
            : 'speed' === e &&
              ((i.l.value = this.dataset.l),
              (i.m.value = this.dataset.m),
              (n = i.l)),
        M(n),
        y(n, 0);
}
function M(e) {
    var e = (function e(n, t) {
            let r = n.parentNode;
            if (r) return r.classList.contains(t) ? r : e(r, t);
            return null;
        })((e = e.target || e), 'input-area'),
        n = e.dataset.type,
        n = 'pace' === n ? 'speed' : 'speed' === n && 'pace',
        n =
            (n && (L(a, 1, n) && a.splice(1, 1), L(a, 0, n)) && a.splice(0, 1),
            e.classList.contains('active') || (e.classList.add('active'), a.push(e)),
            a.length - 2);
    0 < n && a.splice(0, n),
        e.dataset.type === a[0].dataset.type && (a = a.reverse());
    for (let e = 0; e < t.length; e++) t[e].classList.remove('active');
    for (let e = 0; e < a.length; e++) a[e].classList.add('active');
}
function Q(e) {
    e = e.keyCode || e.charCode;
    let n = this;
    if (38 === e) y(n, 1);
    else {
        if (40 !== e)
            return D(e, [46, 8, 9, 27, 13, 110, 188, 190])
                ? (setTimeout(function () {
                      y(n, 0);
                  }, 100),
                  !0)
                : (setTimeout(function () {
                      y(n, 0);
                  }, 100),
                  (48 <= e && e <= 57) || (96 <= e && e <= 105));
        y(n, -1);
    }
}
function y(n, t) {
    let e = n.value.replace(',', '.');
    if (
        ('.' !== e.slice(-1) &&
            ((e = g(e) + t), (t = T(n.dataset.max)), (e = e <= 0 ? 0 : e) >= t) &&
            (e = t),
        (n.value = e),
        n.dataset && n.dataset.hasOwnProperty('type'))
    ) {
        t = n.dataset.type;
        let e;
        's_km' === t
            ? s(0 === (n = k()) ? 0 : 1e3 / n)
            : 'km_h' === t
              ? (s((e = z(b('km_h'))), 'm_s'), f(F(e)))
              : 'm_s' === t && (s(x((e = b('m_s'))), 'km_h'), f(F(e)));
    }
    A();
}
function g(e) {
    return S(parseFloat(+e));
}
function S(e) {
    return isNaN(e) ? 0 : e;
}
function N(e) {
    var n;
    return (n = T(e) - g(e).toFixed(1)), Math.abs(n) < 0.1 ? T(e) : g(e).toFixed(1);
}
function T(e) {
    return S(parseInt(+e));
}
function w(e) {
    return Math.floor(e);
}
function C(e) {
    return Math.round(e);
}
function D(e, n) {
    return -1 !== n.indexOf(e);
}
function P(e, n, t) {
    return D(e, t) && D(n, t);
}
function U(e) {
    return Math.max.apply(null, e);
}
function V(e) {
    return Math.min.apply(null, e);
}
function $(e) {
    return e.sort(function (e, n) {
        return e - n;
    });
}
function x(e) {
    return 3.6 * e;
}
function z(e) {
    return e / 3.6;
}
function F(e) {
    return 0 === e ? 0 : 1e3 / e;
}
function W(e) {
    return (e = e || 0), new Date().getTime() + e;
}
function X(n, t) {
    var e, r, u;
    if ('period' === n)
        return (
            (r = K()),
            (e = t),
            (u = R((u = 60 * C(r / 60)), 30 * e, e, 10, 2e6)),
            D(r, u) || u.push(r),
            $(u)
        );
    if ('pace' === n) return R(k(), t / 2, t, 120, 600);
    if ('speed' !== n)
        return 'distance' === n
            ? ((e = J()),
              (r = t),
              (u = [21097, 42195]),
              V((n = R((n = 1e3 * C(e / 1e3)), 500 * r, r, 1e3, 2e5))) < u[0] &&
                  u[0] < U(n) &&
                  n.push(u[0]),
              V(n) < u[1] && u[1] < U(n) && n.push(u[1]),
              D(e, n) || n.push(e),
              $(n))
            : void 0;
    {
        n = b('km_h');
        let e = R(n, t / 4, t, 1, 30);
        (e = e.map(z)), D(z(n), e) || e.push(z(n));
        return $(e);
    }
}
function Y(e) {
    return '<tr>' + e + '</tr>';
}
function I(e) {
    return '<td>' + e + '</td>';
}
function R(e, n, t, r, u) {
    e = j((e = u < (e = e < r ? r : e) ? u : e));
    var r = Math.max(e - n, r),
        i = j(((o = Math.min(e + n, u)) - r) / t),
        r = e - T((e - r) / i) * i,
        o = e + T((o - e) / i) * i,
        c = [];
    for (let e = r; e <= o; e += i) c.push(j(e, 5));
    return c;
}
function j(e, n) {
    (n = n - 1 || 1), (e = g(e));
    let t = 0;
    for (; e < Math.pow(10, n); ) (e *= 10), t++;
    return Math.round(e) / Math.pow(10, t);
}
(label = {M: 'Czas', speed: 'Prędkość', g: 'Tempo', N: 'Dystans'}),
    (m.style = document.createElement('style')),
    document.head.appendChild(m.style);
var q = document.getElementsByTagName('input');
for (let e = 0; e < q.length; e++)
    'text' === q[e].type
        ? (q[e].addEventListener('keydown', Q), q[e].addEventListener('focus', M))
        : 'button' === q[e].type && q[e].addEventListener('click', O);
(r.t = document.getElementById('run-period-h')),
    (r.min = document.getElementById('run-period-m')),
    (r.u = document.getElementById('run-period-s')),
    (u.i = document.getElementById('run-distance-km')),
    (u.o = document.getElementById('run-distance-m')),
    (o.min = document.getElementById('run-pace-m')),
    (o.u = document.getElementById('run-pace-s')),
    (i.l = document.getElementById('run-speed-km-h')),
    (i.m = document.getElementById('run-speed-m-s')),
    (t = document.querySelectorAll('.input-area')),
    (m.body = document.getElementById('run-table-body')),
    (m.h.top = document.getElementById('run-table-header-top')),
    (m.h.v = document.getElementById('run-table-header-side'));
var Z = document.querySelectorAll('td');
for (let e = 0; e < Z.length; e++) Z[e].addEventListener('mouseover', n);
m.body.addEventListener('mouseleave', e),
    m.body.addEventListener('mousemove', n),
    (u.i.value = 10),
    (r.min.value = 45),
    M(u.i),
    M(r.min),
    y(r.min, 0);
