const DE=Math.PI/180,PI=Math.PI,PI4=Math.PI/4,PI2=Math.PI/2,D=3*Math.sqrt(3),rotateCubeAxis=new Vector(1,1,0),rotatePartAxis=new Vector(0,0,0),dragCube=new Vector,dragPart=new Vector;let canvas,ctx,rotateCubeAngle=0,rotatePartAngle=0,rotateEndAngle=0,rotateSpeed=0,angleStep=0,rotateCount=0,supportElipse=!1,canvasWidth=900,canvasHeight=600,centerX=canvasWidth/2,centerY=canvasHeight/2,scaleMax=0,scale=0;const radius=.3;let lineWidth=4;const shakeRepetCount=20;let shakeCount=0,shakeAngleEnd=0,shakeAngleStep=0,startFontSize=2*scale;const colors={red:"#BF1E2E",green:"#00A652",blue:"#303193",orange:"#F6941D",yellow:"#FFF100",white:"#FFFFFF",bg1:"#DADADA",bg2:"#848484",bg3:"#505050",line:"#282828",black:"#403F3F",bgGradient:null},mouse={pos:new Point,lazy:new Point,click:new Point,leftPress:!1,scrollPress:!1,rightPress:!1,inercion:!1,block:!1,animationProcess:!1,shakeProcess:!1,updateLazy:function(){this.lazy.x+=.3*(this.pos.x-this.lazy.x),this.lazy.y+=.3*(this.pos.y-this.lazy.y)},resetLazy:function(){this.lazy.set(this.pos)},update:function(){if(this.shakeProcess)return!1;if(this.updateLazy(),this.inercion&&this.pos.distance(this.lazy)<5&&(this.inercion=!1,mouse.leftPress?(mouse.animationProcess=!0,cube.calculateAngle(),cube.rotateAnimation()):mouse.scrollPress&&(cube.updatePosition(),mouse.scrollPress=!1,rotateCubeAngle=0)),this.scrollPress)dragCube.set(this.lazy.x-this.click.x,this.click.y-this.lazy.y),rotateCubeAxis.set(-dragCube.y,dragCube.x),rotateCubeAxis.norm(),rotateCubeAngle=dragCube.len()/100*rotateSpeed;else if(this.leftPress&&!this.animationProcess){const t=this.lazy.x-this.click.x,e=this.click.y-this.lazy.y;dragPart.set(t,e),rotatePartAngle=1===cube.dragDirection?e/70*rotateSpeed:2===cube.dragDirection?-e/70*rotateSpeed:3===cube.dragDirection?-t/70*rotateSpeed:t/70*rotateSpeed}}},rotateCubeMatrix=new RotateMatrix(new Vector,new Vector,new Vector),rotatePartMatrix=new RotateMatrix(new Vector,new Vector,new Vector),vertex1=new Vector(-3,3,3),vertex2=new Vector(3,3,3),vertex3=new Vector(3,-3,3),vertex4=new Vector(-3,-3,3),vertex5=new Vector(-3,3,-3),vertex6=new Vector(3,3,-3),vertex7=new Vector(3,-3,-3),vertex8=new Vector(-3,-3,-3),faceA=new Face(vertex1,vertex2,vertex3,vertex4,colors.blue,0),faceB=new Face(vertex2,vertex6,vertex7,vertex3,colors.green,1),faceC=new Face(vertex6,vertex5,vertex8,vertex7,colors.orange,2),faceD=new Face(vertex5,vertex1,vertex4,vertex8,colors.red,3),faceE=new Face(vertex5,vertex6,vertex2,vertex1,colors.white,4),faceF=new Face(vertex4,vertex3,vertex7,vertex8,colors.yellow,5),wallA=[faceA,createWall(vertex1,vertex3,colors.blue,0),new Neighbor(4,5,3,1,2)],wallB=[faceB,createWall(vertex2,vertex7,colors.green,1),new Neighbor(4,5,0,2,3)],wallC=[faceC,createWall(vertex6,vertex8,colors.orange,2),new Neighbor(4,5,1,3,0)],wallD=[faceD,createWall(vertex5,vertex4,colors.red,3),new Neighbor(4,5,2,0,1)],wallE=[faceE,createWall(vertex5,vertex2,colors.white,4),new Neighbor(2,0,3,1,5)],wallF=[faceF,createWall(vertex4,vertex7,colors.yellow,5),new Neighbor(0,2,3,1,4)];let cube=new Cube([wallA,wallB,wallC,wallD,wallE,wallF]);function mouseMove(t){if(mouse.inercion)return 1;const e=canvas.getBoundingClientRect();mouse.pos.set(t.clientX-e.left,t.clientY-e.top)}function canvasCursor(t){canvas.style.cursor=t}function mouseUp(t){mouse.leftPress&&0===t.button&&(mouse.inercion=!0,canvasCursor("default")),mouse.scrollPress&&1===t.button&&(mouse.inercion=!0,canvasCursor("default"))}function mouseDown(t){if(mouse.scrollPress||mouse.leftPress||mouse.rightPress||mouse.animationProcess||mouse.shakeProcess||mouse.inercion)return!1;const e=canvas.getBoundingClientRect();mouse.click.set(t.clientX-e.left,t.clientY-e.top),mouse.pos.set(t.clientX-e.left,t.clientY-e.top+1e-9),mouse.resetLazy(),0===t.button?(mouse.leftPress=!0,canvasCursor("move")):1===t.button&&(mouse.scrollPress=!0,canvasCursor("move"))}function touchStart(t){if(mouse.scrollPress||mouse.leftPress||mouse.rightPress||mouse.animationProcess||mouse.shakeProcess||mouse.inercion)return!1;const e=t.changedTouches[0],s=canvas.getBoundingClientRect();mouse.click.set(e.clientX-s.left,e.clientY-s.top),mouse.pos.set(e.clientX-s.left,e.clientY-s.top+1e-9),mouse.resetLazy();cube.activeElement(mouse.click)?mouse.leftPress=!0:mouse.scrollPress=!0}function touchMove(t){if(mouse.inercion)return 1;const e=t.changedTouches[0],s=canvas.getBoundingClientRect();mouse.pos.set(e.clientX-s.left,e.clientY-s.top),t.preventDefault()}function touchEnd(){(mouse.leftPress||mouse.scrollPress)&&(mouse.inercion=!0)}function draw(){ctx.fillStyle=colors.bgGradient,ctx.fillRect(0,0,canvasWidth,canvasHeight),rotateCubeMatrix.updateMatrix(rotateCubeAxis,rotateCubeAngle*DE),cube.rotateAll(rotateCubeMatrix),(mouse.leftPress||mouse.shakeProcess)&&(cube.activeElement(mouse.click),cube.rotatePart()),supportElipse&&cube.printShadow(),cube.fillFaces(),mouse.shakeProcess||mouse.update()}function testLog(){ctx.beginPath(),ctx.fillStyle="red",ctx.moveTo(mouse.click.x,mouse.click.y),ctx.lineTo(mouse.pos.x,mouse.pos.y),ctx.stroke()}function Cube(t){this.walls=t,this.showed=[],this.elementRotate=[],this.blackFill={fir:[],sec:[]},this.blackFillFace={id:-1,pid:-1},this.blackFace=new Face(new Vector,new Vector,new Vector,new Vector,colors.black),this.dragDirection=-1,this.faceNormal=-1,this.clickFacesIndex=-1,this.clickElementIndex=-1,this.moveTo=-1,this.extrema={min:new Vector,max:new Vector},this.shadow=new Vector,this.getFace=function(t){return this.walls[t][0]},this.getChild=function(t){return this.walls[t][1]},this.getNeigh=function(t){return this.walls[t][2]},this.normalPos=function(t){return parseInt("3421".split("")[t-1])},this.rotateAll=function(t){for(let e=0;e<this.walls.length;e++){this.walls[e][0].rotate(t);for(let s=0;s<this.walls[e][1].length;s++)this.walls[e][1][s].rotate(t)}},this.printEdge=function(){for(let t=0;t<this.walls.length;t++)for(let e=0;e<this.walls[t][1].length;e++)this.walls[t][1][e].printEdge()},this.updatePosition=function(){for(let t=0;t<this.walls.length;t++){this.walls[t][0].update();for(let e=0;e<this.walls[t][1].length;e++)this.walls[t][1][e].update()}},this.fillFaces=function(){if(-1===this.faceNormal){const s=this.nearestVertex();this.showed=[];for(var t=0;t<this.walls.length;t++){const i=this.walls[t][0];Math.max(i.v1.z,i.v2.z,i.v3.z,i.v4.z)+.1>s&&this.showed.push(t);for(var e=0;e<this.walls[t][1].length;e++)this.walls[t][1][e].fill(),this.walls[t][1][e].printEdge()}}else{let s=0;for(t=0;t<this.walls.length;t++)for(e=0;e<this.walls[t][1].length;e++)this.distance(this.walls[t][1][e].average())<2&&(this.walls[t][1][e].fill(),this.walls[t][1][e].printEdge(),this.blackFillCorr(this.walls[t][1][e],1.5));this.sort(),this.fillBlack();for(t=0;t<this.walls.length;t++)for(e=0;e<this.walls[t][1].length;e++)s=this.distance(this.walls[t][1][e].average()),s<3.5&&s>2&&(this.walls[t][1][e].fill(),this.walls[t][1][e].printEdge(),this.blackFillCorr(this.walls[t][1][e],3));this.sort(),this.fillBlack();for(t=0;t<this.walls.length;t++)for(e=0;e<this.walls[t][1].length;e++)this.distance(this.walls[t][1][e].average())>4&&(this.walls[t][1][e].fill(),this.walls[t][1][e].printEdge())}},this.fillBlack=function(){const t=this.blackFill.fir,e=this.blackFill.sec;this.blackFace.v1.set(t[0][0],t[0][1]),this.blackFace.v2.set(t[t.length-1][0],t[t.length-1][1]),this.blackFace.v3.set(e[e.length-1][0],e[e.length-1][1]),this.blackFace.v4.set(e[0][0],e[0][1]),this.blackFace.fill(colors.black),this.blackFace.printEdge(),this.blackFill={fir:[],sec:[]},this.blackFillFace.id=-1,this.blackFillFace.pid=-1},this.blackFillCorr=function(t,e){this.distance(t.v1)>e&&this.addToBlackFace(t,t.v1),this.distance(t.v2)>e&&this.addToBlackFace(t,t.v2),this.distance(t.v3)>e&&this.addToBlackFace(t,t.v3),this.distance(t.v4)>e&&this.addToBlackFace(t,t.v4)},this.addToBlackFace=function(t,e){-1===this.blackFillFace.id&&(this.blackFillFace.id=t.parentId,this.blackFillFace.pid=this.getNeigh(t.parentId).parall),this.blackFillFace.id===t.parentId?this.blackFill.fir.push([e.x,e.y]):this.blackFillFace.pid===t.parentId&&this.blackFill.sec.push([e.x,e.y])},this.sort=function(){const t=function(t,e){return t[0]<e[0]?-1:t[0]>e[0]?1:0},e=function(t,e){return t[1]<e[1]?-1:t[1]>e[1]?1:0};this.blackFill.fir.sort(t),this.blackFill.sec.sort(t),this.blackFill.fir[0][0]===this.blackFill.fir[this.blackFill.fir.length-1][0]&&(this.blackFill.fir.sort(e),this.blackFill.sec.sort(e))},this.distance=function(t){const e=this.getFace(this.faceNormal).normal.z<0?this.getNeigh(this.faceNormal).parall:this.faceNormal,s=this.getFace(e).normal,i=this.getFace(e).v1;return Math.abs(s.x*t.x+s.y*t.y+s.z*t.z+s.x*i.x+s.y*i.y+s.z*i.z)/Math.sqrt(s.x*s.x+s.y*s.y+s.z*s.z)},this.nearestVertex=function(){const t={x:-10,y:-10,z:-10},e={x:10,y:10,z:10};for(let s=0;s<this.walls.length;s++){const i=this.walls[s][0];t.x=Math.max(i.v1.x,i.v2.x,i.v3.x,i.v4.x,t.x),t.y=Math.max(i.v1.y,i.v2.y,i.v3.y,i.v4.y,t.y),t.z=Math.max(i.v1.z,i.v2.z,i.v3.z,i.v4.z,t.z),e.x=Math.min(i.v1.x,i.v2.x,i.v3.x,i.v4.x,e.x),e.y=Math.min(i.v1.y,i.v2.y,i.v3.y,i.v4.y,e.y),e.z=Math.min(i.v1.z,i.v2.z,i.v3.z,i.v4.z,e.z)}return this.extrema.max.setV(t),this.extrema.min.setV(e),this.extrema.max.z},this.rotatePart=function(){if(-1===this.dragDirection&&dragPart.len()>10){if(this.setDragDirection(),this.faceNormal=this.choseNormalFace(),-1!==this.faceNormal){const t=this.getFace(this.faceNormal),e=t.v1.toVector(t.v4);rotatePartAxis.setV(e.crossProduct(t.v1.toVector(t.v2))),rotatePartAxis.norm(),rotatePartMatrix.updateMatrix(rotatePartAxis,rotatePartAngle*DE),this.checkElementToRotate()}}else if(-1!==this.clickFacesIndex){rotatePartMatrix.updateMatrix(rotatePartAxis,rotatePartAngle*DE);for(let t=0;t<this.elementRotate.length;t++){const e=this.elementRotate[t];this.walls[e[0]][1][e[1]].rotate(rotatePartMatrix)}}},this.setDragDirection=function(){if(-1===this.clickFacesIndex)return!1;const t=this.getFace(this.clickFacesIndex),e=dragPart.angle2D(),s=t.horizontalVector.angle2D();let i=t.verticalVector.angle2D()-s;i=i<0?i+2*PI:i;const o=s+.5*i,n=o+PI2,a=o+2*PI2,r=o+3*PI2;this.isBetween(e,r,o)?this.moveTo=4:this.isBetween(e,o,n)?this.moveTo=1:this.isBetween(e,n,a)?this.moveTo=3:this.isBetween(e,a,r)&&(this.moveTo=2),this.isBetween(e,PI4,3*PI4)?this.dragDirection=1:this.isBetween(e,3*PI4,5*PI4)?this.dragDirection=3:this.isBetween(e,5*PI4,7*PI4)?this.dragDirection=2:this.dragDirection=4},this.isBetween=function(t,e,s){return e<0&&(e+=2*PI),e>2*PI&&(e-=2*PI),s<0&&(s+=2*PI),s>2*PI&&(s-=2*PI),e<=s?e<=t&&t<=s:e>s?e<t||t<s:void 0},this.checkElementToRotate=function(){let t=this.clickElementIndex;const e=this.clickFacesIndex,s=this.moveTo;this.elementRotate=[],-1!==[3,4].indexOf(s)&&e<4?this.pushZX(t):-1!==[1,2].indexOf(s)&&-1!==[0,2,4,5].indexOf(e)?(t=2===e?8-t:t,this.pushZY(t)):(4===e?t=[6,3,0,7,4,1,8,5,2].indexOf(t):3===e?t=8-t:5===e&&(t=[2,5,8,1,4,7,0,3,6].indexOf(t)),this.pushXY(t))},this.pushZX=function(t){const e=t>2?t>5?6:3:0,s=[0,1,2,3,0];t<3&&this.pushFace(4),t>5&&this.pushFace(5);for(let t=0;t<s.length;t++)this.pushGroup(s[t],e,e+1,e+2)},this.pushXY=function(t){const e=t%3;t%3==0&&this.pushFace(0),(t+1)%3==0&&this.pushFace(2),this.pushGroup(1,e,e+3,e+6),this.pushGroup(4,3*(2-e),3*(2-e)+1,3*(2-e)+2),this.pushGroup(3,8-e,5-e,2-e),this.pushGroup(5,3*e+2,3*e+1,3*e),this.pushGroup(1,e,e+3,e+6)},this.pushZY=function(t){const e=t%3;t%3==0&&this.pushFace(3),(t+1)%3==0&&this.pushFace(1),this.pushGroup(0,e,e+3,e+6),this.pushGroup(4,e,e+3,e+6),this.pushGroup(2,8-e,5-e,2-e),this.pushGroup(5,e,e+3,e+6),this.pushGroup(0,e,e+3,e+6)},this.pushGroup=function(t,e,s,i){this.elementRotate.push([t,e]),this.elementRotate.push([t,s]),this.elementRotate.push([t,i])},this.pushFace=function(t){for(let e=0;e<9;e++)this.elementRotate.push([t,e])},this.reset=function(){this.dragDirection=-1,this.faceNormal=-1,this.clickFacesIndex=-1,this.clickElementIndex=-1,this.moveTo=-1,this.elementRotate=[]},this.choseNormalFace=function(){return-1===this.clickFacesIndex?-1:this.getNeigh(this.clickFacesIndex).get(this.normalPos(this.moveTo))},this.activeFaceIndex=function(t){for(let e=0;e<this.showed.length;e++){const s=this.showed[e],i=this.walls[s][0];if(this.pointInideFace(i,t))return s}return-1},this.activeElement=function(t){if(-1!==this.clickElementIndex)return!0;if(this.clickFacesIndex=this.activeFaceIndex(t),-1===this.clickFacesIndex)return!1;const e=this.walls[this.clickFacesIndex][1];for(let s=0;s<e.length;s++)this.pointInideFace(e[s],t)&&(this.clickElementIndex=s);return!0},this.pointInideFace=function(t,e){const s={x:e.x,y:e.y},i={x:e.x+1e3,y:e.y};let o=this.lineIntersection(t.v1.ctxPos(),t.v2.ctxPos(),s,i);return o+=this.lineIntersection(t.v2.ctxPos(),t.v3.ctxPos(),s,i),o+=this.lineIntersection(t.v3.ctxPos(),t.v4.ctxPos(),s,i),o+=this.lineIntersection(t.v4.ctxPos(),t.v1.ctxPos(),s,i),o%2},this.lineIntersection=function(t,e,s,i){const o=e.x-t.x,n=e.y-t.y,a=i.x-s.x,r=i.y-s.y,c=(-n*(t.x-s.x)+o*(t.y-s.y))/(-a*n+o*r),l=(a*(t.y-s.y)-r*(t.x-s.x))/(-a*n+o*r);return c>=0&&c<=1&&l>=0&&l<=1?1:0},this.rotateAnimation=function(){-1===this.clickElementIndex?(mouse.animationProcess=!1,rotatePartAngle=rotateEndAngle,this.reset(),dragPart.set(0,0),mouse.leftPress=!1,rotateCubeAngle=0,rotatePartAngle=0):Math.abs(rotateEndAngle-rotatePartAngle)<1?(mouse.animationProcess=!1,rotatePartAngle=rotateEndAngle,this.transform(),this.reset(),dragPart.set(0,0),mouse.leftPress=!1,rotateCubeAngle=0,rotatePartAngle=0):mouse.animationProcess&&(rotatePartAngle+=angleStep,setTimeout((function(){cube.rotateAnimation()}),30))},this.calculateAngle=function(){let t=rotatePartAngle;for(;t<0;)t+=360;t%=360,rotateCount=Math.round(t/90),rotateEndAngle=90*Math.round(rotatePartAngle/90),angleStep=(rotateEndAngle-rotatePartAngle)/5},this.transform=function(){let t=this.clickElementIndex;const e=this.clickFacesIndex,s=this.moveTo;if(-1!==[3,4].indexOf(s)&&e<4)for(var i=0;i<rotateCount;i++)this.moveZX(t,3===this.moveTo);else if(-1!==[1,2].indexOf(s)&&-1!==[0,2,4,5].indexOf(e)){var o=1===s;o=2===e?!o:o,t=2===e?8-t:t;for(i=0;i<rotateCount;i++)this.moveZY(t,o)}else{o=1===s;4===e?(o=3===s,t=[6,3,0,7,4,1,8,5,2].indexOf(t)):3===e?(o=2===s,t=8-t):5===e&&(o=4===s,t=[2,5,8,1,4,7,0,3,6].indexOf(t));for(i=0;i<rotateCount;i++)this.moveXY(t,o)}},this.moveZX=function(t,e){let s=[null,null,null];const i=t>2?t>5?6:3:0,o=e?[0,1,2,3,0].reverse():[0,1,2,3,0];t<3&&this.rotateFace(4,e),t>5&&this.rotateFace(5,!e);for(let t=0;t<o.length;t++)s=this.replaceGroup(o[t],[i,i+1,i+2],s)},this.moveXY=function(t,e){let s=[null,null,null];const i=t%3;t%3==0&&this.rotateFace(0,!e),(t+1)%3==0&&this.rotateFace(2,e),e?(s=this.replaceGroup(1,[i,i+3,i+6],s),s=this.replaceGroup(4,[3*(2-i),3*(2-i)+1,3*(2-i)+2],s),s=this.replaceGroup(3,[8-i,5-i,2-i],s),s=this.replaceGroup(5,[3*i+2,3*i+1,3*i],s),s=this.replaceGroup(1,[i,i+3,i+6],s)):(s=this.replaceGroup(1,[i,i+3,i+6],s),s=this.replaceGroup(5,[3*i+2,3*i+1,3*i],s),s=this.replaceGroup(3,[8-i,5-i,2-i],s),s=this.replaceGroup(4,[3*(2-i),3*(2-i)+1,3*(2-i)+2],s),s=this.replaceGroup(1,[i,i+3,i+6],s))},this.moveZY=function(t,e){let s=[null,null,null];const i=t%3;t%3==0&&this.rotateFace(3,!e),(t+1)%3==0&&this.rotateFace(1,e),e?(s=this.replaceGroup(0,[i,i+3,i+6],s),s=this.replaceGroup(4,[i,i+3,i+6],s),s=this.replaceGroup(2,[8-i,5-i,2-i],s),s=this.replaceGroup(5,[i,i+3,i+6],s),s=this.replaceGroup(0,[i,i+3,i+6],s)):(s=this.replaceGroup(0,[i,i+3,i+6],s),s=this.replaceGroup(5,[i,i+3,i+6],s),s=this.replaceGroup(2,[8-i,5-i,2-i],s),s=this.replaceGroup(4,[i,i+3,i+6],s),s=this.replaceGroup(0,[i,i+3,i+6],s))},this.rotateFace=function(t,e){if(-1===t)return!1;const s=[0,2,8,6,0,2],i=[1,5,7,3,1,5],o=s.length;let n,a,r=null,c=null;for(let l=0;l<o-1;l++)n=e?s[l]:s[o-1-l],a=e?i[l]:i[o-1-l],r=this.replaceColor(t,n,r),c=this.replaceColor(t,a,c)},this.replaceGroup=function(t,e,s){return[this.replaceColor(t,e[0],s[0]),this.replaceColor(t,e[1],s[1]),this.replaceColor(t,e[2],s[2])]},this.replaceColor=function(t,e,s){const i=this.walls[t][1][e].color;return this.walls[t][1][e].color=s,i},this.setVariableToShake=function(t,e,s){this.clickFacesIndex=t,this.clickElementIndex=e,this.dragDirection=s,this.moveTo=s,this.faceNormal=this.choseNormalFace();const i=this.getFace(this.faceNormal),o=i.v1.toVector(i.v4),n=i.v1.toVector(i.v2),a=o.crossProduct(n);rotatePartAxis.setV(a),rotatePartAxis.norm(),rotatePartMatrix.updateMatrix(rotatePartAxis,rotatePartAngle*DE),this.checkElementToRotate()},this.printShadow=function(){const t=this.shadow.scale({x:0,y:-1.2*D,z:0}),e=this.extrema.max.x*scale,s=.1*this.extrema.max.z*scale;for(let i=0;i<20;i++)ctx.beginPath(),ctx.fillStyle="rgba(100, 100, 100, 0.1)",ctx.ellipse(t.x,t.y,e-i*e/25,s-i*s/25,0,0,2*PI,1),ctx.fill()}}function Face(t,e,s,i,o,n,a){this.v1=t,this.v2=e,this.v3=s,this.v4=i,this.verticalVector=new Vector(t.x-i.x,t.y-i.y,t.z-i.z),this.horizontalVector=new Vector(e.x-t.x,e.y-t.y,e.z-t.z),this.angle=0,this.color=o,this.id=n||0,this.parentId=a,this.show=!0,this.normal=new Vector,this.setNormal=function(){const t=this.v1.toVector(this.v4),e=this.v1.toVector(this.v2);this.normal.setV(t.crossProduct(e))},this.showToggle=function(){this.setNormal(),this.show=this.normal.z>0},this.average=function(){return{x:(this.v1.x+this.v2.x+this.v3.x+this.v4.x)/4,y:(this.v1.y+this.v2.y+this.v3.y+this.v4.y)/4,z:(this.v1.z+this.v2.z+this.v3.z+this.v4.z)/4}},this.rotate=function(s){this.v1.rotate(s),this.v2.rotate(s),this.v3.rotate(s),this.v4.rotate(s),this.verticalVector.set(t.x-i.x,t.y-i.y,t.z-i.z),this.horizontalVector.set(e.x-t.x,e.y-t.y,e.z-t.z),this.showToggle()},this.update=function(){this.v1.updatePos(),this.v2.updatePos(),this.v3.updatePos(),this.v4.updatePos()},this.printEdge=function(){this.show&&(ctx.beginPath(),ctx.strokeStyle=colors.line,ctx.lineWidth=lineWidth,ctx.lineCap="round",ctx.lineJoin="round",ctx.moveTo(this.v1.ctxPos().x,this.v1.ctxPos().y),ctx.lineTo(this.v2.ctxPos().x,this.v2.ctxPos().y),ctx.lineTo(this.v3.ctxPos().x,this.v3.ctxPos().y),ctx.lineTo(this.v4.ctxPos().x,this.v4.ctxPos().y),ctx.lineTo(this.v1.ctxPos().x,this.v1.ctxPos().y),ctx.stroke())},this.fill=function(t){this.show&&(ctx.beginPath(),ctx.fillStyle=t||colors.line,ctx.moveTo(this.v1.ctxPos().x,this.v1.ctxPos().y),ctx.lineTo(this.v2.ctxPos().x,this.v2.ctxPos().y),ctx.lineTo(this.v3.ctxPos().x,this.v3.ctxPos().y),ctx.lineTo(this.v4.ctxPos().x,this.v4.ctxPos().y),ctx.lineTo(this.v1.ctxPos().x,this.v1.ctxPos().y),ctx.fill(),t||this.fillRound())},this.fillRound=function(){const t=this.v2.subtract(this.v1),e=this.v3.subtract(this.v2),s=this.v4.subtract(this.v3),i=this.v1.subtract(this.v4),o=this.v4.add(i.multiply(.7)),n=this.v1.add(t.multiply(.3)),a=this.v1.add(t.multiply(.7)),r=this.v2.add(e.multiply(.3)),c=this.v2.add(e.multiply(.7)),l=this.v3.add(s.multiply(.3)),h=this.v3.add(s.multiply(.7)),u=this.v4.add(i.multiply(.3));ctx.beginPath(),ctx.fillStyle=this.calculateColor(),ctx.moveTo(n.ctxPos().x,n.ctxPos().y),ctx.lineTo(a.ctxPos().x,a.ctxPos().y),ctx.quadraticCurveTo(this.v2.ctxPos().x,this.v2.ctxPos().y,r.ctxPos().x,r.ctxPos().y),ctx.lineTo(c.ctxPos().x,c.ctxPos().y),ctx.quadraticCurveTo(this.v3.ctxPos().x,this.v3.ctxPos().y,l.ctxPos().x,l.ctxPos().y),ctx.lineTo(h.ctxPos().x,h.ctxPos().y),ctx.quadraticCurveTo(this.v4.ctxPos().x,this.v4.ctxPos().y,u.ctxPos().x,u.ctxPos().y),ctx.lineTo(o.ctxPos().x,o.ctxPos().y),ctx.quadraticCurveTo(this.v1.ctxPos().x,this.v1.ctxPos().y,n.ctxPos().x,n.ctxPos().y),ctx.fill()},this.calculateColor=function(){const t=this.horizontalVector,e=this.verticalVector,s=Math.abs(t.x*e.y-e.x*t.y)/8;return colorLuminance(this.color,s-.5)}}function Point(t,e,s){this.x=t||0,this.y=e||0,this.z=s||0,this.set=function(t,e,s){"number"==typeof t?(this.x=t||0,this.y=e||0,this.z=s||0):(this.x=t.x,this.y=t.y,this.z=t.z)},this.distance=function(t){return Math.sqrt(Math.pow(t.x-this.x,2)+Math.pow(t.y-this.y,2))}}function Vector(t,e,s){this.x=t||0,this.y=e||0,this.z=s||0,this.pos=new Point(t,e,s),this.angle2D=function(){const t=Math.atan2(this.y,this.x);return t>0?t:2*PI+t},this.ctxPos=function(){return this.scale(this)},this.scale=function(t){return{x:centerX+t.x*scale,y:centerY-t.y*scale}},this.rotate=function(t){this.setCurrentPos(t.dotProduct(this.pos))},this.len=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))},this.norm=function(){const t=this.len();this.x/=t,this.y/=t,this.z/=t},this.dotProduct=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},this.crossProduct=function(t){return new Vector(this.y*t.z-t.y*this.z,this.z*t.x-t.z*this.x,this.x*t.y-t.x*this.y)},this.set=function(t,e,s){this.x=t||0,this.y=e||0,this.z=s||0},this.setV=function(t){this.setCurrentPos(t)},this.setCurrentPos=function(t){this.x=t.x,this.y=t.y,this.z=t.z},this.setStartPoss=function(t){this.pos.x=t.x,this.pos.y=t.y,this.pos.z=t.z},this.updatePos=function(){this.pos.x=this.x,this.pos.y=this.y,this.pos.z=this.z},this.toVector=function(t){return new Vector(t.x-this.x,t.y-this.y,t.z-this.z)},this.add=function(t){return new Vector(t.x+this.x,t.y+this.y,t.z+this.z)},this.subtract=function(t){return new Vector(this.x-t.x,this.y-t.y,this.z-t.z)},this.multiply=function(t){return new Vector(t*this.x,t*this.y,t*this.z)},this.str=function(){return" x: "+this.x+" y: "+this.y+" z: "+this.z}}function Matrix(t,e,s){this.v1=t,this.v2=e,this.v3=s,this.result=new Point,this.dotProduct=function(t){return this.result.x=this.v1.x*t.x+this.v1.y*t.y+this.v1.z*t.z,this.result.y=this.v2.x*t.x+this.v2.y*t.y+this.v2.z*t.z,this.result.z=this.v3.x*t.x+this.v3.y*t.y+this.v3.z*t.z,this.result}}function RotateMatrix(t,e,s){Matrix.call(this,t,e,s),this.updateMatrix=function(t,e){const s=cos(e),i=sin(e),o=1-s,n=t.x,a=t.y,r=t.z;this.v1.set(o*n*n+s,o*n*a-r*i,o*n*r+a*i),this.v2.set(o*n*a+r*i,o*a*a+s,o*a*r-n*i),this.v3.set(o*n*r-a*i,o*a*r+n*i,o*r*r+s)}}function Neighbor(t,e,s,i,o){this.top=t,this.bottom=e,this.left=s,this.right=i,this.parall=o,this.get=function(t){return 1===t?this.top:2===t?this.bottom:3===t?this.left:4===t?this.right:void 0}}function createWall(t,e,s,i){const o=(e.x-t.x)/3,n=(e.y-t.y)/3,a=(e.z-t.z)/3,r=[];if(0===o)for(var c=0;c<3;c++)for(var l=0;l<3;l++){var h=new Vector(t.x,t.y+c*n,t.z+l*a),u=new Vector(t.x,t.y+c*n,t.z+(1+l)*a),x=new Vector(t.x,t.y+(1+c)*n,t.z+(1+l)*a),d=new Vector(t.x,t.y+(1+c)*n,t.z+l*a);r.push(new Face(h,u,x,d,s,3*c+l,i))}if(0===n)for(c=0;c<3;c++)for(l=0;l<3;l++){h=new Vector(t.x+l*o,t.y,t.z+c*a),u=new Vector(t.x+(1+l)*o,t.y,t.z+c*a),x=new Vector(t.x+(1+l)*o,t.y,t.z+(1+c)*a),d=new Vector(t.x+l*o,t.y,t.z+(1+c)*a);r.push(new Face(h,u,x,d,s||randomColor(),3*c+l,i))}if(0===a)for(c=0;c<3;c++)for(l=0;l<3;l++){h=new Vector(t.x+l*o,t.y+c*n,t.z),u=new Vector(t.x+(1+l)*o,t.y+c*n,t.z),x=new Vector(t.x+(1+l)*o,t.y+(1+c)*n,t.z),d=new Vector(t.x+l*o,t.y+(1+c)*n,t.z);r.push(new Face(h,u,x,d,s||randomColor(),3*c+l,i))}return r}function colorLuminance(t,e){(t=String(t).replace(/[^0-9a-f]/gi,"")).length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),e=e||0;let s,i,o="#";for(i=0;i<3;i++)s=parseInt(t.substr(2*i,2),16),s=Math.round(Math.min(Math.max(0,s+s*e),255)).toString(16),o+=("00"+s).substr(s.length);return o}function randomColor(){const t="0123456789ABCDEF".split("");let e="#";for(let s=0;s<6;s++)e+=t[Math.floor(16*Math.random())];return e}function cos(t){return Math.cos(t)}function sin(t){return Math.sin(t)}function hexToRgba(t,e){t=t.replace("#","");const s=parseInt(t,16);return"rgba("+(s>>16&255)+", "+(s>>8&255)+", "+(255&s)+", "+(e||1)+")"}function resize(){canvasHeight=window.innerHeight,canvasWidth=window.innerWidth,centerX=canvasWidth/2,centerY=canvasHeight/2,canvas.height=canvasHeight,canvas.width=canvasWidth,scale=Math.round(.08*(canvasHeight<canvasWidth?canvasHeight:canvasWidth)-6),scale=Math.min(Math.max(scale,5),55),colors.bgGradient=ctx.createLinearGradient(0,0,0,canvasHeight),colors.bgGradient.addColorStop(0,colors.bg1),colors.bgGradient.addColorStop(.66,colors.bg2),colors.bgGradient.addColorStop(.75,colors.bg3),colors.bgGradient.addColorStop(.85,colors.bg2),colors.bgGradient.addColorStop(1,colors.bg1),rotateSpeed=55/scale*36,startFontSize=4*scale,lineWidth=scale>40?4:scale>30?3:scale>20?2:1}function init(){canvas=document.getElementById("cubic"),ctx=canvas.getContext("2d"),"function"==typeof ctx.ellipse&&(supportElipse=!0),resize(),setInfoELement(),scaleMax=scale,scale=2,setInterval(draw,50),zoom()}function setInfoELement(){if("ontouchstart"in document.documentElement)document.getElementById("info").style.display="none";else{const t=.25*canvasWidth+"px",e=4/3.3*.25*canvasWidth+"px";document.getElementById("info").style.width=t,document.getElementById("info").style.height=e,document.getElementById("info").style.backgroundSize=t+" "+e}}function zoom(){scale<scaleMax?(rotateCubeAngle+=1,scale+=2,setTimeout(zoom,50)):(cube.updatePosition(),rotateCubeAngle=0,shake())}function shake(){if(shakeCount<20){shakeCount++;const t=randInt(1,4);shakeAngleEnd=90*t,shakeAngleStep=shakeAngleEnd/5,cube.setVariableToShake(randInt(0,6),randInt(0,9),randInt(1,5)),mouse.shakeProcess=!0,shakeRotate()}else mouse.shakeProcess=!1,start()}function shakeRotate(){Math.abs(rotatePartAngle-shakeAngleEnd)>1?(rotatePartAngle+=shakeAngleStep,setTimeout(shakeRotate,50)):(rotatePartAngle=shakeAngleEnd,cube.calculateAngle(),cube.transform(),cube.reset(),rotatePartAngle=0,setTimeout(shake,100))}function randInt(t,e){return Math.floor(Math.random()*(e-t))+t}function start(){document.getElementById("info").classList.add("hidden"),document.addEventListener("mouseup",mouseUp),document.addEventListener("touchmove",touchMove),canvas.addEventListener("mousedown",mouseDown),canvas.addEventListener("mouseup",mouseUp),canvas.addEventListener("mousemove",mouseMove),canvas.addEventListener("touchstart",touchStart),canvas.addEventListener("touchend",touchEnd),canvas.addEventListener("touchmove",touchMove)}RotateMatrix.prototype=Object.create(Matrix.prototype),RotateMatrix.prototype.constructor=RotateMatrix,window.addEventListener("resize",resize),init();