let DE=Math.PI/180,PI=Math.PI,PI4=Math.PI/4,PI2=Math.PI/2,D=3*Math.sqrt(3),rotateCubeAxis=new Vector(1,1,0),rotatePartAxis=new Vector(0,0,0),dragCube=new Vector,dragPart=new Vector,rotateCubeAngle=0,rotatePartAngle=0,rotateEndAngle=0,rotateSpeed=0,angleStep=0,rotateCount=0,supportEllipse=!1,canvas,ctx,canvasWidth=900,canvasHeight=600,centerX=canvasWidth/2,centerY=canvasHeight/2,scaleMax=0,scale=0,radius=.3,lineWidth=4,shakeRepetCount=20,shakeCount=0,shakeAngleEnd=0,shakeAngleStep=0,startFontSize=2*scale,colors={red:"#BF1E2E",green:"#00A652",blue:"#303193",orange:"#F6941D",yellow:"#FFF100",white:"#FFFFFF",bg1:"#DADADA",bg2:"#848484",bg3:"#505050",line:"#282828",black:"#403F3F",bgGradient:null},mouse={pos:new Point,lazy:new Point,click:new Point,leftPress:!1,scrollPress:!1,rightPress:!1,inercion:!1,block:!1,animationProcess:!1,shakeProcess:!1,updateLazy:function(){this.lazy.x+=.3*(this.pos.x-this.lazy.x),this.lazy.y+=.3*(this.pos.y-this.lazy.y)},resetLazy:function(){this.lazy.set(this.pos)},update:function(){if(this.shakeProcess)return!1;var t,e;this.updateLazy(),this.inercion&&this.pos.distance(this.lazy)<5&&(this.inercion=!1,mouse.leftPress?(mouse.animationProcess=!0,cube.calculateAngle(),cube.rotateAnimation()):mouse.scrollPress&&(cube.updatePosition(),mouse.scrollPress=!1,rotateCubeAngle=0)),this.scrollPress?(dragCube.set(this.lazy.x-this.click.x,this.click.y-this.lazy.y),rotateCubeAxis.set(-dragCube.y,dragCube.x),rotateCubeAxis.norm(),rotateCubeAngle=dragCube.len()/100*rotateSpeed):this.leftPress&&!this.animationProcess&&(t=this.lazy.x-this.click.x,e=this.click.y-this.lazy.y,dragPart.set(t,e),rotatePartAngle=1===cube.dragDirection?e/70*rotateSpeed:2===cube.dragDirection?-e/70*rotateSpeed:3===cube.dragDirection?-t/70*rotateSpeed:t/70*rotateSpeed)}},rotateCubeMatrix=new RotateMatrix(new Vector,new Vector,new Vector),rotatePartMatrix=new RotateMatrix(new Vector,new Vector,new Vector),vertex1=new Vector(-3,3,3),vertex2=new Vector(3,3,3),vertex3=new Vector(3,-3,3),vertex4=new Vector(-3,-3,3),vertex5=new Vector(-3,3,-3),vertex6=new Vector(3,3,-3),vertex7=new Vector(3,-3,-3),vertex8=new Vector(-3,-3,-3),faceA=new Face(vertex1,vertex2,vertex3,vertex4,colors.blue,0),faceB=new Face(vertex2,vertex6,vertex7,vertex3,colors.green,1),faceC=new Face(vertex6,vertex5,vertex8,vertex7,colors.orange,2),faceD=new Face(vertex5,vertex1,vertex4,vertex8,colors.red,3),faceE=new Face(vertex5,vertex6,vertex2,vertex1,colors.white,4),faceF=new Face(vertex4,vertex3,vertex7,vertex8,colors.yellow,5),wallA=[faceA,createWall(vertex1,vertex3,colors.blue,0),new Neighbor(4,5,3,1,2)],wallB=[faceB,createWall(vertex2,vertex7,colors.green,1),new Neighbor(4,5,0,2,3)],wallC=[faceC,createWall(vertex6,vertex8,colors.orange,2),new Neighbor(4,5,1,3,0)],wallD=[faceD,createWall(vertex5,vertex4,colors.red,3),new Neighbor(4,5,2,0,1)],wallE=[faceE,createWall(vertex5,vertex2,colors.white,4),new Neighbor(2,0,3,1,5)],wallF=[faceF,createWall(vertex4,vertex7,colors.yellow,5),new Neighbor(0,2,3,1,4)],cube=new Cube([wallA,wallB,wallC,wallD,wallE,wallF]);function mouseMove(t){if(mouse.inercion)return 1;var e=canvas.getBoundingClientRect();mouse.pos.set(t.clientX-e.left,t.clientY-e.top)}function canvasCursor(t){canvas.style.cursor=t}function mouseUp(t){mouse.leftPress&&0===t.button&&(mouse.inercion=!0,canvasCursor("default")),!mouse.scrollPress||1!==t.button&&2!==t.button||(mouse.inercion=!0,canvasCursor("default"))}function mouseDown(t){if(mouse.scrollPress||mouse.leftPress||mouse.rightPress||mouse.animationProcess||mouse.shakeProcess||mouse.inercion)return!1;t.preventDefault();var e=canvas.getBoundingClientRect();mouse.click.set(t.clientX-e.left,t.clientY-e.top),mouse.pos.set(t.clientX-e.left,t.clientY-e.top+1e-9),mouse.resetLazy(),0===t.button?(mouse.leftPress=!0,canvasCursor("move")):1!==t.button&&2!==t.button||(mouse.scrollPress=!0,canvasCursor("move"))}function touchStart(t){if(mouse.scrollPress||mouse.leftPress||mouse.rightPress||mouse.animationProcess||mouse.shakeProcess||mouse.inercion)return!1;var t=t.changedTouches[0],e=canvas.getBoundingClientRect(),t=(mouse.click.set(t.clientX-e.left,t.clientY-e.top),mouse.pos.set(t.clientX-e.left,t.clientY-e.top+1e-9),mouse.resetLazy(),cube.activeElement(mouse.click));t?mouse.leftPress=!0:mouse.scrollPress=!0}function touchMove(t){if(mouse.inercion)return 1;var e=t.changedTouches[0],s=canvas.getBoundingClientRect();mouse.pos.set(e.clientX-s.left,e.clientY-s.top),t.preventDefault()}function touchEnd(){(mouse.leftPress||mouse.scrollPress)&&(mouse.inercion=!0)}function draw(){ctx.fillStyle=colors.bgGradient,ctx.fillRect(0,0,canvasWidth,canvasHeight),rotateCubeMatrix.updateMatrix(rotateCubeAxis,rotateCubeAngle*DE),cube.rotateAll(rotateCubeMatrix),(mouse.leftPress||mouse.shakeProcess)&&(cube.activeElement(mouse.click),cube.rotatePart()),supportEllipse&&cube.printShadow(),cube.fillFaces(),mouse.shakeProcess||mouse.update()}function Cube(t){this.walls=t,this.showed=[],this.elementRotate=[],this.blackFill={fir:[],sec:[]},this.blackFillFace={id:-1,pid:-1},this.blackFace=new Face(new Vector,new Vector,new Vector,new Vector,colors.black),this.dragDirection=-1,this.faceNormal=-1,this.clickFacesIndex=-1,this.clickElementIndex=-1,this.moveTo=-1,this.extrema={min:new Vector,max:new Vector},this.shadow=new Vector,this.getFace=function(t){return this.walls[t][0]},this.getNeigh=function(t){return this.walls[t][2]},this.normalPos=function(t){return parseInt("3421".split("")[t-1])},this.rotateAll=function(s){for(let e=0;e<this.walls.length;e++){this.walls[e][0].rotate(s);for(let t=0;t<this.walls[e][1].length;t++)this.walls[e][1][t].rotate(s)}},this.printEdge=function(){for(let e=0;e<this.walls.length;e++)for(let t=0;t<this.walls[e][1].length;t++)this.walls[e][1][t].printEdge()},this.updatePosition=function(){for(let e=0;e<this.walls.length;e++){this.walls[e][0].update();for(let t=0;t<this.walls[e][1].length;t++)this.walls[e][1][t].update()}},this.fillFaces=function(){let t,e;if(-1===this.faceNormal){var s=this.nearestVertex();for(this.showed=[],e=0;e<this.walls.length;e++){var i=this.walls[e][0];for(Math.max(i.v1.z,i.v2.z,i.v3.z,i.v4.z)+.1>s&&this.showed.push(e),t=0;t<this.walls[e][1].length;t++)this.walls[e][1][t].fill(),this.walls[e][1][t].printEdge()}}else{var o;for(e=0;e<this.walls.length;e++)for(t=0;t<this.walls[e][1].length;t++)this.distance(this.walls[e][1][t].average())<2&&(this.walls[e][1][t].fill(),this.walls[e][1][t].printEdge(),this.blackFillCorr(this.walls[e][1][t],1.5));for(this.sort(),this.fillBlack(),e=0;e<this.walls.length;e++)for(t=0;t<this.walls[e][1].length;t++)(o=this.distance(this.walls[e][1][t].average()))<3.5&&2<o&&(this.walls[e][1][t].fill(),this.walls[e][1][t].printEdge(),this.blackFillCorr(this.walls[e][1][t],3));for(this.sort(),this.fillBlack(),e=0;e<this.walls.length;e++)for(t=0;t<this.walls[e][1].length;t++)4<this.distance(this.walls[e][1][t].average())&&(this.walls[e][1][t].fill(),this.walls[e][1][t].printEdge())}},this.fillBlack=function(){var t=this.blackFill.fir,e=this.blackFill.sec;this.blackFace.v1.set(t[0][0],t[0][1]),this.blackFace.v2.set(t[t.length-1][0],t[t.length-1][1]),this.blackFace.v3.set(e[e.length-1][0],e[e.length-1][1]),this.blackFace.v4.set(e[0][0],e[0][1]),this.blackFace.fill(colors.black),this.blackFace.printEdge(),this.blackFill={fir:[],sec:[]},this.blackFillFace.id=-1,this.blackFillFace.pid=-1},this.blackFillCorr=function(t,e){this.distance(t.v1)>e&&this.addToBlackFace(t,t.v1),this.distance(t.v2)>e&&this.addToBlackFace(t,t.v2),this.distance(t.v3)>e&&this.addToBlackFace(t,t.v3),this.distance(t.v4)>e&&this.addToBlackFace(t,t.v4)},this.addToBlackFace=function(t,e){-1===this.blackFillFace.id&&(this.blackFillFace.id=t.parentId,this.blackFillFace.pid=this.getNeigh(t.parentId).parall),this.blackFillFace.id===t.parentId?this.blackFill.fir.push([e.x,e.y]):this.blackFillFace.pid===t.parentId&&this.blackFill.sec.push([e.x,e.y])},this.sort=function(){function t(t,e){return t[0]<e[0]?-1:e[0]<t[0]?1:0}function e(t,e){return t[1]<e[1]?-1:e[1]<t[1]?1:0}this.blackFill.fir.sort(t),this.blackFill.sec.sort(t),this.blackFill.fir[0][0]===this.blackFill.fir[this.blackFill.fir.length-1][0]&&(this.blackFill.fir.sort(e),this.blackFill.sec.sort(e))},this.distance=function(t){var e=this.getFace(this.faceNormal).normal.z<0?this.getNeigh(this.faceNormal).parall:this.faceNormal,s=this.getFace(e).normal,e=this.getFace(e).v1;return Math.abs(s.x*t.x+s.y*t.y+s.z*t.z+s.x*e.x+s.y*e.y+s.z*e.z)/Math.sqrt(s.x*s.x+s.y*s.y+s.z*s.z)},this.nearestVertex=function(){var e={x:-10,y:-10,z:-10},s={x:10,y:10,z:10};for(let t=0;t<this.walls.length;t++){var i=this.walls[t][0];e.x=Math.max(i.v1.x,i.v2.x,i.v3.x,i.v4.x,e.x),e.y=Math.max(i.v1.y,i.v2.y,i.v3.y,i.v4.y,e.y),e.z=Math.max(i.v1.z,i.v2.z,i.v3.z,i.v4.z,e.z),s.x=Math.min(i.v1.x,i.v2.x,i.v3.x,i.v4.x,s.x),s.y=Math.min(i.v1.y,i.v2.y,i.v3.y,i.v4.y,s.y),s.z=Math.min(i.v1.z,i.v2.z,i.v3.z,i.v4.z,s.z)}return this.extrema.max.setV(e),this.extrema.min.setV(s),this.extrema.max.z},this.rotatePart=function(){var t,e;if(-1===this.dragDirection&&10<dragPart.len())this.setDragDirection(),this.faceNormal=this.choseNormalFace(),-1!==this.faceNormal&&(e=(t=this.getFace(this.faceNormal)).v1.toVector(t.v4),rotatePartAxis.setV(e.crossProduct(t.v1.toVector(t.v2))),rotatePartAxis.norm(),rotatePartMatrix.updateMatrix(rotatePartAxis,rotatePartAngle*DE),this.checkElementToRotate());else if(-1!==this.clickFacesIndex){rotatePartMatrix.updateMatrix(rotatePartAxis,rotatePartAngle*DE);for(let t=0;t<this.elementRotate.length;t++){var s=this.elementRotate[t];this.walls[s[0]][1][s[1]].rotate(rotatePartMatrix)}}},this.setDragDirection=function(){if(-1===this.clickFacesIndex)return!1;var t=this.getFace(this.clickFacesIndex),e=dragPart.angle2D(),s=t.horizontalVector.angle2D(),t=t.verticalVector.angle2D()-s,s=s+.5*(t<0?t+2*PI:t),t=s+PI2,i=s+2*PI2,o=s+3*PI2;this.isBetween(e,o,s)?this.moveTo=4:this.isBetween(e,s,t)?this.moveTo=1:this.isBetween(e,t,i)?this.moveTo=3:this.isBetween(e,i,o)&&(this.moveTo=2),this.isBetween(e,PI4,3*PI4)?this.dragDirection=1:this.isBetween(e,3*PI4,5*PI4)?this.dragDirection=3:this.isBetween(e,5*PI4,7*PI4)?this.dragDirection=2:this.dragDirection=4},this.isBetween=function(t,e,s){return e<0&&(e+=2*PI),e>2*PI&&(e-=2*PI),s<0&&(s+=2*PI),s>2*PI&&(s-=2*PI),e<=s?e<=t&&t<=s:s<e?e<t||t<s:void 0},this.checkElementToRotate=function(){let t=this.clickElementIndex;var e=this.clickFacesIndex,s=this.moveTo;this.elementRotate=[],-1!==[3,4].indexOf(s)&&e<4?this.pushZX(t):-1!==[1,2].indexOf(s)&&-1!==[0,2,4,5].indexOf(e)?(t=2===e?8-t:t,this.pushZY(t)):(4===e?t=[6,3,0,7,4,1,8,5,2].indexOf(t):3===e?t=8-t:5===e&&(t=[2,5,8,1,4,7,0,3,6].indexOf(t)),this.pushXY(t))},this.pushZX=function(t){var e=2<t?5<t?6:3:0,s=[0,1,2,3,0];t<3&&this.pushFace(4),5<t&&this.pushFace(5);for(let t=0;t<s.length;t++)this.pushGroup(s[t],e,1+e,2+e)},this.pushXY=function(t){var e=t%3;t%3==0&&this.pushFace(0),(t+1)%3==0&&this.pushFace(2),this.pushGroup(1,e,3+e,6+e),this.pushGroup(4,3*(2-e),3*(2-e)+1,3*(2-e)+2),this.pushGroup(3,8-e,5-e,2-e),this.pushGroup(5,3*e+2,3*e+1,3*e),this.pushGroup(1,e,3+e,6+e)},this.pushZY=function(t){var e=t%3;t%3==0&&this.pushFace(3),(t+1)%3==0&&this.pushFace(1),this.pushGroup(0,e,3+e,6+e),this.pushGroup(4,e,3+e,6+e),this.pushGroup(2,8-e,5-e,2-e),this.pushGroup(5,e,3+e,6+e),this.pushGroup(0,e,3+e,6+e)},this.pushGroup=function(t,e,s,i){this.elementRotate.push([t,e]),this.elementRotate.push([t,s]),this.elementRotate.push([t,i])},this.pushFace=function(e){for(let t=0;t<9;t++)this.elementRotate.push([e,t])},this.reset=function(){this.dragDirection=-1,this.faceNormal=-1,this.clickFacesIndex=-1,this.clickElementIndex=-1,this.moveTo=-1,this.elementRotate=[]},this.choseNormalFace=function(){return-1===this.clickFacesIndex?-1:this.getNeigh(this.clickFacesIndex).get(this.normalPos(this.moveTo))},this.activeFaceIndex=function(e){for(let t=0;t<this.showed.length;t++){var s=this.showed[t],i=this.walls[s][0];if(this.pointInideFace(i,e))return s}return-1},this.activeElement=function(e){if(-1===this.clickElementIndex){if(this.clickFacesIndex=this.activeFaceIndex(e),-1===this.clickFacesIndex)return!1;var s=this.walls[this.clickFacesIndex][1];for(let t=0;t<s.length;t++)this.pointInideFace(s[t],e)&&(this.clickElementIndex=t)}return!0},this.pointInideFace=function(t,e){var s={x:e.x,y:e.y},e={x:e.x+1e3,y:e.y},i=this.lineIntersection(t.v1.ctxPos(),t.v2.ctxPos(),s,e);return((i+=this.lineIntersection(t.v2.ctxPos(),t.v3.ctxPos(),s,e))+this.lineIntersection(t.v3.ctxPos(),t.v4.ctxPos(),s,e)+this.lineIntersection(t.v4.ctxPos(),t.v1.ctxPos(),s,e))%2},this.lineIntersection=function(t,e,s,i){var o=e.x-t.x,e=e.y-t.y,a=i.x-s.x,i=i.y-s.y,r=(-e*(t.x-s.x)+o*(t.y-s.y))/(-a*e+o*i),t=(a*(t.y-s.y)-i*(t.x-s.x))/(-a*e+o*i);return 0<=r&&r<=1&&0<=t&&t<=1?1:0},this.rotateAnimation=function(){-1===this.clickElementIndex?(mouse.animationProcess=!1,rotatePartAngle=rotateEndAngle,this.reset(),dragPart.set(0,0),mouse.leftPress=!1,rotateCubeAngle=0,rotatePartAngle=0):Math.abs(rotateEndAngle-rotatePartAngle)<1?(mouse.animationProcess=!1,rotatePartAngle=rotateEndAngle,this.transform(),this.reset(),dragPart.set(0,0),mouse.leftPress=!1,rotateCubeAngle=0,rotatePartAngle=0):mouse.animationProcess&&(rotatePartAngle+=angleStep,setTimeout(function(){cube.rotateAnimation()},30))},this.calculateAngle=function(){let t=rotatePartAngle;for(;t<0;)t+=360;t%=360,rotateCount=Math.round(t/90),rotateEndAngle=90*Math.round(rotatePartAngle/90),angleStep=(rotateEndAngle-rotatePartAngle)/5},this.transform=function(){let t,e,s=this.clickElementIndex;var i=this.clickFacesIndex,o=this.moveTo;if(-1!==[3,4].indexOf(o)&&i<4)for(t=0;t<rotateCount;t++)this.moveZX(s,3===this.moveTo);else if(-1!==[1,2].indexOf(o)&&-1!==[0,2,4,5].indexOf(i))for(e=1===o,e=2===i?!e:e,s=2===i?8-s:s,t=0;t<rotateCount;t++)this.moveZY(s,e);else for(e=1===o,4===i?(e=3===o,s=[6,3,0,7,4,1,8,5,2].indexOf(s)):3===i?(e=2===o,s=8-s):5===i&&(e=4===o,s=[2,5,8,1,4,7,0,3,6].indexOf(s)),t=0;t<rotateCount;t++)this.moveXY(s,e)},this.moveZX=function(t,e){let s=[null,null,null];var i=2<t?5<t?6:3:0,o=e?[0,1,2,3,0].reverse():[0,1,2,3,0];t<3&&this.rotateFace(4,e),5<t&&this.rotateFace(5,!e);for(let t=0;t<o.length;t++)s=this.replaceGroup(o[t],[i,1+i,2+i],s)},this.moveXY=function(t,e){let s=[null,null,null];var i=t%3;t%3==0&&this.rotateFace(0,!e),(t+1)%3==0&&this.rotateFace(2,e),s=e?(s=this.replaceGroup(1,[i,3+i,6+i],s),s=this.replaceGroup(4,[3*(2-i),3*(2-i)+1,3*(2-i)+2],s),s=this.replaceGroup(3,[8-i,5-i,2-i],s),this.replaceGroup(5,[3*i+2,3*i+1,3*i],s)):(s=this.replaceGroup(1,[i,3+i,6+i],s),s=this.replaceGroup(5,[3*i+2,3*i+1,3*i],s),s=this.replaceGroup(3,[8-i,5-i,2-i],s),this.replaceGroup(4,[3*(2-i),3*(2-i)+1,3*(2-i)+2],s)),this.replaceGroup(1,[i,3+i,6+i],s)},this.moveZY=function(t,e){let s=[null,null,null];var i=t%3;t%3==0&&this.rotateFace(3,!e),(t+1)%3==0&&this.rotateFace(1,e),s=e?(s=this.replaceGroup(0,[i,3+i,6+i],s),s=this.replaceGroup(4,[i,3+i,6+i],s),s=this.replaceGroup(2,[8-i,5-i,2-i],s),this.replaceGroup(5,[i,3+i,6+i],s)):(s=this.replaceGroup(0,[i,3+i,6+i],s),s=this.replaceGroup(5,[i,3+i,6+i],s),s=this.replaceGroup(2,[8-i,5-i,2-i],s),this.replaceGroup(4,[i,3+i,6+i],s)),this.replaceGroup(0,[i,3+i,6+i],s)},this.rotateFace=function(e,s){if(-1===e)return!1;var i=[0,2,8,6,0,2],o=[1,5,7,3,1,5],a=i.length;let r,n,c=null,l=null;for(let t=0;t<a-1;t++)r=s?i[t]:i[a-1-t],n=s?o[t]:o[a-1-t],c=this.replaceColor(e,r,c),l=this.replaceColor(e,n,l)},this.replaceGroup=function(t,e,s){return[this.replaceColor(t,e[0],s[0]),this.replaceColor(t,e[1],s[1]),this.replaceColor(t,e[2],s[2])]},this.replaceColor=function(t,e,s){var i=this.walls[t][1][e].color;return this.walls[t][1][e].color=s,i},this.setVariableToShake=function(t,e,s){this.clickFacesIndex=t,this.clickElementIndex=e,this.dragDirection=s,this.moveTo=s,this.faceNormal=this.choseNormalFace();t=this.getFace(this.faceNormal),e=t.v1.toVector(t.v4),s=t.v1.toVector(t.v2),t=e.crossProduct(s);rotatePartAxis.setV(t),rotatePartAxis.norm(),rotatePartMatrix.updateMatrix(rotatePartAxis,rotatePartAngle*DE),this.checkElementToRotate()},this.printShadow=function(){var e=this.shadow.scale({x:0,y:-1.2*D,z:0}),s=this.extrema.max.x*scale,i=.1*this.extrema.max.z*scale;for(let t=0;t<20;t++)ctx.beginPath(),ctx.fillStyle="rgba(100, 100, 100, 0.1)",ctx.ellipse(e.x,e.y,s-t*s/25,i-t*i/25,0,0,2*PI,1),ctx.fill()}}function Face(e,s,t,i,o,a,r){this.v1=e,this.v2=s,this.v3=t,this.v4=i,this.verticalVector=new Vector(e.x-i.x,e.y-i.y,e.z-i.z),this.horizontalVector=new Vector(s.x-e.x,s.y-e.y,s.z-e.z),this.angle=0,this.color=o,this.id=a||0,this.parentId=r,this.show=!0,this.normal=new Vector,this.setNormal=function(){var t=this.v1.toVector(this.v4),e=this.v1.toVector(this.v2);this.normal.setV(t.crossProduct(e))},this.showToggle=function(){this.setNormal(),this.show=0<this.normal.z},this.average=function(){return{x:(this.v1.x+this.v2.x+this.v3.x+this.v4.x)/4,y:(this.v1.y+this.v2.y+this.v3.y+this.v4.y)/4,z:(this.v1.z+this.v2.z+this.v3.z+this.v4.z)/4}},this.rotate=function(t){this.v1.rotate(t),this.v2.rotate(t),this.v3.rotate(t),this.v4.rotate(t),this.verticalVector.set(e.x-i.x,e.y-i.y,e.z-i.z),this.horizontalVector.set(s.x-e.x,s.y-e.y,s.z-e.z),this.showToggle()},this.update=function(){this.v1.updatePos(),this.v2.updatePos(),this.v3.updatePos(),this.v4.updatePos()},this.printEdge=function(){this.show&&(ctx.beginPath(),ctx.strokeStyle=colors.line,ctx.lineWidth=lineWidth,ctx.lineCap="round",ctx.lineJoin="round",ctx.moveTo(this.v1.ctxPos().x,this.v1.ctxPos().y),ctx.lineTo(this.v2.ctxPos().x,this.v2.ctxPos().y),ctx.lineTo(this.v3.ctxPos().x,this.v3.ctxPos().y),ctx.lineTo(this.v4.ctxPos().x,this.v4.ctxPos().y),ctx.lineTo(this.v1.ctxPos().x,this.v1.ctxPos().y),ctx.stroke())},this.fill=function(t){this.show&&(ctx.beginPath(),ctx.fillStyle=t||colors.line,ctx.moveTo(this.v1.ctxPos().x,this.v1.ctxPos().y),ctx.lineTo(this.v2.ctxPos().x,this.v2.ctxPos().y),ctx.lineTo(this.v3.ctxPos().x,this.v3.ctxPos().y),ctx.lineTo(this.v4.ctxPos().x,this.v4.ctxPos().y),ctx.lineTo(this.v1.ctxPos().x,this.v1.ctxPos().y),ctx.fill(),t||this.fillRound())},this.fillRound=function(){var t=this.v2.subtract(this.v1),e=this.v3.subtract(this.v2),s=this.v4.subtract(this.v3),i=this.v1.subtract(this.v4),o=this.v4.add(i.multiply(1-radius)),a=this.v1.add(t.multiply(radius)),t=this.v1.add(t.multiply(1-radius)),r=this.v2.add(e.multiply(radius)),e=this.v2.add(e.multiply(1-radius)),n=this.v3.add(s.multiply(radius)),s=this.v3.add(s.multiply(1-radius)),i=this.v4.add(i.multiply(radius));ctx.beginPath(),ctx.fillStyle=this.calculateColor(),ctx.moveTo(a.ctxPos().x,a.ctxPos().y),ctx.lineTo(t.ctxPos().x,t.ctxPos().y),ctx.quadraticCurveTo(this.v2.ctxPos().x,this.v2.ctxPos().y,r.ctxPos().x,r.ctxPos().y),ctx.lineTo(e.ctxPos().x,e.ctxPos().y),ctx.quadraticCurveTo(this.v3.ctxPos().x,this.v3.ctxPos().y,n.ctxPos().x,n.ctxPos().y),ctx.lineTo(s.ctxPos().x,s.ctxPos().y),ctx.quadraticCurveTo(this.v4.ctxPos().x,this.v4.ctxPos().y,i.ctxPos().x,i.ctxPos().y),ctx.lineTo(o.ctxPos().x,o.ctxPos().y),ctx.quadraticCurveTo(this.v1.ctxPos().x,this.v1.ctxPos().y,a.ctxPos().x,a.ctxPos().y),ctx.fill()},this.calculateColor=function(){var t=this.horizontalVector,e=this.verticalVector,e=Math.abs(t.x*e.y-e.x*t.y)/8;return colorLuminance(this.color,e-.5)}}function Point(t,e,s){this.x=t||0,this.y=e||0,this.z=s||0,this.set=function(t,e,s){"number"==typeof t?(this.x=t||0,this.y=e||0,this.z=s||0):(this.x=t.x,this.y=t.y,this.z=t.z)},this.distance=function(t){return Math.sqrt(Math.pow(t.x-this.x,2)+Math.pow(t.y-this.y,2))}}function Vector(t,e,s){this.x=t||0,this.y=e||0,this.z=s||0,this.pos=new Point(t,e,s),this.angle2D=function(){var t=Math.atan2(this.y,this.x);return 0<t?t:2*PI+t},this.ctxPos=function(){return this.scale(this)},this.scale=function(t){return{x:centerX+t.x*scale,y:centerY-t.y*scale}},this.rotate=function(t){this.setCurrentPos(t.dotProduct(this.pos))},this.len=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))},this.norm=function(){var t=this.len();this.x/=t,this.y/=t,this.z/=t},this.dotProduct=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},this.crossProduct=function(t){return new Vector(this.y*t.z-t.y*this.z,this.z*t.x-t.z*this.x,this.x*t.y-t.x*this.y)},this.set=function(t,e,s){this.x=t||0,this.y=e||0,this.z=s||0},this.setV=function(t){this.setCurrentPos(t)},this.setCurrentPos=function(t){this.x=t.x,this.y=t.y,this.z=t.z},this.setStartPoss=function(t){this.pos.x=t.x,this.pos.y=t.y,this.pos.z=t.z},this.updatePos=function(){this.pos.x=this.x,this.pos.y=this.y,this.pos.z=this.z},this.toVector=function(t){return new Vector(t.x-this.x,t.y-this.y,t.z-this.z)},this.add=function(t){return new Vector(t.x+this.x,t.y+this.y,t.z+this.z)},this.subtract=function(t){return new Vector(this.x-t.x,this.y-t.y,this.z-t.z)},this.multiply=function(t){return new Vector(t*this.x,t*this.y,t*this.z)}}function Matrix(t,e,s){this.v1=t,this.v2=e,this.v3=s,this.result=new Point,this.dotProduct=function(t){return this.result.x=this.v1.x*t.x+this.v1.y*t.y+this.v1.z*t.z,this.result.y=this.v2.x*t.x+this.v2.y*t.y+this.v2.z*t.z,this.result.z=this.v3.x*t.x+this.v3.y*t.y+this.v3.z*t.z,this.result}}function RotateMatrix(t,e,s){Matrix.call(this,t,e,s),this.updateMatrix=function(t,e){var s=cos(e),e=sin(e),i=1-s,o=t.x,a=t.y,t=t.z;this.v1.set(i*o*o+s,i*o*a-t*e,i*o*t+a*e),this.v2.set(i*o*a+t*e,i*a*a+s,i*a*t-o*e),this.v3.set(i*o*t-a*e,i*a*t+o*e,i*t*t+s)}}function Neighbor(t,e,s,i,o){this.top=t,this.bottom=e,this.left=s,this.right=i,this.parall=o,this.get=function(t){return 1===t?this.top:2===t?this.bottom:3===t?this.left:4===t?this.right:void 0}}function createWall(t,e,s,i){let o,a,r,n,c,l;var h=(e.x-t.x)/3,u=(e.y-t.y)/3,x=(e.z-t.z)/3,v=[];if(0==h)for(l=0;l<3;l++)for(c=0;c<3;c++)n=new Vector(t.x,t.y+l*u,t.z+c*x),r=new Vector(t.x,t.y+l*u,t.z+(1+c)*x),a=new Vector(t.x,t.y+(1+l)*u,t.z+(1+c)*x),o=new Vector(t.x,t.y+(1+l)*u,t.z+c*x),v.push(new Face(n,r,a,o,s,3*l+c,i));if(0==u)for(l=0;l<3;l++)for(c=0;c<3;c++)n=new Vector(t.x+c*h,t.y,t.z+l*x),r=new Vector(t.x+(1+c)*h,t.y,t.z+l*x),a=new Vector(t.x+(1+c)*h,t.y,t.z+(1+l)*x),o=new Vector(t.x+c*h,t.y,t.z+(1+l)*x),v.push(new Face(n,r,a,o,s||randomColor(),3*l+c,i));if(0==x)for(l=0;l<3;l++)for(c=0;c<3;c++)n=new Vector(t.x+c*h,t.y+l*u,t.z),r=new Vector(t.x+(1+c)*h,t.y+l*u,t.z),a=new Vector(t.x+(1+c)*h,t.y+(1+l)*u,t.z),o=new Vector(t.x+c*h,t.y+(1+l)*u,t.z),v.push(new Face(n,r,a,o,s||randomColor(),3*l+c,i));return v}function colorLuminance(t,e){(t=String(t).replace(/[^0-9a-f]/gi,"")).length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),e=e||0;let s="#",i,o;for(o=0;o<3;o++)i=parseInt(t.substr(2*o,2),16),i=Math.round(Math.min(Math.max(0,i+i*e),255)).toString(16),s+=("00"+i).substr(i.length);return s}function randomColor(){var e="0123456789ABCDEF".split("");let s="#";for(let t=0;t<6;t++)s+=e[Math.floor(16*Math.random())];return s}function cos(t){return Math.cos(t)}function sin(t){return Math.sin(t)}function resize(){canvasHeight=window.innerHeight,canvasWidth=window.innerWidth,centerX=canvasWidth/2,centerY=canvasHeight/2,canvas.height=canvasHeight,canvas.width=canvasWidth,scale=Math.round(.08*(canvasHeight<canvasWidth?canvasHeight:canvasWidth)-6),scale=Math.min(Math.max(scale,5),55),colors.bgGradient=ctx.createLinearGradient(0,0,0,canvasHeight),colors.bgGradient.addColorStop(0,colors.bg1),colors.bgGradient.addColorStop(.66,colors.bg2),colors.bgGradient.addColorStop(.75,colors.bg3),colors.bgGradient.addColorStop(.85,colors.bg2),colors.bgGradient.addColorStop(1,colors.bg1),rotateSpeed=55/scale*36,startFontSize=4*scale,lineWidth=40<scale?4:30<scale?3:20<scale?2:1}function init(){canvas=document.getElementById("cubic"),"function"==typeof(ctx=canvas.getContext("2d")).ellipse&&(supportEllipse=!0),resize(),setInfoElement(),scaleMax=scale,scale=2,setInterval(draw,50),zoom()}function setInfoElement(){var t,e,s=document.querySelector(".info");"ontouchstart"in document.documentElement?s.style.display="none":(t=.25*canvasWidth+"px",e=4/3.3*.25*canvasWidth+"px",s.style.width=t,s.style.height=e,s.style.backgroundSize=t+" "+e)}function zoom(){scale<scaleMax?(rotateCubeAngle+=1,scale+=2,setTimeout(zoom,50)):(cube.updatePosition(),rotateCubeAngle=0,shake())}function shake(){var t;(shakeCount<shakeRepetCount?(shakeCount++,t=randInt(1,4),shakeAngleEnd=90*t,shakeAngleStep=shakeAngleEnd/5,cube.setVariableToShake(randInt(0,6),randInt(0,9),randInt(1,5)),mouse.shakeProcess=!0,shakeRotate):(mouse.shakeProcess=!1,start))()}function shakeRotate(){1<Math.abs(rotatePartAngle-shakeAngleEnd)?(rotatePartAngle+=shakeAngleStep,setTimeout(shakeRotate,50)):(rotatePartAngle=shakeAngleEnd,cube.calculateAngle(),cube.transform(),cube.reset(),rotatePartAngle=0,setTimeout(shake,100))}function randInt(t,e){return Math.floor(Math.random()*(e-t))+t}function start(){document.querySelector(".info").classList.add("hidden"),document.addEventListener("mouseup",mouseUp),document.addEventListener("touchmove",touchMove),canvas.addEventListener("mousedown",mouseDown),canvas.addEventListener("mouseup",mouseUp),canvas.addEventListener("mousemove",mouseMove),canvas.addEventListener("touchstart",touchStart),canvas.addEventListener("contextmenu",t=>(t.preventDefault(),!1)),canvas.addEventListener("touchend",touchEnd),canvas.addEventListener("touchmove",touchMove)}RotateMatrix.prototype=Object.create(Matrix.prototype),RotateMatrix.prototype.constructor=RotateMatrix,window.addEventListener("resize",resize),init();