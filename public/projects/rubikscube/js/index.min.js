let s=Math.PI/180,n=Math.PI,o=Math.PI/4,S=Math.PI/2,R=3*Math.sqrt(3),L=new V(1,1,0),h=new V(0,0,0),e=new V,l=new V,r=0,a=0,i=0,c=0,X=0,u=0,Y=!1,x,v,t=900,f=600,A=t/2,O=f/2,q=0,d=0,p=.3,Z=4,W=20,j=0,y=0,H=0,J=2*d,w={red:"#BF1E2E",green:"#00A652",blue:"#303193",orange:"#F6941D",yellow:"#FFF100",white:"#FFFFFF",bg1:"#DADADA",bg2:"#848484",bg3:"#505050",line:"#282828",black:"#403F3F",bgGradient:null},m={pos:new D,lazy:new D,click:new D,leftPress:!1,scrollPress:!1,rightPress:!1,inercion:!1,block:!1,animationProcess:!1,shakeProcess:!1,updateLazy:function(){this.lazy.x+=.3*(this.pos.x-this.lazy.x),this.lazy.y+=.3*(this.pos.y-this.lazy.y)},resetLazy:function(){this.lazy.set(this.pos)},update:function(){if(this.shakeProcess)return!1;var t,i;this.updateLazy(),this.inercion&&this.pos.distance(this.lazy)<5&&(this.inercion=!1,m.leftPress?(m.animationProcess=!0,E.calculateAngle(),E.rotateAnimation()):m.scrollPress&&(E.updatePosition(),m.scrollPress=!1,r=0)),this.scrollPress?(e.set(this.lazy.x-this.click.x,this.click.y-this.lazy.y),L.set(-e.y,e.x),L.norm(),r=e.len()/100*c):this.leftPress&&!this.animationProcess&&(t=this.lazy.x-this.click.x,i=this.click.y-this.lazy.y,l.set(t,i),a=1===E.dragDirection?i/70*c:2===E.dragDirection?-i/70*c:3===E.dragDirection?-t/70*c:t/70*c)}},K=new ct(new V,new V,new V),g=new ct(new V,new V,new V);var P=new V(-3,3,3),z=new V(3,3,3),F=new V(3,-3,3),k=new V(-3,-3,3),b=new V(-3,3,-3),T=new V(3,3,-3),I=new V(3,-3,-3),M=new V(-3,-3,-3),G=new C(P,z,F,k,w.blue,0),Q=new C(z,T,I,F,w.green,1),U=new C(T,b,M,I,w.orange,2),$=new C(b,P,k,M,w.red,3),_=new C(b,T,z,P,w.white,4),tt=new C(k,F,I,M,w.yellow,5);let E=new function(t){this.walls=t,this.showed=[],this.elementRotate=[],this.blackFill={fir:[],sec:[]},this.blackFillFace={id:-1,pid:-1},this.blackFace=new C(new V,new V,new V,new V,w.black),this.dragDirection=-1,this.faceNormal=-1,this.clickFacesIndex=-1,this.clickElementIndex=-1,this.moveTo=-1,this.extrema={min:new V,max:new V},this.shadow=new V,this.getFace=function(t){return this.walls[t][0]},this.getNeigh=function(t){return this.walls[t][2]},this.normalPos=function(t){return parseInt("3421".split("")[t-1])},this.rotateAll=function(e){for(let i=0;i<this.walls.length;i++){this.walls[i][0].rotate(e);for(let t=0;t<this.walls[i][1].length;t++)this.walls[i][1][t].rotate(e)}},this.printEdge=function(){for(let i=0;i<this.walls.length;i++)for(let t=0;t<this.walls[i][1].length;t++)this.walls[i][1][t].printEdge()},this.updatePosition=function(){for(let i=0;i<this.walls.length;i++){this.walls[i][0].update();for(let t=0;t<this.walls[i][1].length;t++)this.walls[i][1][t].update()}},this.fillFaces=function(){let t,i;if(-1===this.faceNormal){var e=this.nearestVertex();for(this.showed=[],i=0;i<this.walls.length;i++){var s=this.walls[i][0];for(Math.max(s.v1.z,s.v2.z,s.v3.z,s.v4.z)+.1>e&&this.showed.push(i),t=0;t<this.walls[i][1].length;t++)this.walls[i][1][t].fill(),this.walls[i][1][t].printEdge()}}else{var h;for(i=0;i<this.walls.length;i++)for(t=0;t<this.walls[i][1].length;t++)this.distance(this.walls[i][1][t].average())<2&&(this.walls[i][1][t].fill(),this.walls[i][1][t].printEdge(),this.blackFillCorr(this.walls[i][1][t],1.5));for(this.sort(),this.fillBlack(),i=0;i<this.walls.length;i++)for(t=0;t<this.walls[i][1].length;t++)(h=this.distance(this.walls[i][1][t].average()))<3.5&&2<h&&(this.walls[i][1][t].fill(),this.walls[i][1][t].printEdge(),this.blackFillCorr(this.walls[i][1][t],3));for(this.sort(),this.fillBlack(),i=0;i<this.walls.length;i++)for(t=0;t<this.walls[i][1].length;t++)4<this.distance(this.walls[i][1][t].average())&&(this.walls[i][1][t].fill(),this.walls[i][1][t].printEdge())}},this.fillBlack=function(){var t=this.blackFill.fir,i=this.blackFill.sec;this.blackFace.v1.set(t[0][0],t[0][1]),this.blackFace.v2.set(t[t.length-1][0],t[t.length-1][1]),this.blackFace.v3.set(i[i.length-1][0],i[i.length-1][1]),this.blackFace.v4.set(i[0][0],i[0][1]),this.blackFace.fill(w.black),this.blackFace.printEdge(),this.blackFill={fir:[],sec:[]},this.blackFillFace.id=-1,this.blackFillFace.pid=-1},this.blackFillCorr=function(t,i){this.distance(t.v1)>i&&this.addToBlackFace(t,t.v1),this.distance(t.v2)>i&&this.addToBlackFace(t,t.v2),this.distance(t.v3)>i&&this.addToBlackFace(t,t.v3),this.distance(t.v4)>i&&this.addToBlackFace(t,t.v4)},this.addToBlackFace=function(t,i){-1===this.blackFillFace.id&&(this.blackFillFace.id=t.parentId,this.blackFillFace.pid=this.getNeigh(t.parentId).parall),this.blackFillFace.id===t.parentId?this.blackFill.fir.push([i.x,i.y]):this.blackFillFace.pid===t.parentId&&this.blackFill.sec.push([i.x,i.y])},this.sort=function(){function t(t,i){return t[0]<i[0]?-1:i[0]<t[0]?1:0}function i(t,i){return t[1]<i[1]?-1:i[1]<t[1]?1:0}this.blackFill.fir.sort(t),this.blackFill.sec.sort(t),this.blackFill.fir[0][0]===this.blackFill.fir[this.blackFill.fir.length-1][0]&&(this.blackFill.fir.sort(i),this.blackFill.sec.sort(i))},this.distance=function(t){var i=this.getFace(this.faceNormal).normal.z<0?this.getNeigh(this.faceNormal).parall:this.faceNormal,e=this.getFace(i).normal,i=this.getFace(i).v1;return Math.abs(e.x*t.x+e.y*t.y+e.z*t.z+e.x*i.x+e.y*i.y+e.z*i.z)/Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z)},this.nearestVertex=function(){var i={x:-10,y:-10,z:-10},e={x:10,y:10,z:10};for(let t=0;t<this.walls.length;t++){var s=this.walls[t][0];i.x=Math.max(s.v1.x,s.v2.x,s.v3.x,s.v4.x,i.x),i.y=Math.max(s.v1.y,s.v2.y,s.v3.y,s.v4.y,i.y),i.z=Math.max(s.v1.z,s.v2.z,s.v3.z,s.v4.z,i.z),e.x=Math.min(s.v1.x,s.v2.x,s.v3.x,s.v4.x,e.x),e.y=Math.min(s.v1.y,s.v2.y,s.v3.y,s.v4.y,e.y),e.z=Math.min(s.v1.z,s.v2.z,s.v3.z,s.v4.z,e.z)}return this.extrema.max.setV(i),this.extrema.min.setV(e),this.extrema.max.z},this.rotatePart=function(){var t,i;if(-1===this.dragDirection&&10<l.len())this.setDragDirection(),this.faceNormal=this.choseNormalFace(),-1!==this.faceNormal&&(i=(t=this.getFace(this.faceNormal)).v1.toVector(t.v4),h.setV(i.crossProduct(t.v1.toVector(t.v2))),h.norm(),g.updateMatrix(h,a*s),this.checkElementToRotate());else if(-1!==this.clickFacesIndex){g.updateMatrix(h,a*s);for(let t=0;t<this.elementRotate.length;t++){var e=this.elementRotate[t];this.walls[e[0]][1][e[1]].rotate(g)}}},this.setDragDirection=function(){if(-1===this.clickFacesIndex)return!1;var t=this.getFace(this.clickFacesIndex),i=l.angle2D(),e=t.horizontalVector.angle2D(),t=t.verticalVector.angle2D()-e,e=e+.5*(t<0?t+2*n:t),t=e+S,s=e+2*S,h=e+3*S;this.isBetween(i,h,e)?this.moveTo=4:this.isBetween(i,e,t)?this.moveTo=1:this.isBetween(i,t,s)?this.moveTo=3:this.isBetween(i,s,h)&&(this.moveTo=2),this.isBetween(i,o,3*o)?this.dragDirection=1:this.isBetween(i,3*o,5*o)?this.dragDirection=3:this.isBetween(i,5*o,7*o)?this.dragDirection=2:this.dragDirection=4},this.isBetween=function(t,i,e){return i<0&&(i+=2*n),i>2*n&&(i-=2*n),e<0&&(e+=2*n),e>2*n&&(e-=2*n),i<=e?i<=t&&t<=e:e<i?i<t||t<e:void 0},this.checkElementToRotate=function(){let t=this.clickElementIndex;var i=this.clickFacesIndex,e=this.moveTo;this.elementRotate=[],-1!==[3,4].indexOf(e)&&i<4?this.pushZX(t):-1!==[1,2].indexOf(e)&&-1!==[0,2,4,5].indexOf(i)?(t=2===i?8-t:t,this.pushZY(t)):(4===i?t=[6,3,0,7,4,1,8,5,2].indexOf(t):3===i?t=8-t:5===i&&(t=[2,5,8,1,4,7,0,3,6].indexOf(t)),this.pushXY(t))},this.pushZX=function(t){var i=2<t?5<t?6:3:0,e=[0,1,2,3,0];t<3&&this.pushFace(4),5<t&&this.pushFace(5);for(let t=0;t<e.length;t++)this.pushGroup(e[t],i,1+i,2+i)},this.pushXY=function(t){var i=t%3;t%3==0&&this.pushFace(0),(t+1)%3==0&&this.pushFace(2),this.pushGroup(1,i,3+i,6+i),this.pushGroup(4,3*(2-i),3*(2-i)+1,3*(2-i)+2),this.pushGroup(3,8-i,5-i,2-i),this.pushGroup(5,3*i+2,3*i+1,3*i),this.pushGroup(1,i,3+i,6+i)},this.pushZY=function(t){var i=t%3;t%3==0&&this.pushFace(3),(t+1)%3==0&&this.pushFace(1),this.pushGroup(0,i,3+i,6+i),this.pushGroup(4,i,3+i,6+i),this.pushGroup(2,8-i,5-i,2-i),this.pushGroup(5,i,3+i,6+i),this.pushGroup(0,i,3+i,6+i)},this.pushGroup=function(t,i,e,s){this.elementRotate.push([t,i]),this.elementRotate.push([t,e]),this.elementRotate.push([t,s])},this.pushFace=function(i){for(let t=0;t<9;t++)this.elementRotate.push([i,t])},this.reset=function(){this.dragDirection=-1,this.faceNormal=-1,this.clickFacesIndex=-1,this.clickElementIndex=-1,this.moveTo=-1,this.elementRotate=[]},this.choseNormalFace=function(){return-1===this.clickFacesIndex?-1:this.getNeigh(this.clickFacesIndex).get(this.normalPos(this.moveTo))},this.activeFaceIndex=function(i){for(let t=0;t<this.showed.length;t++){var e=this.showed[t],s=this.walls[e][0];if(this.pointInideFace(s,i))return e}return-1},this.activeElement=function(i){if(-1===this.clickElementIndex){if(this.clickFacesIndex=this.activeFaceIndex(i),-1===this.clickFacesIndex)return!1;var e=this.walls[this.clickFacesIndex][1];for(let t=0;t<e.length;t++)this.pointInideFace(e[t],i)&&(this.clickElementIndex=t)}return!0},this.pointInideFace=function(t,i){var e={x:i.x,y:i.y},i={x:i.x+1e3,y:i.y},s=this.lineIntersection(t.v1.ctxPos(),t.v2.ctxPos(),e,i);return((s+=this.lineIntersection(t.v2.ctxPos(),t.v3.ctxPos(),e,i))+this.lineIntersection(t.v3.ctxPos(),t.v4.ctxPos(),e,i)+this.lineIntersection(t.v4.ctxPos(),t.v1.ctxPos(),e,i))%2},this.lineIntersection=function(t,i,e,s){var h=i.x-t.x,i=i.y-t.y,n=s.x-e.x,s=s.y-e.y,o=(-i*(t.x-e.x)+h*(t.y-e.y))/(-n*i+h*s),t=(n*(t.y-e.y)-s*(t.x-e.x))/(-n*i+h*s);return 0<=o&&o<=1&&0<=t&&t<=1?1:0},this.rotateAnimation=function(){-1===this.clickElementIndex?(m.animationProcess=!1,a=i,this.reset(),l.set(0,0),m.leftPress=!1,r=0,a=0):Math.abs(i-a)<1?(m.animationProcess=!1,a=i,this.transform(),this.reset(),l.set(0,0),m.leftPress=!1,r=0,a=0):m.animationProcess&&(a+=X,setTimeout(function(){E.rotateAnimation()},30))},this.calculateAngle=function(){let t=a;for(;t<0;)t+=360;t%=360,u=Math.round(t/90),i=90*Math.round(a/90),X=(i-a)/5},this.transform=function(){let t,i,e=this.clickElementIndex;var s=this.clickFacesIndex,h=this.moveTo;if(-1!==[3,4].indexOf(h)&&s<4)for(t=0;t<u;t++)this.moveZX(e,3===this.moveTo);else if(-1!==[1,2].indexOf(h)&&-1!==[0,2,4,5].indexOf(s))for(i=1===h,i=2===s?!i:i,e=2===s?8-e:e,t=0;t<u;t++)this.moveZY(e,i);else for(i=1===h,4===s?(i=3===h,e=[6,3,0,7,4,1,8,5,2].indexOf(e)):3===s?(i=2===h,e=8-e):5===s&&(i=4===h,e=[2,5,8,1,4,7,0,3,6].indexOf(e)),t=0;t<u;t++)this.moveXY(e,i)},this.moveZX=function(t,i){let e=[null,null,null];var s=2<t?5<t?6:3:0,h=i?[0,1,2,3,0].reverse():[0,1,2,3,0];t<3&&this.rotateFace(4,i),5<t&&this.rotateFace(5,!i);for(let t=0;t<h.length;t++)e=this.replaceGroup(h[t],[s,1+s,2+s],e)},this.moveXY=function(t,i){let e=[null,null,null];var s=t%3;t%3==0&&this.rotateFace(0,!i),(t+1)%3==0&&this.rotateFace(2,i),e=i?(e=this.replaceGroup(1,[s,3+s,6+s],e),e=this.replaceGroup(4,[3*(2-s),3*(2-s)+1,3*(2-s)+2],e),e=this.replaceGroup(3,[8-s,5-s,2-s],e),this.replaceGroup(5,[3*s+2,3*s+1,3*s],e)):(e=this.replaceGroup(1,[s,3+s,6+s],e),e=this.replaceGroup(5,[3*s+2,3*s+1,3*s],e),e=this.replaceGroup(3,[8-s,5-s,2-s],e),this.replaceGroup(4,[3*(2-s),3*(2-s)+1,3*(2-s)+2],e)),this.replaceGroup(1,[s,3+s,6+s],e)},this.moveZY=function(t,i){let e=[null,null,null];var s=t%3;t%3==0&&this.rotateFace(3,!i),(t+1)%3==0&&this.rotateFace(1,i),e=i?(e=this.replaceGroup(0,[s,3+s,6+s],e),e=this.replaceGroup(4,[s,3+s,6+s],e),e=this.replaceGroup(2,[8-s,5-s,2-s],e),this.replaceGroup(5,[s,3+s,6+s],e)):(e=this.replaceGroup(0,[s,3+s,6+s],e),e=this.replaceGroup(5,[s,3+s,6+s],e),e=this.replaceGroup(2,[8-s,5-s,2-s],e),this.replaceGroup(4,[s,3+s,6+s],e)),this.replaceGroup(0,[s,3+s,6+s],e)},this.rotateFace=function(i,e){if(-1===i)return!1;var s=[0,2,8,6,0,2],h=[1,5,7,3,1,5],n=s.length;let o,l,r=null,a=null;for(let t=0;t<n-1;t++)o=e?s[t]:s[n-1-t],l=e?h[t]:h[n-1-t],r=this.replaceColor(i,o,r),a=this.replaceColor(i,l,a)},this.replaceGroup=function(t,i,e){return[this.replaceColor(t,i[0],e[0]),this.replaceColor(t,i[1],e[1]),this.replaceColor(t,i[2],e[2])]},this.replaceColor=function(t,i,e){var s=this.walls[t][1][i].color;return this.walls[t][1][i].color=e,s},this.setVariableToShake=function(t,i,e){this.clickFacesIndex=t,this.clickElementIndex=i,this.dragDirection=e,this.moveTo=e,this.faceNormal=this.choseNormalFace();t=this.getFace(this.faceNormal),i=t.v1.toVector(t.v4),e=t.v1.toVector(t.v2),t=i.crossProduct(e);h.setV(t),h.norm(),g.updateMatrix(h,a*s),this.checkElementToRotate()},this.printShadow=function(){var i=this.shadow.scale({x:0,y:-1.2*R,z:0}),e=this.extrema.max.x*d,s=.1*this.extrema.max.z*d;for(let t=0;t<20;t++)v.beginPath(),v.fillStyle="rgba(100, 100, 100, 0.1)",v.ellipse(i.x,i.y,e-t*e/25,s-t*s/25,0,0,2*n,1),v.fill()}}([[G,N(P,F,w.blue,0),new B(4,5,3,1,2)],[Q,N(z,I,w.green,1),new B(4,5,0,2,3)],[U,N(T,M,w.orange,2),new B(4,5,1,3,0)],[$,N(b,k,w.red,3),new B(4,5,2,0,1)],[_,N(b,z,w.white,4),new B(2,0,3,1,5)],[tt,N(k,I,w.yellow,5),new B(0,2,3,1,4)]]);function it(t){if(m.inercion)return 1;var i=x.getBoundingClientRect();m.pos.set(t.clientX-i.left,t.clientY-i.top)}function et(t){x.style.cursor=t}function st(t){m.leftPress&&0===t.button&&(m.inercion=!0,et("default")),!m.scrollPress||1!==t.button&&2!==t.button||(m.inercion=!0,et("default"))}function ht(t){if(m.scrollPress||m.leftPress||m.rightPress||m.animationProcess||m.shakeProcess||m.inercion)return!1;t.preventDefault();var i=x.getBoundingClientRect();m.click.set(t.clientX-i.left,t.clientY-i.top),m.pos.set(t.clientX-i.left,t.clientY-i.top+1e-9),m.resetLazy(),0===t.button?(m.leftPress=!0,et("move")):1!==t.button&&2!==t.button||(m.scrollPress=!0,et("move"))}function nt(t){if(m.scrollPress||m.leftPress||m.rightPress||m.animationProcess||m.shakeProcess||m.inercion)return!1;var t=t.changedTouches[0],i=x.getBoundingClientRect(),t=(m.click.set(t.clientX-i.left,t.clientY-i.top),m.pos.set(t.clientX-i.left,t.clientY-i.top+1e-9),m.resetLazy(),E.activeElement(m.click));t?m.leftPress=!0:m.scrollPress=!0}function ot(t){if(m.inercion)return 1;var i=t.changedTouches[0],e=x.getBoundingClientRect();m.pos.set(i.clientX-e.left,i.clientY-e.top),t.preventDefault()}function lt(){(m.leftPress||m.scrollPress)&&(m.inercion=!0)}function rt(){v.fillStyle=w.bgGradient,v.fillRect(0,0,t,f),K.updateMatrix(L,r*s),E.rotateAll(K),(m.leftPress||m.shakeProcess)&&(E.activeElement(m.click),E.rotatePart()),Y&&E.printShadow(),E.fillFaces(),m.shakeProcess||m.update()}function C(i,e,t,s,h,n,o){this.v1=i,this.v2=e,this.v3=t,this.v4=s,this.verticalVector=new V(i.x-s.x,i.y-s.y,i.z-s.z),this.horizontalVector=new V(e.x-i.x,e.y-i.y,e.z-i.z),this.angle=0,this.color=h,this.id=n||0,this.parentId=o,this.show=!0,this.normal=new V,this.setNormal=function(){var t=this.v1.toVector(this.v4),i=this.v1.toVector(this.v2);this.normal.setV(t.crossProduct(i))},this.showToggle=function(){this.setNormal(),this.show=0<this.normal.z},this.average=function(){return{x:(this.v1.x+this.v2.x+this.v3.x+this.v4.x)/4,y:(this.v1.y+this.v2.y+this.v3.y+this.v4.y)/4,z:(this.v1.z+this.v2.z+this.v3.z+this.v4.z)/4}},this.rotate=function(t){this.v1.rotate(t),this.v2.rotate(t),this.v3.rotate(t),this.v4.rotate(t),this.verticalVector.set(i.x-s.x,i.y-s.y,i.z-s.z),this.horizontalVector.set(e.x-i.x,e.y-i.y,e.z-i.z),this.showToggle()},this.update=function(){this.v1.updatePos(),this.v2.updatePos(),this.v3.updatePos(),this.v4.updatePos()},this.printEdge=function(){this.show&&(v.beginPath(),v.strokeStyle=w.line,v.lineWidth=Z,v.lineCap="round",v.lineJoin="round",v.moveTo(this.v1.ctxPos().x,this.v1.ctxPos().y),v.lineTo(this.v2.ctxPos().x,this.v2.ctxPos().y),v.lineTo(this.v3.ctxPos().x,this.v3.ctxPos().y),v.lineTo(this.v4.ctxPos().x,this.v4.ctxPos().y),v.lineTo(this.v1.ctxPos().x,this.v1.ctxPos().y),v.stroke())},this.fill=function(t){this.show&&(v.beginPath(),v.fillStyle=t||w.line,v.moveTo(this.v1.ctxPos().x,this.v1.ctxPos().y),v.lineTo(this.v2.ctxPos().x,this.v2.ctxPos().y),v.lineTo(this.v3.ctxPos().x,this.v3.ctxPos().y),v.lineTo(this.v4.ctxPos().x,this.v4.ctxPos().y),v.lineTo(this.v1.ctxPos().x,this.v1.ctxPos().y),v.fill(),t||this.fillRound())},this.fillRound=function(){var t=this.v2.subtract(this.v1),i=this.v3.subtract(this.v2),e=this.v4.subtract(this.v3),s=this.v1.subtract(this.v4),h=this.v4.add(s.multiply(.7)),n=this.v1.add(t.multiply(p)),t=this.v1.add(t.multiply(.7)),o=this.v2.add(i.multiply(p)),i=this.v2.add(i.multiply(.7)),l=this.v3.add(e.multiply(p)),e=this.v3.add(e.multiply(.7)),s=this.v4.add(s.multiply(p));v.beginPath(),v.fillStyle=this.calculateColor(),v.moveTo(n.ctxPos().x,n.ctxPos().y),v.lineTo(t.ctxPos().x,t.ctxPos().y),v.quadraticCurveTo(this.v2.ctxPos().x,this.v2.ctxPos().y,o.ctxPos().x,o.ctxPos().y),v.lineTo(i.ctxPos().x,i.ctxPos().y),v.quadraticCurveTo(this.v3.ctxPos().x,this.v3.ctxPos().y,l.ctxPos().x,l.ctxPos().y),v.lineTo(e.ctxPos().x,e.ctxPos().y),v.quadraticCurveTo(this.v4.ctxPos().x,this.v4.ctxPos().y,s.ctxPos().x,s.ctxPos().y),v.lineTo(h.ctxPos().x,h.ctxPos().y),v.quadraticCurveTo(this.v1.ctxPos().x,this.v1.ctxPos().y,n.ctxPos().x,n.ctxPos().y),v.fill()},this.calculateColor=function(){var t=this.horizontalVector,s=this.verticalVector,s=Math.abs(t.x*s.y-s.x*t.y)/8;{var h=this.color,n=s-.5;(h=String(h).replace(/[^0-9a-f]/gi,"")).length<6&&(h=h[0]+h[0]+h[1]+h[1]+h[2]+h[2]),n=n||0;let t="#",i,e;for(e=0;e<3;e++)i=parseInt(h.substr(2*e,2),16),i=Math.round(Math.min(Math.max(0,i+i*n),255)).toString(16),t+=("00"+i).substr(i.length);return t}}}function D(t,i,e){this.x=t||0,this.y=i||0,this.z=e||0,this.set=function(t,i,e){"number"==typeof t?(this.x=t||0,this.y=i||0,this.z=e||0):(this.x=t.x,this.y=t.y,this.z=t.z)},this.distance=function(t){return Math.sqrt(Math.pow(t.x-this.x,2)+Math.pow(t.y-this.y,2))}}function V(t,i,e){this.x=t||0,this.y=i||0,this.z=e||0,this.pos=new D(t,i,e),this.angle2D=function(){var t=Math.atan2(this.y,this.x);return 0<t?t:2*n+t},this.ctxPos=function(){return this.scale(this)},this.scale=function(t){return{x:A+t.x*d,y:O-t.y*d}},this.rotate=function(t){this.setCurrentPos(t.dotProduct(this.pos))},this.len=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))},this.norm=function(){var t=this.len();this.x/=t,this.y/=t,this.z/=t},this.dotProduct=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},this.crossProduct=function(t){return new V(this.y*t.z-t.y*this.z,this.z*t.x-t.z*this.x,this.x*t.y-t.x*this.y)},this.set=function(t,i,e){this.x=t||0,this.y=i||0,this.z=e||0},this.setV=function(t){this.setCurrentPos(t)},this.setCurrentPos=function(t){this.x=t.x,this.y=t.y,this.z=t.z},this.setStartPoss=function(t){this.pos.x=t.x,this.pos.y=t.y,this.pos.z=t.z},this.updatePos=function(){this.pos.x=this.x,this.pos.y=this.y,this.pos.z=this.z},this.toVector=function(t){return new V(t.x-this.x,t.y-this.y,t.z-this.z)},this.add=function(t){return new V(t.x+this.x,t.y+this.y,t.z+this.z)},this.subtract=function(t){return new V(this.x-t.x,this.y-t.y,this.z-t.z)},this.multiply=function(t){return new V(t*this.x,t*this.y,t*this.z)}}function at(t,i,e){this.v1=t,this.v2=i,this.v3=e,this.result=new D,this.dotProduct=function(t){return this.result.x=this.v1.x*t.x+this.v1.y*t.y+this.v1.z*t.z,this.result.y=this.v2.x*t.x+this.v2.y*t.y+this.v2.z*t.z,this.result.z=this.v3.x*t.x+this.v3.y*t.y+this.v3.z*t.z,this.result}}function ct(t,i,e){at.call(this,t,i,e),this.updateMatrix=function(t,i){var e=Math.cos(i),i=Math.sin(i),s=1-e,h=t.x,n=t.y,t=t.z;this.v1.set(s*h*h+e,s*h*n-t*i,s*h*t+n*i),this.v2.set(s*h*n+t*i,s*n*n+e,s*n*t-h*i),this.v3.set(s*h*t-n*i,s*n*t+h*i,s*t*t+e)}}function B(t,i,e,s,h){this.top=t,this.bottom=i,this.left=e,this.right=s,this.parall=h,this.get=function(t){return 1===t?this.top:2===t?this.bottom:3===t?this.left:4===t?this.right:void 0}}function N(t,i,e,s){let h,n,o,l,r,a;var c=(i.x-t.x)/3,u=(i.y-t.y)/3,x=(i.z-t.z)/3,v=[];if(0==c)for(a=0;a<3;a++)for(r=0;r<3;r++)l=new V(t.x,t.y+a*u,t.z+r*x),o=new V(t.x,t.y+a*u,t.z+(1+r)*x),n=new V(t.x,t.y+(1+a)*u,t.z+(1+r)*x),h=new V(t.x,t.y+(1+a)*u,t.z+r*x),v.push(new C(l,o,n,h,e,3*a+r,s));if(0==u)for(a=0;a<3;a++)for(r=0;r<3;r++)l=new V(t.x+r*c,t.y,t.z+a*x),o=new V(t.x+(1+r)*c,t.y,t.z+a*x),n=new V(t.x+(1+r)*c,t.y,t.z+(1+a)*x),h=new V(t.x+r*c,t.y,t.z+(1+a)*x),v.push(new C(l,o,n,h,e||ut(),3*a+r,s));if(0==x)for(a=0;a<3;a++)for(r=0;r<3;r++)l=new V(t.x+r*c,t.y+a*u,t.z),o=new V(t.x+(1+r)*c,t.y+a*u,t.z),n=new V(t.x+(1+r)*c,t.y+(1+a)*u,t.z),h=new V(t.x+r*c,t.y+(1+a)*u,t.z),v.push(new C(l,o,n,h,e||ut(),3*a+r,s));return v}function ut(){var i="0123456789ABCDEF".split("");let e="#";for(let t=0;t<6;t++)e+=i[Math.floor(16*Math.random())];return e}function xt(){f=window.innerHeight,t=window.innerWidth,A=t/2,O=f/2,x.height=f,x.width=t,d=Math.round(.08*(f<t?f:t)-6),d=Math.min(Math.max(d,5),55),w.bgGradient=v.createLinearGradient(0,0,0,f),w.bgGradient.addColorStop(0,w.bg1),w.bgGradient.addColorStop(.66,w.bg2),w.bgGradient.addColorStop(.75,w.bg3),w.bgGradient.addColorStop(.85,w.bg2),w.bgGradient.addColorStop(1,w.bg1),c=55/d*36,J=4*d,Z=40<d?4:30<d?3:20<d?2:1}function vt(){d<q?(r+=1,d+=2,setTimeout(vt,50)):(E.updatePosition(),r=0,ft())}function ft(){var t;(j<W?(j++,t=pt(1,4),y=90*t,H=y/5,E.setVariableToShake(pt(0,6),pt(0,9),pt(1,5)),m.shakeProcess=!0,dt):(m.shakeProcess=!1,yt))()}function dt(){1<Math.abs(a-y)?(a+=H,setTimeout(dt,50)):(a=y,E.calculateAngle(),E.transform(),E.reset(),a=0,setTimeout(ft,100))}function pt(t,i){return Math.floor(Math.random()*(i-t))+t}function yt(){document.querySelector(".info").classList.add("hidden"),document.addEventListener("mouseup",st),document.addEventListener("touchmove",ot),x.addEventListener("mousedown",ht),x.addEventListener("mouseup",st),x.addEventListener("mousemove",it),x.addEventListener("touchstart",nt),x.addEventListener("contextmenu",t=>(t.preventDefault(),!1)),x.addEventListener("touchend",lt),x.addEventListener("touchmove",ot)}(ct.prototype=Object.create(at.prototype)).constructor=ct,window.addEventListener("resize",xt),x=document.getElementById("cubic"),"function"==typeof(v=x.getContext("2d")).ellipse&&(Y=!0),xt(),G=document.querySelector(".info"),"ontouchstart"in document.documentElement?G.style.display="none":(P=.25*t+"px",F=4/3.3*.25*t+"px",G.style.width=P,G.style.height=F,G.style.backgroundSize=P+" "+F),q=d,d=2,setInterval(rt,50),vt();