ENGINE={cal:function(){for(var e=100,t=100,n=0,a=0,r=SET.nemStratum-1;-1<r;r--)a=(n=t-(e=t*SET.stratumVal[r].ir))/t,SET.IR[r].przech=e.toFixed(2),SET.IR[r].odbi=n.toFixed(2),SET.IR[r].albedo=a.toFixed(2),t=e;SET.tauIR=e/100;for(t=100,r=0;r<SET.nemStratum;r++)a=(n=t-(e=t*SET.stratumVal[r].vis))/t,SET.Vis[r].przech=e.toFixed(2),SET.Vis[r].odbi=n.toFixed(2),SET.Vis[r].albedo=a.toFixed(2),t=e;SET.tauVis=e/100,SET.temp=Math.pow(SET.sun*(1-SET.wAlbedo)*(1+SET.tauVis)/(SET.boltz*(1+SET.tauIR)),.25)-273,document.getElementById("tmperature").innerHTML=SET.temp.toFixed(2)+"&deg;C",document.getElementById("tmperature").style.color=ENGINE.setTempColor(SET.temp)},setTempColor:function(e){var t;return e<0?(e=e<-20?-20:e,"rgb( 0,"+(255-2*(t=parseInt(254*Math.abs(e/20)*.5)))+", "+(255-t)+")"):(e=30<e?-30:e,"rgb( "+(126+(t=parseInt(254*Math.abs(e/30)*.5)))+" ,0,0)")}};var CANV=CANV||{};CANV.init=function(){CANV.canv=document.getElementById("climatModel"),CANV.all=document.getElementById("all"),CANV.cont=document.getElementById("control"),CANV.ctx=CANV.canv.getContext("2d")},CANV.draw=function(){CANV.ctx.clearRect(0,0,SET.x,SET.y),CANV.drawStatElement(),CANV.drawAtmosfer(),ENGINE.cal()},CANV.drawStatElement=function(){for(var e=0;e<SET.x+60;e+=60)CANV.ctx.drawImage(SET.img[SET.ground],e,SET.y-47,60,47);CANV.ctx.drawImage(SET.img[7],0,-50,300,100)},CANV.drawAtmosfer=function(){var e=(400-20*SET.nemStratum+20)/SET.nemStratum,t=0;CANV.drawArrowDown(50,100+.5*e-10,80,30,"yellow",SET.sun),CANV.drawArrowTop(3,100+.5*e-10,SET.x-100,50,"orange",SET.IR[0].przech+"%");for(var n=0,a=100;n<SET.nemStratum;n++,a+=20+e){CANV.ctx.fillStyle="rgba(228, 228, 228, 0.32)",CANV.ctx.beginPath(),CANV.ctx.rect(0,a,SET.x,e),CANV.ctx.closePath(),CANV.ctx.fill();for(var r=0;r<1e3;r++)CANV.ctx.beginPath(),CANV.ctx.arc(SET.ran[r+n]*SET.x,a+SET.ran[r+n+1]*e,1,0,2*Math.PI,!1),CANV.ctx.fillStyle="rgba(76, 56, 218, 0.61)",CANV.ctx.fill();var o=50+(n+1)/SET.nemStratum*25;t+=1.1*o,n+1!==SET.nemStratum?(CANV.drawArrowDown(a+.5*e,a+1.5*e,80,30-2*n,"yellow",SET.Vis[n].przech+"%"),CANV.drawArrowTop(a+.5*e,a+1.5*e,SET.x-100-t,o,"orange",SET.IR[n+1].przech+"%"),CANV.drawArrowDown(a+.5*e,a+1.5*e,SET.x-100-t+2*o,20,"orange",((SET.IR[n+1].przech-SET.IR[n].przech)/2).toFixed(2)+"%")):(CANV.drawArrowDown(a+.5*e,SET.y-50,80,30-2*n,"yellow",SET.Vis[n].przech+"%"),CANV.drawArrowTop(a+.5*e,SET.y-30,SET.x-100-t,o,"orange","100%"),CANV.drawArrowDown(a+.5*e,SET.y-30,SET.x-100-t+2*o,20,"orange",((100-SET.IR[n].przech)/2).toFixed(2)+"%"))}CANV.drawArrowTop(50,SET.y-130,180,25,"yellow",(100-SET.Vis[SET.nemStratum-1].przech).toFixed(2)+"%")},CANV.drawArrowDown=function(e,t,n,a,r,o){CANV.ctx.beginPath(),CANV.ctx.moveTo(n-a,e),CANV.ctx.lineTo(n+a,e),CANV.ctx.lineTo(n+a,e+.75*(t-e)),CANV.ctx.lineTo(n+2*a,e+.75*(t-e)),CANV.ctx.lineTo(n,t),CANV.ctx.lineTo(n-2*a,e+.75*(t-e)),CANV.ctx.lineTo(n-a,e+.75*(t-e)),CANV.ctx.moveTo(n-a,e),CANV.ctx.fillStyle=r,CANV.ctx.strokeStyle=r,CANV.ctx.fill(),CANV.ctx.stroke(),CANV.ctx.font="16pt Calibri",CANV.ctx.fillStyle="black",CANV.ctx.textAlign="center",CANV.ctx.textBaseline="top",CANV.ctx.fillText(o,n,e)},CANV.drawArrowTop=function(e,t,n,a,r,o){CANV.ctx.beginPath(),CANV.ctx.moveTo(n-a,t),CANV.ctx.lineTo(n+a,t),CANV.ctx.lineTo(n+a,t-.75*(t-e)),CANV.ctx.lineTo(n+1.5*a,t-.75*(t-e)),CANV.ctx.lineTo(n,e),CANV.ctx.lineTo(n-1.5*a,t-.75*(t-e)),CANV.ctx.lineTo(n-a,t-.75*(t-e)),CANV.ctx.moveTo(n-a,t),CANV.ctx.fillStyle=r,CANV.ctx.strokeStyle=r,CANV.ctx.fill(),CANV.ctx.stroke(),CANV.ctx.font="16pt Calibri",CANV.ctx.fillStyle="black",CANV.ctx.textAlign="center",CANV.ctx.textBaseline="top",CANV.ctx.fillText(o,n,e+10)};(SET=SET||{}).initSet=function(){var e=document.getElementById("albedo1"),t=document.getElementById("albedo2");e.addEventListener("change",SET.checkAlbedo1),t.addEventListener("change",SET.checkAlbedo2),document.getElementById("albedo_select").addEventListener("change",SET.checkAlbedo1),document.getElementById("albedo_val").addEventListener("change",SET.checkAlbedo2),document.getElementById("atmo").addEventListener("change",SET.changeNemberOfStratum),document.getElementById("sun_const").addEventListener("change",SET.changeSunConst)};var SET=SET||{};for(i in(SET={boltz:5.67e-8,sun:343.5,wAlbedo:.3,tauIR:.3,tauVis:.5,nemStratum:1,stratumVal:[{ir:.2,vis:.8},{ir:.2,vis:.8},{ir:.2,vis:.8},{ir:.2,vis:.8},{ir:.2,vis:.8}],all_IR:.5,IR:[{przech:.5,odbi:.5,albedo:.5},{przech:.5,odbi:.5,albedo:.5},{przech:.5,odbi:.5,albedo:.5},{przech:.5,odbi:.5,albedo:.5},{przech:.5,odbi:.5,albedo:.5}],all_Vis:.5,Vis:[{przech:.5,odbi:.5,albedo:.5},{przech:.5,odbi:.5,albedo:.5},{przech:.5,odbi:.5,albedo:.5},{przech:.5,odbi:.5,albedo:.5},{przech:.5,odbi:.5,albedo:.5}],x:300,y:300,ran:[],temp:10,nam:["/projects/temp/image/crops.png","/projects/temp/image/desert.png","/projects/temp/image/forest.png","/projects/temp/image/ice.png","/projects/temp/image/meadow.png","/projects/temp/image/snow.png","/projects/temp/image/soil.png","/projects/temp/image/sun.png","/projects/temp/image/water.png"],img:[]}).nam){var img=new Image;img.src=SET.nam[i],SET.img.push(img)}SET.ground=6;for(var k=0;k<3e4;k++)SET.ran.push(Math.random());SET.checkAlbedo1=function(){document.getElementById("albedo1").checked&&(SET.wAlbedo=parseFloat(document.querySelector("select#albedo_select option:selected").value),SET.ground=parseInt(document.querySelector("select#albedo_select option:selected").dataset.gr))},SET.checkAlbedo2=function(){document.getElementById("albedo2").checked&&(SET.wAlbedo=parseFloat(document.querySelector("input#albedo_val").value),document.querySelector("#albedo_val_view").innerText=SET.wAlbedo,SET.ground=6)},SET.changeNemberOfStratum=function(){for(var e in SET.nemStratum=parseFloat(document.querySelector("input#atmo").value),document.querySelector("#atmo_val").innerText=SET.nemStratum,SET.addInputRangeStratum(),SET.changeValueIrAndVis(),SET.stratumVal)SET.stratumVal[e].ir=.2,SET.stratumVal[e].vis=.8},SET.changeSunConst=function(){SET.sun=parseInt(document.querySelector("input#sun_const").value)/4,document.querySelector("#sun_const_val").text(parseInt(document.querySelector("input#sun_const").value))},SET.addInputRangeStratum=function(){for(var e=document.getElementById("eachStratum"),t=document.createElement("table"),n=document.createElement("tbody"),a=0;a<SET.nemStratum;a++){var r=document.createElement("tr"),o=document.createElement("td"),d=document.createTextNode(a+1+" WARSTWA"),c=(o.setAttribute("colSpan","3"),o.appendChild(d),o.style.textAlign="center",r.appendChild(o),n.appendChild(r),r=document.createElement("tr"),o=document.createElement("td"),d=document.createTextNode("IR"),o.appendChild(d),r.appendChild(o),o=document.createElement("td"),document.createElement("input"));c.setAttribute("type","range"),c.setAttribute("min","0"),c.setAttribute("max","1"),c.setAttribute("step","0.01"),c.setAttribute("value","0.2"),c.setAttribute("data-tau","IR"),c.setAttribute("data-index",a),c.setAttribute("id","t_IR_"+a),o.appendChild(c),r.appendChild(o),o=document.createElement("td"),d=document.createTextNode("0.2"),o.setAttribute("id","tau_IR_val_"+a),o.appendChild(d),r.appendChild(o),n.appendChild(r),r=document.createElement("tr"),o=document.createElement("td"),d=document.createTextNode("Vis"),o.appendChild(d),r.appendChild(o),o=document.createElement("td"),(c=document.createElement("input")).setAttribute("type","range"),c.setAttribute("min","0"),c.setAttribute("max","1"),c.setAttribute("step","0.01"),c.setAttribute("value","0.8"),c.setAttribute("data-tau","Vis"),c.setAttribute("data-index",a),c.setAttribute("id","t_Vis_"+a),o.appendChild(c),r.appendChild(o),o=document.createElement("td"),d=document.createTextNode("0.8"),o.setAttribute("id","tau_Vis_val_"+a),o.appendChild(d),r.appendChild(o),n.appendChild(r)}t.appendChild(n),e.innerHTML="",e.appendChild(t)},SET.changeValueIrAndVis=function(){[...document.querySelectorAll("#eachStratum input")].forEach(e=>{e.addEventListener("input",()=>{"IR"===e.dataset.tau?(SET.stratumVal[parseInt(e.dataset.index)].ir=e.value,document.querySelector("#tau_IR_val_"+e.dataset.index).innerText=e.value):(SET.stratumVal[parseInt(e.dataset.index)].vis=e.value,document.querySelector("#tau_Vis_val_"+e.dataset.index).innerText=e.value)})})};SET=SET||{};(CANV=CANV||{}).set=function(){CANV.init(),SET.y=CANV.canv.height=600,CANV.all.style.height=CANV.cont.style.height="600px",SET.x=CANV.canv.width=1e3,CANV.all.style.width=CANV.canv.width+251+"px",SET.addInputRangeStratum(),SET.changeValueIrAndVis(),setInterval(CANV.draw,50)},CANV.set();