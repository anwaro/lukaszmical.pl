ENGINE={cal:function(){for(var e=100,t=100,n=0,a=0,r=l.nemStratum-1;-1<r;r--)a=(n=t-(e=t*l.stratumVal[r].ir))/t,l.IR[r].przech=e.toFixed(2),l.IR[r].odbi=n.toFixed(2),l.IR[r].albedo=a.toFixed(2),t=e;l.tauIR=e/100;for(t=100,r=0;r<l.nemStratum;r++)a=(n=t-(e=t*l.stratumVal[r].vis))/t,l.Vis[r].przech=e.toFixed(2),l.Vis[r].odbi=n.toFixed(2),l.Vis[r].albedo=a.toFixed(2),t=e;l.tauVis=e/100,l.temp=Math.pow(l.sun*(1-l.wAlbedo)*(1+l.tauVis)/(l.boltz*(1+l.tauIR)),.25)-273,document.getElementById("tmperature").innerHTML=l.temp.toFixed(2)+"&deg;C",document.getElementById("tmperature").style.color=ENGINE.setTempColor(l.temp)},setTempColor:function(e){var t;return e<0?(e=e<-20?-20:e,"rgb( 0,"+(255-2*(t=parseInt(254*Math.abs(e/20)*.5)))+", "+(255-t)+")"):(e=30<e?-30:e,"rgb( "+(126+(t=parseInt(254*Math.abs(e/30)*.5)))+" ,0,0)")}};var d=d||{};for(i in d.init=function(){d.canv=document.getElementById("climatModel"),d.all=document.getElementById("all"),d.cont=document.getElementById("control"),d.ctx=d.canv.getContext("2d")},d.draw=function(){d.ctx.clearRect(0,0,l.x,l.y),d.drawStatElement(),d.drawAtmosfer(),ENGINE.cal()},d.drawStatElement=function(){for(var e=0;e<l.x+60;e+=60)d.ctx.drawImage(l.img[l.ground],e,l.y-47,60,47);d.ctx.drawImage(l.img[7],0,-50,300,100)},d.drawAtmosfer=function(){var e=(400-20*l.nemStratum+20)/l.nemStratum,t=0;d.drawArrowDown(50,100+.5*e-10,80,30,"yellow",l.sun),d.drawArrowTop(3,100+.5*e-10,l.x-100,50,"orange",l.IR[0].przech+"%");for(var n=0,a=100;n<l.nemStratum;n++,a+=20+e){d.ctx.fillStyle="rgba(228, 228, 228, 0.32)",d.ctx.beginPath(),d.ctx.rect(0,a,l.x,e),d.ctx.closePath(),d.ctx.fill();for(var r=0;r<1e3;r++)d.ctx.beginPath(),d.ctx.arc(l.ran[r+n]*l.x,a+l.ran[r+n+1]*e,1,0,2*Math.PI,!1),d.ctx.fillStyle="rgba(76, 56, 218, 0.61)",d.ctx.fill();var o=50+(n+1)/l.nemStratum*25;t+=1.1*o,n+1!==l.nemStratum?(d.drawArrowDown(a+.5*e,a+1.5*e,80,30-2*n,"yellow",l.Vis[n].przech+"%"),d.drawArrowTop(a+.5*e,a+1.5*e,l.x-100-t,o,"orange",l.IR[n+1].przech+"%"),d.drawArrowDown(a+.5*e,a+1.5*e,l.x-100-t+2*o,20,"orange",((l.IR[n+1].przech-l.IR[n].przech)/2).toFixed(2)+"%")):(d.drawArrowDown(a+.5*e,l.y-50,80,30-2*n,"yellow",l.Vis[n].przech+"%"),d.drawArrowTop(a+.5*e,l.y-30,l.x-100-t,o,"orange","100%"),d.drawArrowDown(a+.5*e,l.y-30,l.x-100-t+2*o,20,"orange",((100-l.IR[n].przech)/2).toFixed(2)+"%"))}d.drawArrowTop(50,l.y-130,180,25,"yellow",(100-l.Vis[l.nemStratum-1].przech).toFixed(2)+"%")},d.drawArrowDown=function(e,t,n,a,r,o){d.ctx.beginPath(),d.ctx.moveTo(n-a,e),d.ctx.lineTo(n+a,e),d.ctx.lineTo(n+a,e+.75*(t-e)),d.ctx.lineTo(n+2*a,e+.75*(t-e)),d.ctx.lineTo(n,t),d.ctx.lineTo(n-2*a,e+.75*(t-e)),d.ctx.lineTo(n-a,e+.75*(t-e)),d.ctx.moveTo(n-a,e),d.ctx.fillStyle=r,d.ctx.strokeStyle=r,d.ctx.fill(),d.ctx.stroke(),d.ctx.font="16pt Calibri",d.ctx.fillStyle="black",d.ctx.textAlign="center",d.ctx.textBaseline="top",d.ctx.fillText(o,n,e)},d.drawArrowTop=function(e,t,n,a,r,o){d.ctx.beginPath(),d.ctx.moveTo(n-a,t),d.ctx.lineTo(n+a,t),d.ctx.lineTo(n+a,t-.75*(t-e)),d.ctx.lineTo(n+1.5*a,t-.75*(t-e)),d.ctx.lineTo(n,e),d.ctx.lineTo(n-1.5*a,t-.75*(t-e)),d.ctx.lineTo(n-a,t-.75*(t-e)),d.ctx.moveTo(n-a,t),d.ctx.fillStyle=r,d.ctx.strokeStyle=r,d.ctx.fill(),d.ctx.stroke(),d.ctx.font="16pt Calibri",d.ctx.fillStyle="black",d.ctx.textAlign="center",d.ctx.textBaseline="top",d.ctx.fillText(o,n,e+10)},(l=l||{}).initSet=function(){var e=document.getElementById("albedo1"),t=document.getElementById("albedo2");e.addEventListener("change",l.checkAlbedo1),t.addEventListener("change",l.checkAlbedo2),document.getElementById("albedo_select").addEventListener("change",l.checkAlbedo1),document.getElementById("albedo_val").addEventListener("change",l.checkAlbedo2),document.getElementById("atmo").addEventListener("change",l.changeNemberOfStratum),document.getElementById("sun_const").addEventListener("change",l.changeSunConst)},(l={...l=l||{},boltz:5.67e-8,sun:343.5,wAlbedo:.3,tauIR:.3,tauVis:.5,nemStratum:1,stratumVal:[{ir:.2,vis:.8},{ir:.2,vis:.8},{ir:.2,vis:.8},{ir:.2,vis:.8},{ir:.2,vis:.8}],all_IR:.5,IR:[{przech:.5,odbi:.5,albedo:.5},{przech:.5,odbi:.5,albedo:.5},{przech:.5,odbi:.5,albedo:.5},{przech:.5,odbi:.5,albedo:.5},{przech:.5,odbi:.5,albedo:.5}],all_Vis:.5,Vis:[{przech:.5,odbi:.5,albedo:.5},{przech:.5,odbi:.5,albedo:.5},{przech:.5,odbi:.5,albedo:.5},{przech:.5,odbi:.5,albedo:.5},{przech:.5,odbi:.5,albedo:.5}],x:300,y:300,ran:[],temp:10}).nam=["/projects/temp/image/crops.png","/projects/temp/image/desert.png","/projects/temp/image/forest.png","/projects/temp/image/ice.png","/projects/temp/image/meadow.png","/projects/temp/image/snow.png","/projects/temp/image/soil.png","/projects/temp/image/sun.png","/projects/temp/image/water.png"],l.img=[],l.nam){var e=new Image;e.src=l.nam[i],l.img.push(e)}l.ground=6;for(var t=0;t<3e4;t++)l.ran.push(Math.random());l.checkAlbedo1=function(){document.getElementById("albedo1").checked&&(l.wAlbedo=parseFloat(document.querySelector("select#albedo_select option:checked").value),l.ground=parseInt(document.querySelector("select#albedo_select option:checked").dataset.gr))},l.checkAlbedo2=function(){document.getElementById("albedo2").checked&&(l.wAlbedo=parseFloat(document.querySelector("input#albedo_val").value),document.querySelector("#albedo_val_view").innerText=l.wAlbedo,l.ground=6)},l.changeNemberOfStratum=function(){for(var e in l.nemStratum=parseFloat(document.querySelector("input#atmo").value),document.querySelector("#atmo_val").innerText=l.nemStratum,l.addInputRangeStratum(),l.changeValueIrAndVis(),l.stratumVal)l.stratumVal[e].ir=.2,l.stratumVal[e].vis=.8},l.changeSunConst=function(){l.sun=parseInt(document.querySelector("input#sun_const").value)/4,document.querySelector("#sun_const_val").innerText=parseInt(document.querySelector("input#sun_const").value)},l.addInputRangeStratum=function(){for(var e=document.getElementById("eachStratum"),t=document.createElement("table"),n=document.createElement("tbody"),a=0;a<l.nemStratum;a++){var r=document.createElement("tr"),o=document.createElement("td"),d=document.createTextNode(a+1+" WARSTWA"),c=(o.setAttribute("colSpan","3"),o.appendChild(d),o.style.textAlign="center",r.appendChild(o),n.appendChild(r),r=document.createElement("tr"),o=document.createElement("td"),d=document.createTextNode("IR"),o.appendChild(d),r.appendChild(o),o=document.createElement("td"),document.createElement("input"));c.setAttribute("type","range"),c.setAttribute("min","0"),c.setAttribute("max","1"),c.setAttribute("step","0.01"),c.setAttribute("value","0.2"),c.setAttribute("data-tau","IR"),c.setAttribute("data-index",a),c.setAttribute("id","t_IR_"+a),o.appendChild(c),r.appendChild(o),o=document.createElement("td"),d=document.createTextNode("0.2"),o.setAttribute("id","tau_IR_val_"+a),o.appendChild(d),r.appendChild(o),n.appendChild(r),r=document.createElement("tr"),o=document.createElement("td"),d=document.createTextNode("Vis"),o.appendChild(d),r.appendChild(o),o=document.createElement("td"),(c=document.createElement("input")).setAttribute("type","range"),c.setAttribute("min","0"),c.setAttribute("max","1"),c.setAttribute("step","0.01"),c.setAttribute("value","0.8"),c.setAttribute("data-tau","Vis"),c.setAttribute("data-index",a),c.setAttribute("id","t_Vis_"+a),o.appendChild(c),r.appendChild(o),o=document.createElement("td"),d=document.createTextNode("0.8"),o.setAttribute("id","tau_Vis_val_"+a),o.appendChild(d),r.appendChild(o),n.appendChild(r)}t.appendChild(n),e.innerHTML="",e.appendChild(t)},l.changeValueIrAndVis=function(){[...document.querySelectorAll("#eachStratum input")].forEach(e=>{e.addEventListener("input",()=>{"IR"===e.dataset.tau?(l.stratumVal[parseInt(e.dataset.index)].ir=e.value,document.querySelector("#tau_IR_val_"+e.dataset.index).innerText=e.value):(l.stratumVal[parseInt(e.dataset.index)].vis=e.value,document.querySelector("#tau_Vis_val_"+e.dataset.index).innerText=e.value)})})};var l=l||{};(d=d||{}).set=function(){d.init(),l.y=d.canv.height=600,d.all.style.height=d.cont.style.height="600px",l.x=d.canv.width=1e3,d.all.style.width=d.canv.width+251+"px",l.initSet(),l.addInputRangeStratum(),l.changeValueIrAndVis(),setInterval(d.draw,50)},d.set();