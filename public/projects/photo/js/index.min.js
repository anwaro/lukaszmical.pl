($photo=new function(){var t,c,l,g,a,r,u,s=[],f=25;function e(){var e;a.files&&a.files[0]&&(e=new FileReader,r=new Image,e.readAsDataURL(a.files[0])),e.onload=function(e){r.src=e.target.result,document.getElementById("img").src=e.target.result,r.onload=function(){t.width=this.width,t.height=this.height,c.width=this.width,c.height=this.height,g.drawImage(r,0,0),n()}}}function n(){var e=(u=g.getImageData(0,0,c.width,c.height)).data,t=u.width,a=[];s=[];for(var r,n,h=0,i=0;h<e.length;h+=4)r=++i%t,a.push({r:e[h],g:e[h+1],b:e[h+2],a:e[h+3]}),r||(s.push(a),a=[]);if(f=parseInt(document.getElementById("range").value),document.querySelector("#pixel").checked){for(h=0;h<u.width;h+=f)for(i=0;i<u.height;i+=f)m(h,i);for(var i=0,o=0;i<u.height;i++)for(h=0;h<u.width;h++)u.data[o]=s[i][h].r,u.data[o+1]=s[i][h].g,u.data[o+2]=s[i][h].b,u.data[o+3]=s[i][h].a,o+=4;l.putImageData(u,0,0)}else if(document.querySelector("#circle").checked){f=Math.max(f,5),l.clearRect(0,0,u.width,u.height);for(h=0;h<u.width;h+=f)for(i=0;i<u.height;i+=f)l.fillStyle=m(h,i),l.beginPath(),l.arc(h+.5*f,i+.5*f,.5*f,0,2*Math.PI,!0),l.closePath(),l.fill()}else if(document.querySelector("#dots").checked){f=5,l.clearRect(0,0,u.width,u.height);for(h=0;h<u.width;h+=f)for(i=0;i<u.height;i+=f){n=.2*(255-m(h,i,!0)),l.fillStyle="black";for(var d=0;d<n;d++)l.beginPath(),l.arc(h+Math.random()*f,i+Math.random()*f,.5,0,2*Math.PI,!0),l.closePath(),l.fill()}}}function m(e,t,a){a=a||0;for(var r=0,n=0,h=0,i=0,o=Math.min(e+f,u.width),d=Math.min(t+f,u.height),c=0,l=t;l<d;l++)for(var g=e;g<o;g++)r+=s[l][g].r,n+=s[l][g].g,h+=s[l][g].b,i+=s[l][g].a,c++;r/=c,n/=c,h/=c,i/=c;for(l=t;l<d;l++)for(g=e;g<o;g++)s[l][g].r=r,s[l][g].g=n,s[l][g].b=h,s[l][g].a=i;t=parseInt((r+n+h)/3);return a?t:"rgb( "+parseInt(r)+", "+parseInt(n)+", "+parseInt(h)+")"}this.init=function(){t=document.getElementById("photoCanvas"),c=document.getElementById("photoHide"),a=document.querySelector("#photo"),t&&t.getContext&&(l=t.getContext("2d"),g=c.getContext("2d"),a.addEventListener("change",e),document.querySelector("#range").addEventListener("change",n),document.querySelector("#pixel").addEventListener("change",n),document.querySelector("#circle").addEventListener("change",n),document.querySelector("#dots").addEventListener("change",n))}}).init();