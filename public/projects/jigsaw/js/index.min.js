var t,a,o,i,n,c,s,u,$=3,d=3,l=[],f=!1;function r(e,t){var a,r;$$.addEvent(window,"keyup",h),n=$$("#puzzleArea"),c=$$("#puzzleAreaLay"),window.innerHeight,s=window.innerWidth-25,n.width(s),"KOM"===e?($$("#select").fadeOut(300,function(){$$("#puzzleArea").fadeIn(300)}),a=new FileReader,r=$$("#image"),a.onload=function(e){src=e.target.result,m()},a.readAsDataURL(r.files[0])):(src="URL"===e?($$("#select").fadeOut(300,function(){$$("#puzzleArea").fadeIn(300)}),$$("#photoURL").value):($$("#sample").fadeOut(300,function(){$$("#puzzleArea").fadeIn(300)}),"/projects/jigsaw/image/img"+(t||1)+".jpg"),m())}function p(){for(var e=0,t=0;e<d;e++)for(var a=0;a<$;a++){t++;var r=$$("<div>");r.addClass("block").height(o).width(i).css("background","url("+src+") -"+a*i+"px -"+e*o+"px"),l.push(new v(r,t))}l.pop(),l=function(e){for(var t,a,r=e.length;r;t=Math.floor(Math.random()*r),a=e[--r],e[r]=e[t],e[t]=a);return e}(l);for(e=0,t=0;e<d;e++)for(a=0;a<d&&t<l.length;a++)l[t].currNum=t+1,l[t].el.css({left:a*i+"px",top:e*o+"px"}),c.appendChild(l[t].el),t++}function m(){var e=new Image;e.onload=function(){t=e.width,a=e.height,s<t?$$.delay(function(){$$("#select").show(),$$("#puzzleArea").hide(),w("Zbyt wielki rozmiar obrazka!",0)},1e3):($$("#puzzleAreaLay").width(t+.01+2*$).height(a+.01+2*d).show(),$$("#imageView").src=src,$$("#imageView").height=t/a*200,$$("#imageView").show(),o=a/d,i=t/$,u=d*$,p())},e.src=src}function h(e){switch(e.keyCode){case 37:u%$&&g(u+1,-1,0),e.stopPropagation();break;case 39:(u-1)%$&&g(u-1,1,0),e.stopPropagation();break;case 40:0<u-$&&g(u-$,0,1),e.stopPropagation();break;case 38:u+$<=$*d&&g(u+$,0,-1),e.stopPropagation()}}function g(e,t,a){var r,n;f||(r=(e=function(e){for(var t=0;t<l.length;t++)if(l[t].currNum===e)return l[t]}(e)).currNum,e.currNum=u,u=r,r=parseFloat(e.el.css("top")),n=parseFloat(e.el.css("left")),e.el.css({left:n+t*i+"px",top:r+a*o+"px"}),f=!0,!function(){for(var e=!0,t=0;t<l.length;t++)l[t].currNum!==l[t].passNum&&(e=!1);return e}()?setTimeout(function(){f=!1},110):w("Brawo! Udało Ci się ułożyć wszystkie elementy",1))}function w(e,t){$$(".MSG").fadeIn().setText(e).removeClass("ok").removeClass("error").addClass(t?"ok":"error")}function v(e,t){this.el=e,this.passNum=t,this.currNum=0}document.querySelector("#reset").addEventListener("click",function(){$$("#puzzleArea").fadeOut(300,function(){$$("#select").fadeIn(300),$$("#puzzleAreaLay").empty()}),$$("#sample").hide(),$$(".MSG").hide(),$$("#imageView").src="",$$("#imageView").hide(),f=!(l=[])}),document.querySelector("#select1").addEventListener("click",()=>{$$(".URL").hide(),$$("#image").click()}),document.querySelector("#select2").addEventListener("click",()=>{$$(".URL").fadeIn()}),document.querySelector("#select3").addEventListener("click",()=>{$$(".URL").hide(),$$("#select").fadeOut(300,function(){$$("#sample").fadeIn(300)})}),document.querySelector("#confirmURL").addEventListener("click",function(){var e=new Image;e.onload=function(){$$(".URL").hide(),r("URL")},e.onerror=function(){w("Nie znaleziono obarazka o podanym URL",0)},e.src=$$("#photoURL").value}),document.querySelector("#message").addEventListener("click",e=>{$$(e.currentTarget).fadeOut()}),document.querySelector("#image").addEventListener("change",()=>{r("KOM")}),window.newGame=r;