var colorPicker={canvas:"",ctx:"",height:"",width:"",img:"",colorRgba:"rgba(255,0,0,0)",colorRgbaObj:{r:255,g:0,b:0,a:1},colorHsv:"",colorHex:"",element:"",install:function(r){colorPicker.canvas=document.getElementById("colorPicker"),colorPicker.element=!!r.element&&document.getElementById(r.element),window.addEventListener("DOMContentLoaded",colorPicker.loadImg)},loadImg:function(){colorPicker.img=document.createElement("img"),colorPicker.img.onload=function(){colorPicker.height=this.height,colorPicker.width=this.width,colorPicker.init()},colorPicker.img.onerror=function(){this.src="/projects/photofilter/image/color.png"},colorPicker.img.src=colorPicker.getImageSrc()},getImageSrc:function(){return"/projects/photofilter/image/color.png"},init:function(){colorPicker.canvas&&colorPicker.canvas.getContext&&(colorPicker.canvas.addEventListener("click",colorPicker.getColor),colorPicker.canvas.height=colorPicker.height,colorPicker.canvas.width=colorPicker.width,colorPicker.ctx=colorPicker.canvas.getContext("2d"),colorPicker.ctx.drawImage(colorPicker.img,0,0))},getColor:function(r){var e=colorPicker.canvas.getBoundingClientRect(),t=r.clientX-e.left,t=colorPicker.ctx.getImageData(t,r.clientY-e.top,1,1).data;colorPicker.colorRgba="rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]/255+")",colorPicker.colorRgbaObj={r:t[0],g:t[1],b:t[2],a:t[3]/255},colorPicker.colorPick()},colorPick:function(){colorPicker.element&&(colorPicker.element.style.backgroundColor=colorPicker.colorRgba)}},bl=(window._c=function(r){},$photo=new function(){var o,O,E,L,a,e,M,N,S=[],Y=0,x=30;function i(){var r;a.files&&a.files[0]&&(r=new FileReader,e=new Image,r.readAsDataURL(a.files[0])),r.onload=function(r){e.src=r.target.result,document.getElementById("img").src=r.target.result,e.onload=function(){o.width=this.width,o.height=this.height,O.width=this.width,O.height=this.height,L.drawImage(e,0,0),n()}}}function n(){M=L.getImageData(0,0,O.width,O.height);for(var r=document.getElementsByName("filter"),e=0,t=r.length;e<t;e++)if(r[e].checked){N=r[e].value;break}var o=M.data,a=M.width,i=[];S=[];for(var n,c=0,g=0;c<o.length;c+=4)n=++g%a,i.push({r:o[c],g:o[c+1],b:o[c+2],a:o[c+3]}),n||(S.push(i),i=[]);if("negatyw"===N)for(var h=0;h<M.height;h++)for(var l=0;l<M.width;l++)S[h][l].g=255-S[h][l].g,S[h][l].r=255-S[h][l].r,S[h][l].b=255-S[h][l].b;else if("szarosc"===N)for(var d=0,h=0;h<M.height;h++)for(l=0;l<M.width;l++)d=255<(d=(S[h][l].r+S[h][l].g+S[h][l].b)/3-Y)?255:d<0?0:d,S[h][l].g=d,S[h][l].r=d,S[h][l].b=d;else if("sepia"===N)for(h=0;h<M.height-1;h++)for(l=0;l<M.width-1;l++)S[h][l].g+=2*x,S[h][l].r+=x;else if("kontur"===N)for(var s=JSON.parse(JSON.stringify(S)),h=0;h<M.height-1;h++)for(l=0;l<M.width-1;l++)S[h][l].r=Math.abs(s[h][l].r-s[h+1][l+1].r)+Math.abs(s[h+1][l].r-s[h][l+1].r),S[h][l].g=Math.abs(s[h][l].g-s[h+1][l+1].g)+Math.abs(s[h+1][l].g-s[h][l+1].g),S[h][l].b=Math.abs(s[h][l].b-s[h+1][l+1].b)+Math.abs(s[h+1][l].b-s[h][l+1].b);else if("kontur-2"===N)for(var f,m,s=JSON.parse(JSON.stringify(S)),h=1;h<M.height-1;h++)for(l=1;l<M.width-1;l++)f=s[h-1][l+1].r+2*s[h][l+1].r+s[h+1][l+1].r-(s[h-1][l-1].r+2*s[h][l-1].r+s[h+1][l-1].r),m=s[h+1][l-1].r+2*s[h+1][l].r+s[h+1][l+1].r-(s[h-1][l-1].r+2*s[h-1][l].r+s[h-1][l+1].r),S[h][l].r=Math.pow(f*f+m*m,.5),f=s[h-1][l+1].g+2*s[h][l+1].g+s[h+1][l+1].g-(s[h-1][l-1].g+2*s[h][l-1].g+s[h+1][l-1].g),m=s[h+1][l-1].g+2*s[h+1][l].g+s[h+1][l+1].g-(s[h-1][l-1].g+2*s[h-1][l].g+s[h-1][l+1].g),S[h][l].g=Math.pow(f*f+m*m,.5),f=s[h-1][l+1].b+2*s[h][l+1].b+s[h+1][l+1].b-(s[h-1][l-1].b+2*s[h][l-1].b+s[h+1][l-1].b),m=s[h+1][l-1].b+2*s[h+1][l].b+s[h+1][l+1].b-(s[h-1][l-1].b+2*s[h-1][l].b+s[h-1][l+1].b),S[h][l].b=Math.pow(f*f+m*m,.5);else if("progowanie"===N){for(var d=0,b=0,P=($=$$("#rangeProg").value,document.getElementsByName("prog")),h=0;h<P.length;h++)!0===P[h].checked&&(b=parseInt(P[h].value));for(h=0;h<M.height;h++)for(l=0;l<M.width;l++)d=(S[h][l].r+S[h][l].g+S[h][l].b)/3,d=$<d?1===b?d:255:-1===b?d:0,S[h][l].g=d,S[h][l].r=d,S[h][l].b=d}else if("randmaska"===N)U(randomMask());else if("wlasna3x3"===N){for(var u=[],h=1;h<=9;h++)k=(k=Number($$("#m"+h).value))||0,u.push(k);U(u)}else if("wlasna5x5"===N){for(var k,u=[],h=1;h<=25;h++)k=(k=Number($$("#n"+h).value))||0,u.push(k);U(u)}else if("akcent"===N){var v=_(colorPicker.colorRgbaObj),$=$$("#rangeAccent").value;!function(r,e){for(var t=(r.h-e/2+360)%360,o=(r.h+e/2+360)%360,a=t<=o,i=0;i<M.height;i++)for(var n=0;n<M.width;n++){var c=_($$.clone(S[i][n]));a&&c.h>t&&c.h<o||!a&&(c.h>t||c.h<o)||(c=(S[i][n].r+S[i][n].g+S[i][n].b)/3,S[i][n].g=c,S[i][n].r=c,S[i][n].b=c)}}(v,$)}else if("bit"===N)for(var p,h=0;h<M.height;h++)for(l=0;l<M.width;l++)p=S[h][l],S[h][l].g=50*Math.round(p.g/50),S[h][l].r=50*Math.round(p.r/50),S[h][l].b=50*Math.round(p.b/50);else if("lab"===N)for(var $=255*Math.random(),A=255*Math.random(),I=255*Math.random(),h=0;h<M.height;h++)for(l=0;l<M.width;l++)S[h][l].g=(S[h][l].g+$)%255,S[h][l].r=(S[h][l].r+A)%255,S[h][l].b=(S[h][l].b+I)%255;for(var g=0,w=0;g<M.height;g++)for(c=0;c<M.width;c++)M.data[w]=S[g][c].r,M.data[w+1]=S[g][c].g,M.data[w+2]=S[g][c].b,M.data[w+3]=S[g][c].a,w+=4;E.putImageData(M,0,0)}function U(r){if(Math.sqrt(r.length)%2){var e,t=Math.sqrt(r.length),o=Math.floor(t/2),a=Math.abs(r.reduce(function(r,e){return r+e},0)),i=JSON.parse(JSON.stringify(S)),a=a||1;for(g in r)r[g]/=a;for(var n=M.height-o,c=M.width-o,g=o;g<n;g++)for(var h=o;h<c;h++)e=function(r,e,t,o,a){for(var i={r:0,g:0,b:0},n=e-a,c=0;n<e+a+1;n++)for(var g=r-a;g<r+a+1;g++)i.r+=t[c]*o[n][g].r,i.g+=t[c]*o[n][g].g,i.b+=t[c]*o[n][g].b,c++;return i}(h,g,r,i,o),S[g][h].r=e.r,S[g][h].g=e.g,S[g][h].b=e.b}}function _(r){r.r/=255,r.g/=255,r.b/=255;var e={h:0,s:0,v:0},t=Math.max(r.r,r.g,r.b),o=t-Math.min(r.r,r.g,r.b);for(0==o?e.h=0:r.r>Math.max(r.g,r.b)?e.h=(r.g-r.b)/o%6*60:r.g>Math.max(r.r,r.b)?e.h=60*((r.b-r.r)/o+2):e.h=60*((r.r-r.g)/o+4);e.h<0;)e.h+=360;return e.s=t?o/t:0,e.v=t,e}this.init=function(){if(o=document.getElementById("photoCanvas"),O=document.getElementById("photoHide"),a=document.getElementById("photo"),o&&o.getContext){E=o.getContext("2d"),L=O.getContext("2d"),a.addEventListener("change",i);for(var r=document.getElementsByTagName("input"),e=0;e<r.length;e++){var t=r[e];"object"==typeof t&&"radio"===t.type&&"filter"===t.name&&$$.addEvent(t,"click",n)}}}},{showMatrix3:"mask3x3",showMatrix5:"mask5x5",accent:"pickColor",progButton:"prog"});function randomMask(){var r=Object.keys($mask);return $mask[r[r.length*Math.random()<<0]]}$$("html").addEventListener("click",function(){var r=$$("#mask3x3"),e=$$("#mask5x5"),t=$$("#prog"),o=$$("#pickColor");r.isHidden()||r.fadeOut(200),e.isHidden()||e.fadeOut(200),o.isHidden()||o.fadeOut(200),t.isHidden()||t.fadeOut(200)}),$$("#showMatrix3").addEventListener("click",function(r){r.stopPropagation(),$$("#mask3x3").isHidden()&&$$("#mask3x3").fadeIn(200)}),$$("#showMatrix5").addEventListener("click",function(r){r.stopPropagation(),$$("#mask5x5").isHidden()&&$$("#mask5x5").fadeIn(200)}),$$("#accent").addEventListener("click",function(r){r.stopPropagation(),$$("#pickColor").isHidden()&&$$("#pickColor").fadeIn(200)}),$$("#progButton").addEventListener("click",function(r){r.stopPropagation(),$$("#prog").isHidden()&&$$("#prog").fadeIn(200)}),$photo.init(),colorPicker.install({element:"accent"}),$mask={USREDNIAJACY:[1,1,1,1,1,1,1,1,1],KWADRATOWY:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],KOLOWY:[0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0],LP1:[1,1,1,1,2,1,1,1,1],LP2:[1,1,1,1,4,1,1,1,1],LP3:[1,1,1,1,12,1,1,1,1],PIRAMIDALNY:[1,2,3,2,1,2,4,6,4,2,3,6,9,6,3,2,4,6,4,2,1,2,3,2,1],STOZKOWY:[0,0,1,0,0,0,2,2,2,0,1,2,5,2,1,0,2,2,2,0,0,0,1,0,0],GAUSS1:[1,2,1,2,4,2,1,2,1],GAUSS2:[1,1,2,1,1,1,2,4,2,1,2,4,8,4,2,1,2,4,2,1,1,1,2,1,1],GAUSS3:[0,1,2,1,0,1,4,8,4,1,2,8,16,8,2,1,4,8,4,1,0,1,2,1,0],GAUSS4:[1,4,7,4,1,4,16,26,16,4,7,26,41,26,7,4,26,16,26,4,1,4,7,4,1],GAUSS5:[1,1,2,2,2,1,1,1,2,2,4,2,2,1,2,2,4,8,4,2,2,2,4,8,16,8,4,2,2,2,4,8,4,2,2,1,2,2,4,2,2,1,1,1,2,2,2,1,1],USUN_SREDNIA:[-1,-1,-1,-1,9,-1,-1,-1,-1],HP1:[0,-1,0,-1,5,-1,0,-1,0],HP2:[1,-2,1,-2,5,-2,1,-2,1],HP3:[0,-1,0,-1,20,-1,0,-1,0],POZIOMY:[0,0,0,-1,1,0,0,0,0],PIONOWY:[0,-1,0,0,1,0,0,0,0],UKOSNY1:[-1,0,0,0,1,0,0,0,0],UKOSNY2:[0,0,-1,0,1,0,0,0,0],GRADIENT_E:[-1,1,1,-1,-2,1,-1,1,1],GRADIENT_SE:[-1,-1,1,-1,-2,1,1,1,1],GRADIENT_S:[-1,-1,-1,1,-2,1,1,1,1],GRADIENT_SW:[1,-1,-1,1,-2,-1,1,1,1],GRADIENT_W:[1,1,-1,1,-2,-1,1,1,-1],GRADIENT_NW:[1,1,1,1,-2,-1,1,-1,-1],GRADIENT_N:[1,1,1,1,-2,1,-1,-1,-1],GRADIENT_NE:[1,1,1,-1,-2,1,-1,-1,1],UWYPUKLAJACY_E:[-1,0,1,-1,1,1,-1,0,1],UWYPUKLAJACY_SE:[-1,-1,0,-1,1,1,0,1,1],UWYPUKLAJACY_S:[-1,-1,-1,0,1,0,1,1,1],UWYPUKLAJACY_SW:[0,-1,-1,1,1,-1,1,1,0],UWYPUKLAJACY_W:[1,0,-1,1,1,-1,1,0,-1],UWYPUKLAJACY_NW:[1,1,0,1,1,-1,0,-1,-1],UWYPUKLAJACY_N:[1,1,1,0,1,0,-1,-1,-1],UWYPUKLAJACY_NE:[0,1,1,-1,1,1,-1,-1,0],LAPL1:[0,-1,0,-1,4,-1,0,-1,0],LAPL2:[-1,-1,-1,-1,8,-1,-1,-1,-1],LAPL3:[1,-2,1,-2,4,-2,1,-2,1],LAPL_SKOSNY:[-1,0,-1,0,4,0,-1,0,-1],LAPL_PIONOWY:[0,-1,0,0,2,0,0,-1,0],LAPL_POZIOMY:[0,0,0,-1,2,-1,0,0,0],SOBEL_POZIOMY:[1,2,1,0,0,0,-1,-2,-1],SOBEL_PIONOWY:[1,0,-1,2,0,-2,1,0,-1],PREWITT_POZIOMY:[-1,-1,-1,0,0,0,1,1,1],PREWITT_PIONOWY:[1,0,-1,1,0,-1,1,0,-1]};