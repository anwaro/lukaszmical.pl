var x={canvas:"",ctx:"",height:"",width:"",img:"",colorRgba:"rgba(255,0,0,0)",colorRgbaObj:{r:255,g:0,b:0,a:1},colorHsv:"",colorHex:"",element:"",install:function(t){x.canvas=document.getElementById("colorPicker"),x.element=!!t.element&&document.getElementById(t.element),window.addEventListener("DOMContentLoaded",x.loadImg)},loadImg:function(){x.img=document.createElement("img"),x.img.onload=function(){x.height=this.height,x.width=this.width,x.init()},x.img.onerror=function(){this.src="/projects/photofilter/image/color.png"},x.img.src=x.getImageSrc()},getImageSrc:function(){return"/projects/photofilter/image/color.png"},init:function(){x.canvas&&x.canvas.getContext&&(x.canvas.addEventListener("click",x.getColor),x.canvas.height=x.height,x.canvas.width=x.width,x.ctx=x.canvas.getContext("2d"),x.ctx.drawImage(x.img,0,0))},getColor:function(t){var e=x.canvas.getBoundingClientRect(),a=t.clientX-e.left,a=x.ctx.getImageData(a,t.clientY-e.top,1,1).data;x.colorRgba="rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]/255+")",x.colorRgbaObj={r:a[0],g:a[1],b:a[2],a:a[3]/255},x.colorPick()},colorPick:function(){x.element&&(x.element.style.backgroundColor=x.colorRgba)}};window._c=function(t){},$photo=new function(){var r,P,L,N,n,e,S,Y,M=[],k=0,U=30;function o(){var t;n.files&&n.files[0]&&(t=new FileReader,e=new Image,t.readAsDataURL(n.files[0])),t.onload=function(t){e.src=t.target.result,document.getElementById("img").src=t.target.result,e.onload=function(){r.width=this.width,r.height=this.height,P.width=this.width,P.height=this.height,N.drawImage(e,0,0),i()}}}function i(){S=N.getImageData(0,0,P.width,P.height);for(var t=document.getElementsByName("filter"),e=0,a=t.length;e<a;e++)if(t[e].checked){Y=t[e].value;break}var r=S.data,n=S.width,o=[];M=[];for(var i,g=0,h=0;g<r.length;g+=4)i=++h%n,o.push({r:r[g],g:r[g+1],b:r[g+2],a:r[g+3]}),i||(M.push(o),o=[]);if("negatyw"===Y)for(var d=0;d<S.height;d++)for(var c=0;c<S.width;c++)M[d][c].g=255-M[d][c].g,M[d][c].r=255-M[d][c].r,M[d][c].b=255-M[d][c].b;else if("szarosc"===Y)for(var s=0,d=0;d<S.height;d++)for(c=0;c<S.width;c++)s=255<(s=(M[d][c].r+M[d][c].g+M[d][c].b)/3-k)?255:s<0?0:s,M[d][c].g=s,M[d][c].r=s,M[d][c].b=s;else if("sepia"===Y)for(d=0;d<S.height-1;d++)for(c=0;c<S.width-1;c++)M[d][c].g+=2*U,M[d][c].r+=U;else if("kontur"===Y)for(var l=JSON.parse(JSON.stringify(M)),d=0;d<S.height-1;d++)for(c=0;c<S.width-1;c++)M[d][c].r=Math.abs(l[d][c].r-l[d+1][c+1].r)+Math.abs(l[d+1][c].r-l[d][c+1].r),M[d][c].g=Math.abs(l[d][c].g-l[d+1][c+1].g)+Math.abs(l[d+1][c].g-l[d][c+1].g),M[d][c].b=Math.abs(l[d][c].b-l[d+1][c+1].b)+Math.abs(l[d+1][c].b-l[d][c+1].b);else if("kontur-2"===Y)for(var f,m,l=JSON.parse(JSON.stringify(M)),d=1;d<S.height-1;d++)for(c=1;c<S.width-1;c++)f=l[d-1][c+1].r+2*l[d][c+1].r+l[d+1][c+1].r-(l[d-1][c-1].r+2*l[d][c-1].r+l[d+1][c-1].r),m=l[d+1][c-1].r+2*l[d+1][c].r+l[d+1][c+1].r-(l[d-1][c-1].r+2*l[d-1][c].r+l[d-1][c+1].r),M[d][c].r=Math.pow(f*f+m*m,.5),f=l[d-1][c+1].g+2*l[d][c+1].g+l[d+1][c+1].g-(l[d-1][c-1].g+2*l[d][c-1].g+l[d+1][c-1].g),m=l[d+1][c-1].g+2*l[d+1][c].g+l[d+1][c+1].g-(l[d-1][c-1].g+2*l[d-1][c].g+l[d-1][c+1].g),M[d][c].g=Math.pow(f*f+m*m,.5),f=l[d-1][c+1].b+2*l[d][c+1].b+l[d+1][c+1].b-(l[d-1][c-1].b+2*l[d][c-1].b+l[d+1][c-1].b),m=l[d+1][c-1].b+2*l[d+1][c].b+l[d+1][c+1].b-(l[d-1][c-1].b+2*l[d-1][c].b+l[d-1][c+1].b),M[d][c].b=Math.pow(f*f+m*m,.5);else if("progowanie"===Y){for(var s=0,b=0,u=(A=$$("#rangeProg").value,document.getElementsByName("prog")),d=0;d<u.length;d++)!0===u[d].checked&&(b=parseInt(u[d].value));for(d=0;d<S.height;d++)for(c=0;c<S.width;c++)s=(M[d][c].r+M[d][c].g+M[d][c].b)/3,s=A<s?1===b?s:255:-1===b?s:0,M[d][c].g=s,M[d][c].r=s,M[d][c].b=s}else if("randmaska"===Y)_(function(){var t=Object.keys($mask);return $mask[t[t.length*Math.random()<<0]]}());else if("wlasna3x3"===Y){for(var v=[],d=1;d<=9;d++)$=($=Number($$("#m"+d).value))||0,v.push($);_(v)}else if("wlasna5x5"===Y){for(var $,v=[],d=1;d<=25;d++)$=($=Number($$("#n"+d).value))||0,v.push($);_(v)}else if("akcent"===Y){var p=W(x.colorRgbaObj),A=$$("#rangeAccent").value;!function(t,e){for(var a=(t.h-e/2+360)%360,r=(t.h+e/2+360)%360,n=a<=r,o=0;o<S.height;o++)for(var i=0;i<S.width;i++){var g=W($$.clone(M[o][i]));n&&g.h>a&&g.h<r||!n&&(g.h>a||g.h<r)||(g=(M[o][i].r+M[o][i].g+M[o][i].b)/3,M[o][i].g=g,M[o][i].r=g,M[o][i].b=g)}}(p,A)}else if("bit"===Y)for(var I,d=0;d<S.height;d++)for(c=0;c<S.width;c++)I=M[d][c],M[d][c].g=50*Math.round(I.g/50),M[d][c].r=50*Math.round(I.r/50),M[d][c].b=50*Math.round(I.b/50);else if("lab"===Y)for(var A=255*Math.random(),O=255*Math.random(),w=255*Math.random(),d=0;d<S.height;d++)for(c=0;c<S.width;c++)M[d][c].g=(M[d][c].g+A)%255,M[d][c].r=(M[d][c].r+O)%255,M[d][c].b=(M[d][c].b+w)%255;for(var h=0,E=0;h<S.height;h++)for(g=0;g<S.width;g++)S.data[E]=M[h][g].r,S.data[E+1]=M[h][g].g,S.data[E+2]=M[h][g].b,S.data[E+3]=M[h][g].a,E+=4;L.putImageData(S,0,0)}function _(t){if(Math.sqrt(t.length)%2){var e,a=Math.sqrt(t.length),r=Math.floor(a/2),n=Math.abs(t.reduce(function(t,e){return t+e},0)),o=JSON.parse(JSON.stringify(M)),n=n||1;for(h in t)t[h]/=n;for(var i=S.height-r,g=S.width-r,h=r;h<i;h++)for(var d=r;d<g;d++)e=function(t,e,a,r,n){for(var o={r:0,g:0,b:0},i=e-n,g=0;i<e+n+1;i++)for(var h=t-n;h<t+n+1;h++)o.r+=a[g]*r[i][h].r,o.g+=a[g]*r[i][h].g,o.b+=a[g]*r[i][h].b,g++;return o}(d,h,t,o,r),M[h][d].r=e.r,M[h][d].g=e.g,M[h][d].b=e.b}}function W(t){t.r/=255,t.g/=255,t.b/=255;var e={h:0,s:0,v:0},a=Math.max(t.r,t.g,t.b),r=a-Math.min(t.r,t.g,t.b);for(0==r?e.h=0:t.r>Math.max(t.g,t.b)?e.h=(t.g-t.b)/r%6*60:t.g>Math.max(t.r,t.b)?e.h=60*((t.b-t.r)/r+2):e.h=60*((t.r-t.g)/r+4);e.h<0;)e.h+=360;return e.s=a?r/a:0,e.v=a,e}this.init=function(){if(r=document.getElementById("photoCanvas"),P=document.getElementById("photoHide"),n=document.getElementById("photo"),r&&r.getContext){L=r.getContext("2d"),N=P.getContext("2d"),n.addEventListener("change",o);for(var t=document.getElementsByTagName("input"),e=0;e<t.length;e++){var a=t[e];"object"==typeof a&&"radio"===a.type&&"filter"===a.name&&$$.addEvent(a,"click",i)}}}};$$("html").addEventListener("click",function(){var t=$$("#mask3x3"),e=$$("#mask5x5"),a=$$("#prog"),r=$$("#pickColor");t.isHidden()||t.fadeOut(200),e.isHidden()||e.fadeOut(200),r.isHidden()||r.fadeOut(200),a.isHidden()||a.fadeOut(200)}),$$("#showMatrix3").addEventListener("click",function(t){t.stopPropagation(),$$("#mask3x3").isHidden()&&$$("#mask3x3").fadeIn(200)}),$$("#showMatrix5").addEventListener("click",function(t){t.stopPropagation(),$$("#mask5x5").isHidden()&&$$("#mask5x5").fadeIn(200)}),$$("#accent").addEventListener("click",function(t){t.stopPropagation(),$$("#pickColor").isHidden()&&$$("#pickColor").fadeIn(200)}),$$("#progButton").addEventListener("click",function(t){t.stopPropagation(),$$("#prog").isHidden()&&$$("#prog").fadeIn(200)}),$photo.init(),x.install({element:"accent"}),$mask={USREDNIAJACY:[1,1,1,1,1,1,1,1,1],KWADRATOWY:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],KOLOWY:[0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0],LP1:[1,1,1,1,2,1,1,1,1],LP2:[1,1,1,1,4,1,1,1,1],LP3:[1,1,1,1,12,1,1,1,1],PIRAMIDALNY:[1,2,3,2,1,2,4,6,4,2,3,6,9,6,3,2,4,6,4,2,1,2,3,2,1],STOZKOWY:[0,0,1,0,0,0,2,2,2,0,1,2,5,2,1,0,2,2,2,0,0,0,1,0,0],GAUSS1:[1,2,1,2,4,2,1,2,1],GAUSS2:[1,1,2,1,1,1,2,4,2,1,2,4,8,4,2,1,2,4,2,1,1,1,2,1,1],GAUSS3:[0,1,2,1,0,1,4,8,4,1,2,8,16,8,2,1,4,8,4,1,0,1,2,1,0],GAUSS4:[1,4,7,4,1,4,16,26,16,4,7,26,41,26,7,4,26,16,26,4,1,4,7,4,1],GAUSS5:[1,1,2,2,2,1,1,1,2,2,4,2,2,1,2,2,4,8,4,2,2,2,4,8,16,8,4,2,2,2,4,8,4,2,2,1,2,2,4,2,2,1,1,1,2,2,2,1,1],USUN_SREDNIA:[-1,-1,-1,-1,9,-1,-1,-1,-1],HP1:[0,-1,0,-1,5,-1,0,-1,0],HP2:[1,-2,1,-2,5,-2,1,-2,1],HP3:[0,-1,0,-1,20,-1,0,-1,0],POZIOMY:[0,0,0,-1,1,0,0,0,0],PIONOWY:[0,-1,0,0,1,0,0,0,0],UKOSNY1:[-1,0,0,0,1,0,0,0,0],UKOSNY2:[0,0,-1,0,1,0,0,0,0],GRADIENT_E:[-1,1,1,-1,-2,1,-1,1,1],GRADIENT_SE:[-1,-1,1,-1,-2,1,1,1,1],GRADIENT_S:[-1,-1,-1,1,-2,1,1,1,1],GRADIENT_SW:[1,-1,-1,1,-2,-1,1,1,1],GRADIENT_W:[1,1,-1,1,-2,-1,1,1,-1],GRADIENT_NW:[1,1,1,1,-2,-1,1,-1,-1],GRADIENT_N:[1,1,1,1,-2,1,-1,-1,-1],GRADIENT_NE:[1,1,1,-1,-2,1,-1,-1,1],UWYPUKLAJACY_E:[-1,0,1,-1,1,1,-1,0,1],UWYPUKLAJACY_SE:[-1,-1,0,-1,1,1,0,1,1],UWYPUKLAJACY_S:[-1,-1,-1,0,1,0,1,1,1],UWYPUKLAJACY_SW:[0,-1,-1,1,1,-1,1,1,0],UWYPUKLAJACY_W:[1,0,-1,1,1,-1,1,0,-1],UWYPUKLAJACY_NW:[1,1,0,1,1,-1,0,-1,-1],UWYPUKLAJACY_N:[1,1,1,0,1,0,-1,-1,-1],UWYPUKLAJACY_NE:[0,1,1,-1,1,1,-1,-1,0],LAPL1:[0,-1,0,-1,4,-1,0,-1,0],LAPL2:[-1,-1,-1,-1,8,-1,-1,-1,-1],LAPL3:[1,-2,1,-2,4,-2,1,-2,1],LAPL_SKOSNY:[-1,0,-1,0,4,0,-1,0,-1],LAPL_PIONOWY:[0,-1,0,0,2,0,0,-1,0],LAPL_POZIOMY:[0,0,0,-1,2,-1,0,0,0],SOBEL_POZIOMY:[1,2,1,0,0,0,-1,-2,-1],SOBEL_PIONOWY:[1,0,-1,2,0,-2,1,0,-1],PREWITT_POZIOMY:[-1,-1,-1,0,0,0,1,1,1],PREWITT_PIONOWY:[1,0,-1,1,0,-1,1,0,-1]};