CanvasRenderingContext2D.prototype.loadConfig=function(e){for(var t in e)e.hasOwnProperty(t)&&t in this&&(this[t]=e[t])},CanvasRenderingContext2D.prototype.strokeLine=function(t,e,n){this.beginPath(),this.loadConfig(e||{}),this.moveTo(t[0][0],t[0][1]);for(let e=0;e<t.length;e++)this.lineTo(t[e][0],t[e][1]);n&&this.lineTo(t[0][0],t[0][1]),this.stroke()},CanvasRenderingContext2D.prototype.fillArea=function(t,e){this.beginPath(),this.loadConfig(e||{}),this.moveTo(t[0][0],t[0][1]);for(let e=0;e<t.length;e++)this.lineTo(t[e][0],t[e][1]);this.lineTo(t[0][0],t[0][1]),this.fill()},(mp3player=new function(){let t,r,o=169,l=262,u,a={topBg:"#32312F",main:"#191919",progressArea:"rgba(48, 48, 41, 0.8)",progressBg:"#FFFFF",progress:"#1665BE",buffer:"#C3C3C3",font:"#FFFFFF",top:"#FFFFFF",spin:"#FFFFFF",menu:"rgba(3, 3, 3, 0.8)",select:"#1665BE",vis:{grad:null,c1:"rgba(0, 0, 0, 0.7)",c2:"rgba(255, 0, 0, 0.7)",c3:"rgba(0, 128, 0, 0.7)",c4:"rgba(0, 0, 255, 0.7)"}},s={data:[],buffer:!1,play:!1,type:".mp3",audio:{prev:new e,current:new e,next:new e},url:{info:"/api/v1/projects/songs",audio:"/projects/mp3player/sound/",cover:"/projects/mp3player/covers/"},vis:{support:!1,source:null,analyser:null}},n={down:!1,downTime:null},d={menu:{el:null,open:!1,maxH:198,height:0,list:null,select:0},next:null,prev:null,play:null,vol:{up:null,down:null}};function i(e){0<s.audio.current.elem.volume+e&&s.audio.current.elem.volume+e<1&&(s.audio.current.elem.volume+=e)}function c(){d.menu.open&&!d.menu.close?(s.play=!1,s.audio.current.elem.pause(),s.audio.current.id=d.menu.select,T(s.audio.current,0),T(s.audio.prev,-1),T(s.audio.next,1),d.menu.close=!0,c()):s.play?(s.play=!1,s.audio.current.elem.pause()):"function"==typeof s.audio.current.elem.play?(s.play=!0,s.audio.current.elem.play()):setTimeout(c,100)}function m(){s.play=!1,s.audio.current.elem.pause()}function p(){d.menu.open?d.menu.close=!0:(d.menu.select=s.audio.current.id,f(),d.menu.open=!0)}function f(){d.menu.list=[];for(let e=d.menu.select-5;e<d.menu.select+5;e++)d.menu.list.push(function(e){e<0&&(e+=s.data.length);e>=s.data.length&&(e-=s.data.length);return[e,s.data[e]]}(e));d.menu.list.reverse()}function g(){r.beginPath(),r.fillStyle=a.main,r.clearRect(0,14,o,l);{let t=!1;if(s.audio.current.image.complete&&s.audio.current.image.src){var e=(s.audio.current.image.width-o)/2;try{r.drawImage(s.audio.current.image,e,0,o,l,0,14,o,l-14)}catch(e){t=!0}}else t=!0;s.buffer&&!t||(e=(new Date).getTime()/250%(2*Math.PI),r.save(),r.beginPath(),r.lineWidth=2,r.translate(o/2,l/2),r.strokeStyle=a.spin,r.arc(0,0,40,e,e+.7*Math.PI),r.stroke(),r.restore())}r.beginPath(),r.fillStyle=a.topBg,r.fillRect(0,0,o,14),u=new Date,r.loadConfig({font:"bold 10px Arial",textAlign:"center",textBaseline:"top",fillStyle:a.font}),r.fillText(function(e){let t=e.getHours(),n=e.getMinutes(),i=12<=t?"PM":"AM";return t=(t%=12)||12,n=n<10?"0"+n:n,t+":"+n+" "+i}(u),o/2,2),r.strokeLine([[o-22,7],[o-5,7]],{strokeStyle:a.top,lineWidth:8}),r.strokeLine([[o-6,7],[o-3,7]],{strokeStyle:a.top,lineWidth:4}),s.play?r.fillArea([[o-35,3],[o-35,11],[o-27,7]],{lineWidth:4}):(r.strokeLine([[o-35,3],[o-35,11]],{lineWidth:2}),r.strokeLine([[o-30,3],[o-30,11]],{lineWidth:2})),r.fillArea([[4,6],[4,8],[7,10],[7,4]],{});var t=30/180*Math.PI;for(let e=0;e<4;e++)r.beginPath(),r.lineWidth=1,r.arc(2+e,7,6+e,-t,t),r.stroke();r.font="9px Arial",r.textAlign="left",r.fillText(100*s.audio.current.elem.volume.toFixed(2)+" %",17,2);{r.beginPath(),r.fillStyle=a.progressArea,r.fillRect(0,l-50,o,50),r.loadConfig({font:"bold 10px Arial",textAlign:"center",textBaseline:"top",fillStyle:a.font}),r.fillText(s.audio.current.artist,o/2,l-44),r.font="9px Arial",r.fillText(s.audio.current.title,o/2,l-32);let e=s.audio.current.elem.currentTime,t=s.audio.current.elem.duration,n=(r.textAlign="left",r.fillText(w(e),5,l-18),r.textAlign="right",r.fillText("-"+w(t-e),o-5,l-18),e/t*(o-60)),i=1+n;try{i=s.audio.current.elem.buffered.end(0)/t*(o-60)}catch(e){}r.strokeLine([[30,l-12],[o-30,l-12]],{strokeStyle:a.progressBg,lineWidth:8}),r.strokeLine([[30,l-12],[30+i,l-12]],{strokeStyle:a.buffer}),r.strokeLine([[30,l-12],[30+n,l-12]],{strokeStyle:a.progress})}if(d.menu.open)!function(){!d.menu.close&&d.menu.height<d.menu.maxH&&(d.menu.height+=10);if(d.menu.close&&(d.menu.height-=10,d.menu.height<0))return d.menu.height=0,d.menu.close=!1,d.menu.open=!1;let e=14+d.menu.height,t=0;r.fillArea([[0,14],[o,14],[o,e],[0,e]],{fillStyle:a.menu});for(;34<=e;)h(t)===d.menu.select&&r.fillArea([[0,e],[o,e],[o,e-20],[0,e-20]],{fillStyle:a.select}),r.loadConfig({font:"bold 9px Arial",textAlign:"left",textBaseline:"middle",fillStyle:a.font}),r.fillStyle=a.font,r.fillText(function(e){var t=d.menu.list[e][1];return h(e)+". "+t.artist+" - "+t.title}(t),5,e-10),e-=20,t++}();else if(s.vis.support){var i=new Uint8Array(s.vis.analyser.frequencyBinCount);s.vis.analyser.getByteFrequencyData(i),r.fillStyle=a.vis.grad;for(let n=0;n<.6*i.length;n+=16){let t=0;for(let e=0;e<16;e++)t+=i[n+e];t/=16,r.fillRect(n/16*(o-2)/38,l-50,(o-6)/38,.2*-t)}}var n=s.audio.current.elem.duration;Math.abs(n-s.audio.current.elem.currentTime)<.1&&x(1),s.buffer=!(0<n&&s.audio.current.elem.paused&&s.play)}function h(e){return d.menu.list[e][0]}function v(t){if(d.menu.open&&!d.menu.close){let e=d.menu.select+t;e<0&&(e+=s.data.length),e>=s.data.length&&(e-=s.data.length),d.menu.select=e,f()}else n.down=!0,n.downTime=(new Date).getTime(),setTimeout(function(){!function e(t){n.down&&1e3<(new Date).getTime()-n.downTime?(0<t?s.audio.current.elem.currentTime+1<s.audio.current.elem.duration?s.audio.current.elem.currentTime+=1:x(1):0<s.audio.current.elem.currentTime-1?--s.audio.current.elem.currentTime:x(-1),setTimeout(function(){e(t)},100)):!n.down&&(new Date).getTime()-n.downTime<1e3?x(t):n.down&&setTimeout(function(){e(t)},100)}(t)},100)}function y(){n.down=!1}function x(e){1===e?(m(),s.audio.prev.copy(s.audio.current),s.audio.current.copy(s.audio.next),s.audio.next.clear(),c(),T(s.audio.next,1)):-1===e&&(30<s.audio.current.elem.currentTime?(m(),s.audio.current.elem.currentTime=0,c()):(m(),s.audio.next.copy(s.audio.current),s.audio.current.copy(s.audio.prev),s.audio.prev.clear(),c(),T(s.audio.prev,-1)))}function w(e){return isNaN(e)?"0:00":Math.floor(e/60)+":"+(e=(e=Math.floor(e%60))<10?"0"+e:e)}function T(e,t){let n=s.audio.current.id+t;(n=n<0?s.data.length:n)>=s.data.length&&(n=0);t=s.data[n];e.id=n,e.elem.src=s.url.audio+t.src+s.type,e.artist=t.artist,e.title=t.title,e.image.src=s.url.cover+t.cover}function e(){this.id=0,this.title="",this.artist="",this.elem=null,this.image=new Image,this.copy=function(e){this.id=e.id,this.title=e.title,this.artist=e.artist,this.elem.src=e.elem.src,this.image.src=e.image.src},this.clear=function(){this.id=0,this.src="",this.title="",this.artist="",this.image=new Image}}this.init=function(){if((t=document.getElementById("mp3screen")).height=l,t.width=o,t&&t.getContext){r=t.getContext("2d"),setInterval(g,1e3/60),d.next=document.getElementById("next"),d.prev=document.getElementById("prev"),d.menu.el=document.getElementById("menu"),d.play=document.getElementById("play"),d.vol.up=document.getElementById("vol-up"),d.vol.down=document.getElementById("vol-down"),d.next.addEventListener("mousedown",function(){v(1)}),d.next.addEventListener("mouseup",y),d.next.addEventListener("touchend",y),d.prev.addEventListener("mousedown",function(){v(-1)}),d.prev.addEventListener("mouseup",y),d.prev.addEventListener("touchend",y),d.play.addEventListener("click",c),d.menu.el.addEventListener("click",p),d.vol.up.addEventListener("click",function(){i(.1)}),d.vol.down.addEventListener("click",function(){i(-.1)}),s.audio.current.elem=document.getElementById("current-song"),s.audio.current.elem.volume=.5,s.audio.next.elem=document.getElementById("next-song"),s.audio.prev.elem=document.getElementById("prev-song");{let t=new XMLHttpRequest;t.onreadystatechange=function(){var e;4===t.readyState&&200===t.status&&(e=t.responseText,s.data=JSON.parse(e),s.audio.current.id=Math.floor(Math.random()*s.data.length),T(s.audio.current,0),T(s.audio.prev,-1),T(s.audio.next,1))},t.open("GET",s.url.info),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send()}a.vis.grad=r.createLinearGradient(0,l-100,0,l-50),a.vis.grad.addColorStop(0,a.vis.c1),a.vis.grad.addColorStop(.3,a.vis.c2),a.vis.grad.addColorStop(.6,a.vis.c3),a.vis.grad.addColorStop(1,a.vis.c4),s.vis.support=!0;try{var e=new AudioContext;s.vis.source=e.createMediaElementSource(s.audio.current.elem),s.vis.analyser=e.createAnalyser(),s.vis.source.connect(s.vis.analyser),s.vis.analyser.connect(e.destination),console.log("Your browser support audioContext object")}catch(e){s.vis.support=!1,console.log("Your browser doesn't support audioContext object, equalizer will not render",e)}}}}).init();