CanvasRenderingContext2D.prototype.loadConfig=function(e){for(var t in e)e.hasOwnProperty(t)&&t in this&&(this[t]=e[t])},CanvasRenderingContext2D.prototype.strokeLine=function(t,e,n){this.beginPath(),this.loadConfig(e||{}),this.moveTo(t[0][0],t[0][1]);for(let e=0;e<t.length;e++)this.lineTo(t[e][0],t[e][1]);n&&this.lineTo(t[0][0],t[0][1]),this.stroke()},CanvasRenderingContext2D.prototype.fillArea=function(t,e){this.beginPath(),this.loadConfig(e||{}),this.moveTo(t[0][0],t[0][1]);for(let e=0;e<t.length;e++)this.lineTo(t[e][0],t[e][1]);this.lineTo(t[0][0],t[0][1]),this.fill()},(new function(){let e,o,r=169,l=262,u,a={topBg:"#32312F",main:"#191919",progressArea:"rgba(48, 48, 41, 0.8)",progressBg:"#FFFFF",progress:"#1665BE",buffer:"#C3C3C3",font:"#FFFFFF",top:"#FFFFFF",spin:"#FFFFFF",menu:"rgba(3, 3, 3, 0.8)",select:"#1665BE",vis:{grad:null,c1:"rgba(0, 0, 0, 0.7)",c2:"rgba(255, 0, 0, 0.7)",c3:"rgba(0, 128, 0, 0.7)",c4:"rgba(0, 0, 255, 0.7)"}},s={data:[],buffer:!1,play:!1,type:".mp3",audio:{prev:new T,current:new T,next:new T},url:{info:"/api/projects/songs",audio:"/projects/mp3player/sound/"},vis:{support:!1,context:null,source:null,analyser:null}},n={down:!1,downTime:null},d={menu:{el:null,open:!1,maxH:198,height:0,list:null,select:0},next:null,prev:null,play:null,vol:{up:null,down:null}};function t(e){0<s.audio.current.elem.volume+e&&s.audio.current.elem.volume+e<1&&(s.audio.current.elem.volume+=e)}function i(){d.menu.open&&!d.menu.close?(s.play=!1,s.audio.current.elem.pause(),s.audio.current.id=d.menu.select,w(s.audio.current,0),w(s.audio.prev,-1),w(s.audio.next,1),d.menu.close=!0,i()):s.play?(s.play=!1,s.audio.current.elem.pause()):"function"==typeof s.audio.current.elem.play?(s.vis.context.resume(),s.play=!0,s.audio.current.elem.play()):setTimeout(i,100)}function c(){s.play=!1,s.audio.current.elem.pause()}function m(){d.menu.open?d.menu.close=!0:(d.menu.select=s.audio.current.id,f(),d.menu.open=!0)}function f(){d.menu.list=[];for(let e=d.menu.select-5;e<d.menu.select+5;e++)d.menu.list.push(function(e){e<0&&(e+=s.data.length);e>=s.data.length&&(e-=s.data.length);return[e,s.data[e]]}(e));d.menu.list.reverse()}function p(){o.beginPath(),o.fillStyle=a.main,o.clearRect(0,14,r,l);{let t=!1;if(s.audio.current.image.complete&&s.audio.current.image.src){var e=(s.audio.current.image.width-r)/2;try{o.drawImage(s.audio.current.image,e,0,r,l,0,14,r,l-14)}catch(e){t=!0}}else t=!0;s.buffer&&!t||(e=(new Date).getTime()/250%(2*Math.PI),o.save(),o.beginPath(),o.lineWidth=2,o.translate(r/2,l/2),o.strokeStyle=a.spin,o.arc(0,0,40,e,e+.7*Math.PI),o.stroke(),o.restore())}o.beginPath(),o.fillStyle=a.topBg,o.fillRect(0,0,r,14),u=new Date,o.loadConfig({font:"bold 10px Arial",textAlign:"center",textBaseline:"top",fillStyle:a.font}),o.fillText(function(e){let t=e.getHours(),n=e.getMinutes(),i=12<=t?"PM":"AM";return t=(t%=12)||12,n=n<10?"0"+n:n,t+":"+n+" "+i}(u),r/2,2),o.strokeLine([[r-22,7],[r-5,7]],{strokeStyle:a.top,lineWidth:8}),o.strokeLine([[r-6,7],[r-3,7]],{strokeStyle:a.top,lineWidth:4}),s.play?o.fillArea([[r-35,3],[r-35,11],[r-27,7]],{lineWidth:4}):(o.strokeLine([[r-35,3],[r-35,11]],{lineWidth:2}),o.strokeLine([[r-30,3],[r-30,11]],{lineWidth:2})),o.fillArea([[4,6],[4,8],[7,10],[7,4]],{});var t=30/180*Math.PI;for(let e=0;e<4;e++)o.beginPath(),o.lineWidth=1,o.arc(2+e,7,6+e,-t,t),o.stroke();o.font="9px Arial",o.textAlign="left",o.fillText(100*s.audio.current.elem.volume.toFixed(2)+" %",17,2);{o.beginPath(),o.fillStyle=a.progressArea,o.fillRect(0,l-50,r,50),o.loadConfig({font:"bold 10px Arial",textAlign:"center",textBaseline:"top",fillStyle:a.font}),o.fillText(s.audio.current.artist,r/2,l-44),o.font="9px Arial",o.fillText(s.audio.current.title,r/2,l-32);let e=s.audio.current.elem.currentTime,t=s.audio.current.elem.duration,n=(o.textAlign="left",o.fillText(x(e),5,l-18),o.textAlign="right",o.fillText("-"+x(t-e),r-5,l-18),e/t*(r-60)),i=1+n;try{i=s.audio.current.elem.buffered.end(0)/t*(r-60)}catch(e){}o.strokeLine([[30,l-12],[r-30,l-12]],{strokeStyle:a.progressBg,lineWidth:8}),o.strokeLine([[30,l-12],[30+i,l-12]],{strokeStyle:a.buffer}),o.strokeLine([[30,l-12],[30+n,l-12]],{strokeStyle:a.progress})}if(d.menu.open)!function(){!d.menu.close&&d.menu.height<d.menu.maxH&&(d.menu.height+=10);if(d.menu.close&&(d.menu.height-=10,d.menu.height<0))return d.menu.height=0,d.menu.close=!1,d.menu.open=!1;let e=14+d.menu.height,t=0;o.fillArea([[0,14],[r,14],[r,e],[0,e]],{fillStyle:a.menu});for(;34<=e;)g(t)===d.menu.select&&o.fillArea([[0,e],[r,e],[r,e-20],[0,e-20]],{fillStyle:a.select}),o.loadConfig({font:"bold 9px Arial",textAlign:"left",textBaseline:"middle",fillStyle:a.font}),o.fillStyle=a.font,o.fillText(function(e){var t=d.menu.list[e][1];return g(e)+". "+t.artist+" - "+t.title}(t),5,e-10),e-=20,t++}();else if(s.vis.support){var i=new Uint8Array(s.vis.analyser.frequencyBinCount);s.vis.analyser.getByteFrequencyData(i),o.fillStyle=a.vis.grad;for(let n=0;n<.6*i.length;n+=16){let t=0;for(let e=0;e<16;e++)t+=i[n+e];t/=16,o.fillRect(n/16*(r-2)/38,l-50,(r-6)/38,.5*-t)}}var n=s.audio.current.elem.duration;Math.abs(n-s.audio.current.elem.currentTime)<.1&&y(1),s.buffer=!(0<n&&s.audio.current.elem.paused&&s.play)}function g(e){return d.menu.list[e][0]}function h(t){if(d.menu.open&&!d.menu.close){let e=d.menu.select+t;e<0&&(e+=s.data.length),e>=s.data.length&&(e-=s.data.length),d.menu.select=e,f()}else n.down=!0,n.downTime=(new Date).getTime(),setTimeout(function(){!function e(t){n.down&&1e3<(new Date).getTime()-n.downTime?(0<t?s.audio.current.elem.currentTime+1<s.audio.current.elem.duration?s.audio.current.elem.currentTime+=1:y(1):0<s.audio.current.elem.currentTime-1?--s.audio.current.elem.currentTime:y(-1),setTimeout(function(){e(t)},100)):!n.down&&(new Date).getTime()-n.downTime<1e3?y(t):n.down&&setTimeout(function(){e(t)},100)}(t)},100)}function v(){n.down=!1}function y(e){1===e?(c(),s.audio.prev.copy(s.audio.current),s.audio.current.copy(s.audio.next),s.audio.next.clear(),i(),w(s.audio.next,1)):-1===e&&(30<s.audio.current.elem.currentTime?(c(),s.audio.current.elem.currentTime=0,i()):(c(),s.audio.next.copy(s.audio.current),s.audio.current.copy(s.audio.prev),s.audio.prev.clear(),i(),w(s.audio.prev,-1)))}function x(e){return isNaN(e)?"0:00":Math.floor(e/60)+":"+(e=(e=Math.floor(e%60))<10?"0"+e:e)}function w(e,t){let n=s.audio.current.id+t;(n=n<0?s.data.length:n)>=s.data.length&&(n=0);t=s.data[n];e.id=n,e.elem.src=t.src,e.artist=t.artist,e.title=t.title,e.image.src=t.cover}function T(){this.id=0,this.title="",this.artist="",this.elem=null,this.image=new Image,this.copy=function(e){this.id=e.id,this.title=e.title,this.artist=e.artist,this.elem.src=e.elem.src,this.image.src=e.image.src},this.clear=function(){this.id=0,this.src="",this.title="",this.artist="",this.image=new Image}}this.init=function(){if((e=document.getElementById("mp3screen")).height=l,e.width=r,e&&e.getContext){o=e.getContext("2d"),setInterval(p,1e3/60),d.next=document.getElementById("next"),d.prev=document.getElementById("prev"),d.menu.el=document.getElementById("menu"),d.play=document.getElementById("play"),d.vol.up=document.getElementById("vol-up"),d.vol.down=document.getElementById("vol-down"),d.next.addEventListener("mousedown",function(){h(1)}),d.next.addEventListener("mouseup",v),d.next.addEventListener("touchend",v),d.prev.addEventListener("mousedown",function(){h(-1)}),d.prev.addEventListener("mouseup",v),d.prev.addEventListener("touchend",v),d.play.addEventListener("click",i),d.menu.el.addEventListener("click",m),d.vol.up.addEventListener("click",function(){t(.1)}),d.vol.down.addEventListener("click",function(){t(-.1)}),s.audio.current.elem=document.getElementById("current-song"),s.audio.current.elem.volume=.5,s.audio.next.elem=document.getElementById("next-song"),s.audio.prev.elem=document.getElementById("prev-song");{let t=new XMLHttpRequest;t.onreadystatechange=function(){var e;4===t.readyState&&200===t.status&&(e=t.responseText,s.data=JSON.parse(e),s.audio.current.id=Math.floor(Math.random()*s.data.length),w(s.audio.current,0),w(s.audio.prev,-1),w(s.audio.next,1))},t.open("GET",s.url.info),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send()}a.vis.grad=o.createLinearGradient(0,l-200,0,l-50),a.vis.grad.addColorStop(0,a.vis.c1),a.vis.grad.addColorStop(.3,a.vis.c2),a.vis.grad.addColorStop(.6,a.vis.c3),a.vis.grad.addColorStop(1,a.vis.c4),s.vis.support=!0;try{s.vis.context=new AudioContext,s.vis.source=s.vis.context.createMediaElementSource(s.audio.current.elem),s.vis.analyser=s.vis.context.createAnalyser(),s.vis.source.connect(s.vis.analyser),s.vis.analyser.connect(s.vis.context.destination),console.log("Your browser support audioContext object")}catch(e){s.vis.support=!1,console.log("Your browser doesn't support audioContext object, equalizer will not render",e)}}}}).init();