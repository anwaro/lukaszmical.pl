mathcode=function(e,t){var c=e,a=t;l(a,"mathcode"),c.style.width="1px",c.style.position="absolute",c.style.left="-99999px",a.parentNode.appendChild(c);var n=["br","op","va","nu","co","fu"],r=[/\(|\)/,/\/|\*|\-|\+|\.|\^/,/x/,/\d/,/e|E|pi|Pi|PI/,/\w/];function i(e){var t=c.value,n=t.length,r=function(){var e=0;if(document.selection){c.focus();var t=document.selection.createRange();t.moveStart("character",-c.value.length),e=t.text.length}else(c.selectionStart||"0"==c.selectionStart)&&(e=c.selectionStart);return e}();a.innerHTML="",e&&"("===t.slice(r-1,r)&&57===e.which&&(t=t.slice(0,r)+")"+t.slice(r,n),e.target.value=t,n++,s(r)),e&&")"===t.slice(r-1,r)&&48===e.which&&")"===t.slice(r,r+1)&&(t=t.slice(0,r-1)+t.slice(r,n),e.target.value=t,n--,s(r)),a.appendChild(u("",0===r?"cursor":"empty"));for(var i=0;i<n;i++){char=t[i],i+1<n&&/pi/i.test(char+t[i+1])?char+=t[i+1]:i>1&&/pi/i.test(t[i-1]+char)&&(char=t[i-1]+char);var v=o(char),f=u(t[i],v);r===i+1&&(f=l(f,"cursor")),a.appendChild(f)}d()}function s(e){if(c.setSelectionRange)c.focus(),c.setSelectionRange(e,e);else if(c.createTextRange){var t=c.createTextRange();t.collapse(!0),t.moveEnd("character",e),t.moveStart("character",e),t.select()}}function o(e){for(var t=0;t<r.length;t++)if(r[t].test(e))return n[t]}function l(e,t){return e.classList.add(t),e}function u(e,t){var c=document.createElement("div");return c.innerHTML=e,c.classList.add("mb"),c.classList.add(t),c.addEventListener("click",v),c}function d(){c.focus()}function v(e){var t=e.target,c=document.getElementsByClassName("cursor")[0];c&&c.classList.remove("cursor"),l(t,"cursor"),s([].indexOf.call(t.parentNode.children,t)),d()}i(),a.addEventListener("mouseup",d),c.addEventListener("keyup",i),c.addEventListener("focus",(function(){a.classList.remove("inactive"),l(a,"active")})),c.addEventListener("focusout",(function(){a.classList.remove("active"),l(a,"inactive")}))};