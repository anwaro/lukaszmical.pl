function Point(i,e){this.position={x:i,y:e}}function Player(i,e){this.position={x:i,y:e},this.size=6,this.shield={life:0,start:0,size:0}}function Mine(i,e){this.position={x:i,y:e},this.size=6+4*Math.random(),this.veriocity=1+.4*Math.random()}function Shield(i,e){this.position={x:i,y:e},this.size=8+4*Math.random(),this.life=!0}CanvasRenderingContext2D.prototype.curve=function(i,w,x,e){w="number"==typeof w?w:.5,x=x||25;var t,o=(i.length-2)*x+2+(e?2*x:0),b=0,m=new Float32Array(o),n=i.length,s=new Float32Array(4*(x+2)),a=4,o=i.slice(0);for(e?(o.unshift(i[n-1]),o.unshift(i[n-2]),o.push(i[0],i[1])):(o.unshift(i[1]),o.unshift(i[0]),o.push(i[n-2],i[n-1])),t=s[0]=1;t<x;t++){var r=t/x,l=r*r,h=l*r,d=2*h,p=3*l;s[a++]=d-p+1,s[a++]=p-d,s[a++]=h-2*l+r,s[a++]=h-l}function c(i,e,t){for(var o=2;o<t;o+=2)for(var n=i[o],s=i[o+1],a=i[o+2],r=i[o+3],l=(a-i[o-2])*w,h=(r-i[o-1])*w,d=(i[o+4]-n)*w,p=(i[o+5]-s)*w,c=0;c<x;c++){var y=c<<2,f=e[y],u=e[1+y],g=e[2+y],y=e[3+y];m[b++]=f*n+u*a+g*l+y*d,m[b++]=f*s+u*r+g*h+y*p}}for(s[++a]=1,c(o,s,n),e&&((o=[]).push(i[n-4],i[n-3],i[n-2],i[n-1]),o.push(i[0],i[1],i[2],i[3]),c(o,s,4)),n=e?0:i.length-2,m[b++]=i[n],m[b]=i[1+n],t=0,n=m.length;t<n;t+=2)this.lineTo(m[t],m[t+1]);return m},($$StayAlive=new function(){let i=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Phone/i.test(navigator.userAgent),t,o,e,n=100,s=300,a=new Player(4,5),r=!1,l=[],h=[],d=[],p=new Shield(-1,0),c,y,f,j,u,g=2,w=2,D=2e-4,x={load:0,switcher:1,ready:"",play:"",bonus:"",bang:"",crash:""},b,m,v,$,M,B,S,z,P,k,A,I={x:0,y:0};function W(){x.load++,5===x.load&&(i?setInterval(q,1e3/30):setInterval(q,1e3/60),k.fadeOut(500,function(){$$("#game").fadeIn(1500)}),x.switcher)&&x.ready.play()}function F(i){var e=t.getBoundingClientRect();n=i.clientX-e.left,s=i.clientY-e.top}function V(i){1===i.touches.length&&(i.preventDefault(),n=i.touches[0].pageX-.5*(window.innerWidth-c),s=i.touches[0].pageY-.5*(window.innerHeight-y))}function O(i){1===i.touches.length&&(i.preventDefault(),n=i.touches[0].pageX-.5*(window.innerWidth-c),s=i.touches[0].pageY-.5*(window.innerHeight-y))}function E(i,e){return Math.sqrt((i.position.x-e.position.x)*(i.position.x-e.position.x)+(i.position.y-e.position.y)*(i.position.y-e.position.y))}function T(){var i=Math.min(y,c)/Math.max(y,c)*.5,e=Math.random();y<c?I.x=e<i?c+1:Math.random()*c:I.x=i<e?c+1:Math.random()*c,I.y=I.x>c?Math.random()*y:-1}function H(){c=!i&&800<window.innerWidth?800:window.innerWidth,y=!i&&500<window.innerHeight?500:window.innerHeight,t.width=c,t.height=y,i?(w=g*=1.5,e.css({margin:"0",height:y+"px",width:c+"px"})):e.css({marginTop:(window.innerHeight-y)/2+"px",marginLeft:(window.innerWidth-c)/2+"px",width:c+"px"})}function R(){!1===r&&(f=(new Date).getTime(),T(),r=!0,d=[],h=[],l=[],p=new Shield(I.x,I.y),b=0,w=g,a.position.x=n=50,a.position.y=s=50,v.hide(),A.hide(),d.push(new Point(a.position.x-1,a.position.y-1)),L("play"))}function C(){r&&(L("crash"),r=!1,a.shield.life=!1,X(90),b=Math.ceil(b),r=!1,M.show(),v.show(),S.setText(b),z.setText($$.cookie("StayAliveHightScore")),parseInt($$.cookie("StayAliveHightScore")||0)<b&&$$.cookie("StayAliveHightScore",b),L("ready"))}function X(e){for(let i=0;i<e;i++){var t=new Point(a.position.x,a.position.y);t.xVeocity=.8*Math.cos(3.14*Math.random())*(Math.random()+.5),t.yVeocity=.8*Math.cos(3.14*Math.random())*(Math.random()+.5),t.start=u,t.time=1100+500*Math.random(),h.push(t)}}function Y(){x.switcher?(x.switcher=!1,$$.cookie("StayAliveSound","off"),x.ready.stop(),x.play.stop(),$.addClass("off")):(x.switcher=!0,$$.cookie("StayAliveSound","on"),x.ready.play(),$.removeClass("off"))}function L(i){if(x.switcher)switch(i){case"play":x.bonus.isMuted()||x.ready.fadeWith(x.play,500),x.ready.isMuted()||x.bonus.fadeWith(x.play,500);break;case"ready":x.bonus.isMuted()||x.play.fadeWith(x.ready,500),x.play.isMuted()||x.bonus.fadeWith(x.ready,500);break;case"bonus":x.play.fadeWith(x.bonus,500);break;case"bang":x.bang.stop(),x.bang.play();break;case"crash":x.crash.play()}}function q(){o.clearRect(0,0,c,y),u=(new Date).getTime(),a.position.x+=.14*(n-a.position.x),a.position.y+=.14*(s-a.position.y),T(),.7<Math.random()||l.push(new Mine(I.x,I.y)),p.life||.001<Math.random()||(T(),p=new Shield(I.x,I.y));for(var i=0;i<l.length;i++)(l[i].position.x<-10||l[i].position.y>y+10)&&l.splice(i,1)||(l[i].position.x-=l[i].veriocity*w,l[i].position.y+=l[i].veriocity*w,o.fillStyle="#B20000",o.beginPath(),o.arc(l[i].position.x,l[i].position.y,l[i].size/2,0,2*Math.PI,!0),o.closePath(),o.fill());d.push(new Point(a.position.x,a.position.y)),d.length<50||d.shift();for(i=0;i<h.length;i++)h[i].position.x+=h[i].xVeocity-w,h[i].position.y+=h[i].yVeocity+w,(h[i].position.x<-10||h[i].position.y>y+10||u-h[i].start>h[i].time)&&h.splice(i,1)||(o.fillStyle="#E6E6E6",o.beginPath(),o.arc(h[i].position.x,h[i].position.y,1,0,2*Math.PI,!0),o.closePath(),o.fill());if(p.position.x-=w,p.position.y+=w,p.position.x<-10||p.position.y>y+10)p.life=!1;else if(p.life){o.fillStyle="rgba(123, 11, 175, .1)";for(i=0;i<p.size;i+=.5)o.beginPath(),o.arc(p.position.x,p.position.y,i,0,2*Math.PI,!0),o.closePath(),o.fill()}if(r){b+=.5,w+=D,p.life&&E(a,p)<a.size+p.size&&(a.shield.life=!0,a.shield.size=60,p.life=!1,L("bonus")),(a.position.x<6||a.position.y<6||a.position.x>c-6||a.position.y>y-26)&&C();for(i=0;i<l.length;i++)if(a.shield.life&&E(a,l[i])<a.size+l[i].size/2+20)l.splice(i,1),b+=10,X(10),L("bang");else if(E(a,l[i])<a.size+l[i].size/2){C();break}if(a.shield.life){a.shield.size-=.2;for(var e=Math.min(a.shield.size,40),i=2;i<e;i++)o.fillStyle="rgba(123, 11, 175, 0.02)",o.beginPath(),o.arc(a.position.x,a.position.y,i+8,0,2*Math.PI,!0),o.closePath(),o.fill();a.shield.size<1&&(a.shield.life=!1,L("play"))}o.strokeStyle=a.shield.life?"rgba(123, 11, 175, 0.5)":"rgba(41, 163, 163, 0.6)";for(var t=[],i=0;i<d.length;i++)d[i].position.x-=w,d[i].position.y+=w,t.push(d[i].position.x),t.push(d[i].position.y);o.beginPath(),o.moveTo(t[0],t[1]),o.curve(t,.4,10,0),o.stroke(),o.lineWidth=2,o.stroke(),o.fillStyle=a.shield.life?"rgba(123, 11, 175, 0.1)":"rgba(41, 163, 163, .1)";for(i=0;i<a.size+1;i+=.5)o.beginPath(),o.arc(a.position.x,a.position.y,i,0,2*Math.PI,!0),o.closePath(),o.fill();P.setText("Score: "+b.toFixed()+" Time "+((u-f)/1e3).toFixed(1))}j=u}this.init=function(){e=$$("#game"),m=$$("#playGame"),v=$$("#gameInfo"),$=$$("#gameSound"),M=$$("#gover"),B=$$("#yourscore"),S=$$("#yourcs"),z=$$("#bestcs"),P=$$("#time"),A=$$("#textInfo"),t=$$("#StayAlive"),k=$$("#load"),t&&t.getContext&&(H(),o=t.getContext("2d"),window.addEventListener("resize",H),t.addEventListener("mousemove",F),m.addEventListener("click",R),t.addEventListener("touchstart",V,!1),document.addEventListener("touchmove",O,!1),$.addEventListener("click",Y),z.setText($$.cookie("StayAliveHightScore")||0),x.ready=new buzz.sound("/projects/stayalive/sound/ready",{formats:["mp3","ogg"]}),x.play=new buzz.sound("/projects/stayalive/sound/play",{formats:["mp3","ogg"]}),x.bonus=new buzz.sound("/projects/stayalive/sound/bonus",{formats:["mp3","ogg"],volume:10}),x.bang=new buzz.sound("/projects/stayalive/sound/bang",{formats:["mp3","ogg"]}),x.crash=new buzz.sound("/projects/stayalive/sound/crash",{formats:["mp3","ogg"]}),x.ready.load().loop().bind("loadeddata",W),x.play.load().loop().bind("loadeddata",W),x.bonus.load().loop().bind("loadeddata",W),x.bang.load().bind("loadeddata",W),x.crash.load().bind("loadeddata",W),"off"===$$.cookie("StayAliveSound"))&&(x.switcher=0,$.addClass("off"))}}).init();