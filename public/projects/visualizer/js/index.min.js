RENDER={FLAT:0,PERSPECTIVE:1},CanvasRenderingContext2D.prototype.loadConfig=function(t){for(var i in t)t.hasOwnProperty(i)&&i in this&&(this[i]=t[i])},CanvasRenderingContext2D.prototype.moveToPoint=function(t){this.moveTo(t.x,t.y)},CanvasRenderingContext2D.prototype.lineToPoint=function(t){this.lineTo(t.x,t.y)};var o=Math.cos,r=Math.sin;function t(e,t){this.ctx=e,this.scene=t,this.config=t.config.canvas,this.cleanCanvas=function(){this.ctx.clearRect(0,0,this.config.width,this.config.height)},this.scale=function(){},this.fillPolygon=function(t){},this.strokePolygon=function(t,i){this.ctx.beginPath(),this.ctx.loadConfig(i||{});var n=t.vertexs;this.ctx.moveToPoint(this.project(n[0]));for(var s=1;s<n.length;s++)e.lineToPoint(this.project(n[s]));this.ctx.lineToPoint(this.project(n[0])),this.ctx.stroke()},this.strokeLine=function(t,i){this.ctx.beginPath(),this.ctx.loadConfig(i||{}),this.ctx.moveToPoint(this.project(t[0]));for(var n=1;n<t.length;n++)e.lineToPoint(this.project(t[n]));this.ctx.stroke()},this.project=function(t){return this.scene.config.render==RENDER.PERSPECTIVE?this.scene.transform(this.scene.project(t)):this.scene.transform(t)}}function s(t,i,n){this.x="object"==typeof t?t.x:t||0,this.y="object"==typeof t?t.y:i||0,this.z="object"==typeof t?t.z:n||0,this.set=function(t,i,n){return"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t||0,this.y=i||0,this.z=n||0),this},this.dist2d=function(t){return Math.sqrt(Math.pow(t.x-this.x,2)+Math.pow(t.y-this.y,2))},this.dist3d=function(t){return Math.sqrt(Math.pow(t.x-this.x,2)+Math.pow(t.y-this.y,2)+Math.pow(t.z-this.z,2))}}function e(t,i,n){s.call(this,t,i,n),this.current=new s(t,i,n),this.angle2D=function(){var t=Math.atan2(this.y,this.x);return 0<t?t:2*PI+t},this.rotate=function(t){return this.set(t.dotProduct(this.current)),this},this.len=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))},this.norm=function(){return this.multiply(1/this.len())},this.normThis=function(){return this.multiplyThis(1/this.len()),this},this.dotProduct=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},this.crossProduct=function(t){return new e(this.y*t.z-t.y*this.z,this.z*t.x-t.z*this.x,this.x*t.y-t.x*this.y)},this.update=function(){return this.set(this.current),this},this.toVertex=function(t){return new e(t.x-this.x,t.y-this.y,t.z-this.z)},this.add=function(t){return new e(t.x+this.x,t.y+this.y,t.z+this.z)},this.addThis=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},this.subtract=function(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z)},this.subtractThis=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},this.multiply=function(t){return new e(t*this.x,t*this.y,t*this.z)},this.multiplyThis=function(t){return this.x*=t,this.y*=t,this.z*=t,this},this.str=function(){return"Vertex{x: "+this.x+", y: "+this.y+", z: "+this.z+" }"}}function i(t){this.vertexs=t,this.len=t.length,this.angle=0,this.show=!0,this.normal=new e,this.calcNormal=function(){return this.normal.set(this.get(2).toVertex(this.get(1)).crossProduct(this.get(2).toVertex(this.get(3)))),this},this.average=function(){return this.vertexs.reduce(function(t,i){return t.add(i)}).multiply(1/this.len)},this.rotate=function(i){return this.vertexs.forEach(function(t){t.rotate(i)}),this.calcNormal(),this},this.update=function(){return this.vertexs.forEach(function(t){t.update()}),this},this.get=function(t){return this.vertexs[t]},this.isShow=function(){return 0<this.normal.z}}(e.prototype=Object.create(s.prototype)).constructor=e,canvasSetting={width:900,height:500},sceneConfig={viewer:new s(0,0,300),canvas:canvasSetting,scale:100,render:RENDER.PERSPECTIVE},pol1Congig={lineWidth:4,strokeStyle:"blue",lineJoin:"round"},pol2Congig={lineWidth:4,strokeStyle:"red",lineJoin:"round"},axisSetting={lineWidth:1,strokeStyle:"green",lineJoin:"round"};var n,h,c,u=5,a=new e(3,1,4),l=(a.normThis(),new function(t,i,n){this.v1=t,this.v2=i,this.v3=n,this.result=new s,this.dotProduct=function(t){return this.result.x=this.v1.x*t.x+this.v1.y*t.y+this.v1.z*t.z,this.result.y=this.v2.x*t.x+this.v2.y*t.y+this.v2.z*t.z,this.result.z=this.v3.x*t.x+this.v3.y*t.y+this.v3.z*t.z,this.result},this.updateMatrix=function(t,i){var n=o(i),i=r(i),s=1-n,e=t.x,h=t.y,t=t.z;this.v1.set(s*e*e+n,s*e*h-t*i,s*e*t+h*i),this.v2.set(s*e*h+t*i,s*h*h+n,s*h*t-e*i),this.v3.set(s*e*t-h*i,s*h*t+e*i,s*t*t+n)}}(new e,new e,new e)),f=new i([new e(-1,1,1),new e(-1,-1,1),new e(-1,-1,-1),new e(-1,1,-1),new e(-1,1,1),new e(1,1,1),new e(1,1,-1),new e(-1,1,-1)]),x=new i([new e(1,-1,-1),new e(1,1,-1),new e(1,1,1),new e(1,-1,1),new e(1,-1,-1),new e(-1,-1,-1),new e(-1,-1,1),new e(1,-1,1)]),y=new s(0,0,0),g=new s(1,2,0),v=new function(t){this.viewer=t.viewer,this.config=t,this.project=function(t){return{x:t.x/(1+t.z*this.config.scale/this.viewer.z),y:t.y/(1+t.z*this.config.scale/this.viewer.z),z:0}},this.transform=function(t){return{x:t.x*this.config.scale+.5*this.config.canvas.width,y:-t.y*this.config.scale+.5*this.config.canvas.height,z:t.z*this.config.scale}},this.scale=function(t){return t.multiply(this.config.scale)}}(sceneConfig);function w(t){var i=h.getBoundingClientRect();y.set(t.clientX-i.left,t.clientY-i.top)}c="visualizer",(h=document.getElementById(c)).addEventListener("mousemove",w),h.width=canvasSetting.width,h.height=canvasSetting.height,c=h.getContext("2d"),n=new t(c,v),setInterval(function(){n.cleanCanvas(),g.x+=.3*(y.x-g.x),g.y+=.3*(y.y-g.y),a.set(g.x-canvasSetting.width/2,canvasSetting.height/2-g.y),n.strokeLine([a.multiply(0),a.multiply(1/sceneConfig.scale)],axisSetting),a.normThis(),l.updateMatrix(a,u),f.rotate(l),n.strokePolygon(f,pol1Congig),x.rotate(l),n.strokePolygon(x,pol2Congig)},50);