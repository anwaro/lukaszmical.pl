function e(e){return document.getElementById(e)}var t="/projects/flappy/image/",c={user:{best:0,score:0,Up:!0},set:{cookie:"game",name:"FlappyBird",x:450,y:630,g:28,ground:45,speed:5,win:170,step:300},bird:{x:100,y:300,w:50,h:40,dY:0,angle:0,life:!0,fly:!0,img:new Image,src:t+"bird.png"},ground:{w:20,h:9,x:0,c:"rgba(100, 100, 100, 0.55)"},columns:[],col:function(e,t,o){this.h=400,this.w=66,this.x=e,this.yt=t,this.yb=o},column:{img_top:new Image,img_bot:new Image,src_top:t+"col_top.png",src_bot:t+"col_bott.png"},canv:"",ctx:"",loop:""};function o(){c.inicialize()}c.inicialize=function(){c.settingGame(),c.loop=setInterval(c.play,50),c.canv.addEventListener("click",c.changeSpeed),$$("html").addEventListener("keypress",function(e){32===e.keyCode&&(e.stopPropagation(),c.changeSpeed())})},c.settingGame=function(){c.canv=e("GameFlappyBird"),c.canv.height=c.set.y,c.canv.width=c.set.x,c.ctx=c.canv.getContext("2d"),e("PlayGame").style.display="none",c.bird.img.src=c.bird.src,c.column.img_top.src=c.column.src_top,c.column.img_bot.src=c.column.src_bot,c.pushArray(),c.checkBestScore()},c.play=function(){c.clearBoard(),c.moveAndDrawGround(),c.drawColumn(),c.moveColumn(),c.drawBird(),c.moveBird(),c.checkColision(),c.score()},c.changeSpeed=function(e){e&&e.stopPropagation(),c.bird.life&&c.bird.fly?(c.sound("up"),c.bird.dY=-16):c.bird.fly||(c.bird.life=!0,c.bird.fly=!0,o())},c.clearBoard=function(){c.ctx.clearRect(0,0,c.set.x,c.set.y)},c.drawBird=function(){var e=c.bird;c.ctx.save(),c.ctx.translate(e.x,e.y),c.ctx.rotate(e.angle),c.ctx.drawImage(e.img,-e.w/2,-e.h/2,e.w,e.h),c.ctx.restore()},c.moveBird=function(){var e=c.bird;e.y<e.h/2?(c.gameOver(),e.dY=5):e.y>c.set.y-(c.set.ground+e.h/2)&&(c.gameOver(),c.resetGame(),e.dY=0),e.y+=e.dY,e.dY+=.05*c.set.g,e.angle=Math.PI/2*(e.dY/30),e.angle=Math.PI/2<e.angle?Math.PI/2:e.angle},c.drawColumn=function(){for(var e=0;e<3;e++){var t=c.columns[e],o=c.column,r=(c.ctx.drawImage(o.img_top,0,t.h-t.yt,t.w,t.yt,t.x,0,t.w,t.yt),c.set.y-c.set.ground-t.yb);c.ctx.drawImage(o.img_bot,0,0,t.w,r,t.x,t.yb,t.w,r)}},c.moveColumn=function(){for(var e=0;e<3;e++)c.columns[e].x-=c.set.speed,c.columns[e].x<-c.columns[e].w&&c.setColumn(c.columns[e],e)},c.moveAndDrawGround=function(){for(var e=c.ground,t=(e.x-=c.set.speed,c.set.y-c.set.ground+3),o=0;o<5;o++)for(var r=e.x;r<=c.set.x;r+=2*e.w)c.drawSqare(r+o%2*e.w,t+o*e.h,e.w,e.h,e.c);e.x=e.x<-2*e.w?e.x+2*e.w:e.x},c.drawSqare=function(e,t,o,r,n){c.ctx.fillStyle=n,c.ctx.beginPath(),c.ctx.rect(e,t,o,r),c.ctx.closePath(),c.ctx.fill()},c.pushArray=function(){for(var e=0;e<3;e++){var t=new c.col(c.set.x,100,270);c.columns.push(t),0!==e&&c.setColumn(c.columns[e],e)}},c.setColumn=function(e,t){var t=0===t?2:t-1,o=Math.floor(Math.random()*(c.set.y-c.set.ground-c.set.win-200))+100;e.x=c.columns[t].x+c.set.step,e.yt=o,e.yb=o+c.set.win,c.user.Up=!0},c.checkColision=function(){var e=c.bird,t=c.columns;if(c.bird.life)for(var o=0;o<3;o++)Math.abs(e.x-(t[o].x+t[o].w/2))<=e.w/2+t[o].w/2&&(e.y-e.h/2<=t[o].yt||e.y+e.h/2>=t[o].yb?c.gameOver():c.scoreUp(t[o]))},c.gameOver=function(){c.set.speed=0,c.bird.life&&c.sound("crash"),c.bird.life=!1},c.score=function(){c.ctx.save(),c.ctx.fillStyle="black",c.ctx.textAlign="start",c.ctx.font="bold 20pt Calibri",c.ctx.fillText("score: "+c.user.score,5,23),c.ctx.textAlign="end",c.ctx.fillText("best: "+c.user.best,c.set.x-5,23),c.ctx.restore()},c.scoreUp=function(e){Math.abs(c.bird.x-(e.x+e.w/2))<c.set.speed+1&&c.user.Up&&(c.user.score++,c.user.Up=!1)},c.resetGame=function(){c.sound("over"),clearInterval(c.loop),c.ctx.save(),c.ctx.fillStyle="black",c.ctx.textAlign="center",c.ctx.font="bold 40pt Calibri",c.ctx.fillText("GAME OVER",c.set.x/2,c.set.y/2-90),c.ctx.font="bold 20pt Calibri",c.ctx.fillText("Score: "+c.user.score,c.set.x/2,c.set.y/2-30),c.ctx.fillText("click to play again",c.set.x/2,c.set.y/2),c.ctx.restore();var e=c.user,t=c.bird;c.bestScore(),e.score=0,e.Up=!0,c.columns=[],t.x=100,t.y=300,t.dY=0,t.angle=0,t.fly=!1,c.set.speed=5},c.bestScore=function(){c.set.cookie,c.set.name;var e=$$.cookie("FlappyBirdScore")||0;parseInt(e)<c.user.score&&$$.cookie("FlappyBirdScore",c.user.score)},c.checkBestScore=function(){c.set.cookie,c.set.name;c.user.best=$$.cookie("FlappyBirdScore")||0},window.drawFlappyBirdCanvas=o,c.sound=function(e){document.getElementById(e).play()};